"use strict";(()=>{var e={};e.id=28,e.ids=[28],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},5527:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>P,patchFetch:()=>w,requestAsyncStorage:()=>y,routeModule:()=>I,serverHooks:()=>q,staticGenerationAsyncStorage:()=>A});var s={};t.r(s),t.d(s,{GET:()=>b,POST:()=>x});var n=t(9303),i=t(8716),o=t(670),a=t(7070);let c=(0,t(9498).eI)("https://yylkwfikfbottngglaxj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5bGt3ZmlrZmJvdHRuZ2dsYXhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1NjUwNzAsImV4cCI6MjA3MjE0MTA3MH0.h-GTmBH9onVHNJLLuafw9jwS9G8azVaQGelf-oUK-xc"),u=[{base:"Texture-Cr\xe9meux",contrast:"Texture-Croquant"},{base:"Texture-Moelleux",contrast:"Texture-Ferme"},{base:"Texture-Liquide",contrast:"Texture-Croquant"}],l={aromatic:"Ar\xf4me-",season:["Printemps","\xc9t\xe9","Automne","Hiver"],cuisine:["Fran\xe7aise","Italienne","Espagnole","Asiatique","Chinoise","Japonaise","Tha\xeflandaise","Indienne","Mexicaine","Am\xe9ricaine","Orientale"]};async function p(e){let{data:r,error:t}=await c.from("recipes").select("id, name, description, role, party_size").eq("id",e).single();if(t)throw Error(`Recette non trouv\xe9e: ${t.message}`);let{data:s,error:n}=await c.from("recipe_tags").select("tags(name)").eq("recipe_id",e);if(n)throw Error(`Erreur tags: ${n.message}`);return{recipe:r,tags:s.map(e=>e.tags.name)}}async function g(e={}){let r=c.from("recipes").select("id, name, description, role, party_size").eq("role","ACCOMPAGNEMENT"),{data:t,error:s}=await r;if(s)throw Error(`Erreur accompagnements: ${s.message}`);let n=await Promise.all(t.map(async e=>{let{data:r}=await c.from("recipe_tags").select("tags(name)").eq("recipe_id",e.id);return{recipe:e,tags:r?r.map(e=>e.tags.name):[]}}));return e.diet&&(n=n.filter(({tags:r})=>r.includes(e.diet))),n}function d(e,r){let t=function(e,r){let t=e.filter(e=>e.startsWith(l.aromatic)),s=r.filter(e=>e.startsWith(l.aromatic)),n=t.filter(e=>s.includes(e));return{score:Math.min(10*n.length,30),sharedAromatics:n}}(e,r),s=function(e,r){let t=e.includes("Intensit\xe9-Riche")||e.includes("Intensit\xe9-Intense"),s=r.includes("Intensit\xe9-L\xe9ger"),n=r.includes("Saveur-Acide");return t&&(s||n)?{score:25,balanced:!0,reason:s?"Accompagnement l\xe9ger pour \xe9quilibrer plat riche":"Accompagnement acidul\xe9 pour couper le gras"}:{score:0,balanced:!1,reason:null}}(e,r),n=function(e,r){let t=[];for(let{base:s,contrast:n}of u)e.includes(s)&&r.includes(n)&&t.push(`${s} â†” ${n}`),e.includes(n)&&r.includes(s)&&t.push(`${n} â†” ${s}`);return{score:Math.min(20*t.length,20),contrasts:t}}(e,r),i=function(e,r){let t=e.filter(e=>l.cuisine.includes(e)),s=r.filter(e=>l.cuisine.includes(e)),n=t.filter(e=>s.includes(e));return{score:Math.min(15*n.length,15),sharedCuisines:n}}(e,r),o=function(e,r){let t=e.filter(e=>l.season.includes(e)),s=r.filter(e=>l.season.includes(e)),n=t.filter(e=>s.includes(e));return n.length>0?{score:10,season:n[0]}:{score:0,season:null}}(e,r);return{totalScore:t.score+s.score+n.score+i.score+o.score,details:{foodPairing:t,balance:s,contrast:n,terroir:i,season:o}}}function m(e){let r=[];return e.foodPairing.score>0&&r.push({type:"food_pairing",description:`Ar\xf4mes partag\xe9s : ${e.foodPairing.sharedAromatics.join(", ")}`,score:e.foodPairing.score}),e.balance.score>0&&r.push({type:"balance",description:e.balance.reason,score:e.balance.score}),e.contrast.score>0&&r.push({type:"contrast",description:`Contraste de textures : ${e.contrast.contrasts.join(", ")}`,score:e.contrast.score}),e.terroir.score>0&&r.push({type:"terroir",description:`Cuisine commune : ${e.terroir.sharedCuisines.join(", ")}`,score:e.terroir.score}),e.season.score>0&&r.push({type:"season",description:`Saison : ${e.season.season}`,score:e.season.score}),r}async function h(e,r={}){let{diet:t,season:s,maxSuggestions:n=5}=r,{recipe:i,tags:o}=await p(e);console.log(`ðŸ½ï¸ Recherche d'accompagnements pour : ${i.name}`),console.log(`ðŸ“‹ Tags du plat : ${o.join(", ")}`);let a=await g({diet:t});console.log(`ðŸ” ${a.length} accompagnements candidats trouv\xe9s`);let c=a.map(({recipe:e,tags:r})=>{let{totalScore:t,details:s}=d(o,r),n=m(s);return{recipe:{id:e.id,name:e.name,description:e.description,role:e.role,party_size:e.party_size},tags:r,score:t,scorePercentage:Math.round(t/100*100),reasons:n,details:s}}).filter(e=>e.score>0).sort((e,r)=>r.score-e.score).slice(0,n);return console.log(`âœ… ${c.length} suggestions g\xe9n\xe9r\xe9es`),c}async function f(e,r){let{recipe:t,tags:s}=await p(e),{recipe:n,tags:i}=await p(r),{totalScore:o,details:a}=d(s,i);return{main:{recipe:t,tags:s},side:{recipe:n,tags:i},score:o,scorePercentage:Math.round(o/100*100),reasons:m(a),details:a}}async function x(e){try{let{mainRecipeId:r,diet:t,season:s,maxSuggestions:n=5}=await e.json();if(!r||"number"!=typeof r)return a.NextResponse.json({error:"Param\xe8tre mainRecipeId requis (nombre)",example:{mainRecipeId:123}},{status:400});console.log("\uD83D\uDD0D Requ\xeate de pairing:",{mainRecipeId:r,diet:t,season:s,maxSuggestions:n});let i=await h(r,{diet:t,season:s,maxSuggestions:n}),o={totalCandidates:i.length,validSuggestions:i.length,returned:i.length},c=i.length>0?{id:r,name:"Plat principal"}:null;return a.NextResponse.json({mainRecipe:c,suggestions:i,summary:o,timestamp:new Date().toISOString()})}catch(e){if(console.error("âŒ Erreur API suggestions:",e),e.message.includes("non trouv\xe9e")||e.message.includes("Erreur tags"))return a.NextResponse.json({error:"Recette introuvable ou sans tags",details:e.message,help:"V\xe9rifiez que la recette existe et poss\xe8de des tags gastronomiques"},{status:404});return a.NextResponse.json({error:"Erreur serveur lors de la g\xe9n\xe9ration des suggestions",details:e.message},{status:500})}}async function b(e){try{let{searchParams:r}=new URL(e.url),t=r.get("debug"),s=parseInt(r.get("main")||"0"),n=parseInt(r.get("side")||"0");if("true"===t&&s&&n){console.log(`ðŸ”¬ Mode debug: Analyse pairing entre ${s} et ${n}`);let e=await f(s,n);return a.NextResponse.json({mode:"debug",...e,interpretation:{excellent:e.scorePercentage>=70,good:e.scorePercentage>=50,acceptable:e.scorePercentage>=30,poor:e.scorePercentage<30}})}return a.NextResponse.json({name:"API d'Assemblage Intelligent de Recettes",version:"1.0",endpoints:{suggestions:{method:"POST",url:"/api/recipes/suggestions",description:"Sugg\xe8re des accompagnements pour un plat principal",body:{mainRecipeId:"number (requis)",diet:"string (optionnel) - V\xe9g\xe9tarien, Vegan, Sans Gluten, Sans Lactose",season:"string (optionnel) - Printemps, \xc9t\xe9, Automne, Hiver",maxSuggestions:"number (optionnel, d\xe9faut: 5)"}},debug:{method:"GET",url:"/api/recipes/suggestions?debug=true&main=123&side=456",description:"Analyse d\xe9taill\xe9e du pairing entre deux recettes"}},algorithms:{foodPairing:"30 points - Ar\xf4mes partag\xe9s (gastronomie mol\xe9culaire)",balance:"25 points - \xc9quilibre intensit\xe9 (riche â†” l\xe9ger)",contrast:"20 points - Contraste de textures",terroir:"15 points - Cuisine commune",season:"10 points - Saison commune"},documentation:"/ASSEMBLAGE_INTELLIGENT.md"})}catch(e){return console.error("âŒ Erreur GET suggestions:",e),a.NextResponse.json({error:"Erreur serveur",details:e.message},{status:500})}}let I=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/recipes/suggestions/route",pathname:"/api/recipes/suggestions",filename:"route",bundlePath:"app/api/recipes/suggestions/route"},resolvedPagePath:"/workspaces/garde-manger-app/app/api/recipes/suggestions/route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:A,serverHooks:q}=I,P="/api/recipes/suggestions/route";function w(){return(0,o.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:A})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,766,70],()=>t(5527));module.exports=s})();