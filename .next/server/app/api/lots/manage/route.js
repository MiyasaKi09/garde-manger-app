"use strict";(()=>{var e={};e.id=14,e.ids=[14],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},6408:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>z,requestAsyncStorage:()=>x,routeModule:()=>_,serverHooks:()=>j,staticGenerationAsyncStorage:()=>h});var n={};t.r(n),t.d(n,{GET:()=>y,POST:()=>m});var a=t(9303),o=t(8716),s=t(670),i=t(344),u=t(1615),c=t(7070),l=t(7043),d=t(5303);async function p(e,r){try{let{data:t,error:n}=await l.OQ.from("inventory_lots").select(`
        *,
        canonical_foods(canonical_name, category),
        products_catalog(product_name, category_name)
      `).eq("id",e).eq("user_id",r).single();if(n)throw n;if(!t)throw Error("Lot non trouv\xe9");if(t.is_opened)return{success:!1,error:"Ce produit est d\xe9j\xe0 marqu\xe9 comme ouvert"};let a=t.canonical_foods?.canonical_name||t.products_catalog?.product_name||t.product_name||"Produit",o=t.canonical_foods?.category||t.products_catalog?.category_name,s=(0,d.XO)(a,o),i=new Date,u=t.storage_method||"fridge",c=t.expiration_date?new Date(t.expiration_date):null,p=(0,d.e4)(s,u,i,c);if(null===p)return{success:!1,error:`âš ï¸ Ce produit ne se conserve pas bien ${"freezer"===u?"congel\xe9":"pantry"===u?"au garde-manger":"au frigo"} une fois ouvert. Consommez-le rapidement ou changez de m\xe9thode de stockage.`};let{data:f,error:g}=await l.OQ.from("inventory_lots").update({is_opened:!0,opened_at:i.toISOString(),adjusted_expiration_date:p.toISOString().split("T")[0]}).eq("id",e).eq("user_id",r).select().single();if(g)throw g;let m=Math.ceil((p-i)/864e5),y=(0,d.BK)(s,u,m);return{success:!0,lot:f,productName:a,category:s,originalDLC:c?c.toLocaleDateString("fr-FR"):null,adjustedDLC:p.toLocaleDateString("fr-FR"),daysUntilExpiration:m,storageMethod:u,message:`ðŸ“¦ ${a} ouvert !
${y}
Nouvelle DLC : ${p.toLocaleDateString("fr-FR")}`,messageShort:`Ouvert ! ${m}j restants`}}catch(e){return console.error("Erreur openLot:",e),{success:!1,error:e.message}}}async function f(e,r){try{let{data:t,error:n}=await l.OQ.from("inventory_lots").update({is_opened:!1,opened_at:null,adjusted_expiration_date:null}).eq("id",e).eq("user_id",r).select().single();if(n)throw n;return{success:!0,lot:t,message:"âœ… Produit referm\xe9, DLC originale restaur\xe9e"}}catch(e){return console.error("Erreur closeLot:",e),{success:!1,error:e.message}}}async function g(e,r,t){try{let{data:n,error:a}=await l.OQ.from("inventory_lots").select(`
        *,
        canonical_foods(canonical_name, category),
        products_catalog(product_name, category_name)
      `).eq("id",e).eq("user_id",r).single();if(a)throw a;if(!n)throw Error("Lot non trouv\xe9");let o={storage_method:t};if(n.is_opened){let e=n.canonical_foods?.canonical_name||n.products_catalog?.product_name||n.product_name||"Produit",r=n.canonical_foods?.category||n.products_catalog?.category_name,a=(0,d.XO)(e,r),s=n.opened_at?new Date(n.opened_at):new Date,i=n.expiration_date?new Date(n.expiration_date):null,u=(0,d.e4)(a,t,s,i);if(null===u)return{success:!1,error:`âš ï¸ Ce produit ne se conserve pas bien avec la m\xe9thode "${t}" une fois ouvert.`};o.adjusted_expiration_date=u.toISOString().split("T")[0]}let{data:s,error:i}=await l.OQ.from("inventory_lots").update(o).eq("id",e).eq("user_id",r).select().single();if(i)throw i;let u={fridge:"r\xe9frig\xe9rateur",freezer:"cong\xe9lateur",pantry:"garde-manger"}[t]||t;return{success:!0,lot:s,message:n.is_opened?`âœ… D\xe9plac\xe9 au ${u} et DLC recalcul\xe9e`:`âœ… D\xe9plac\xe9 au ${u}`}}catch(e){return console.error("Erreur changeStorageMethod:",e),{success:!1,error:e.message}}}async function m(e){try{let r;let t=(0,i.createRouteHandlerClient)({cookies:u.cookies}),{data:{user:n}}=await t.auth.getUser();if(!n)return c.NextResponse.json({error:"Non authentifi\xe9"},{status:401});let{action:a,lotId:o,storageMethod:s}=await e.json();if(!o)return c.NextResponse.json({error:"lotId requis"},{status:400});switch(a){case"open":r=await p(o,n.id);break;case"close":r=await f(o,n.id);break;case"changeStorage":if(!s)return c.NextResponse.json({error:"storageMethod requis pour changeStorage"},{status:400});r=await g(o,n.id,s);break;default:return c.NextResponse.json({error:`Action invalide: ${a}. Actions valides: open, close, changeStorage`},{status:400})}if(!r.success)return c.NextResponse.json({error:r.error},{status:400});return c.NextResponse.json(r)}catch(e){return console.error("Erreur API /lots/manage:",e),c.NextResponse.json({error:e.message},{status:500})}}async function y(e){try{let r=(0,i.createRouteHandlerClient)({cookies:u.cookies}),{data:{user:t}}=await r.auth.getUser();if(!t)return c.NextResponse.json({error:"Non authentifi\xe9"},{status:401});let{searchParams:n}=new URL(e.url),a=n.get("lotId");if(!a)return c.NextResponse.json({error:"lotId requis"},{status:400});let{data:o,error:s}=await r.from("inventory_lots_with_effective_dlc").select("*").eq("id",a).eq("user_id",t.id).single();if(s)return c.NextResponse.json({error:s.message},{status:500});if(!o)return c.NextResponse.json({error:"Lot non trouv\xe9"},{status:404});return c.NextResponse.json({success:!0,lot:o})}catch(e){return console.error("Erreur API GET /lots/manage:",e),c.NextResponse.json({error:e.message},{status:500})}}let _=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/lots/manage/route",pathname:"/api/lots/manage",filename:"route",bundlePath:"app/api/lots/manage/route"},resolvedPagePath:"/workspaces/garde-manger-app/app/api/lots/manage/route.js",nextConfigOutput:"",userland:n}),{requestAsyncStorage:x,staticGenerationAsyncStorage:h,serverHooks:j}=_,w="/api/lots/manage/route";function z(){return(0,s.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:h})}},5303:(e,r,t)=>{t.d(r,{BK:()=>s,MV:()=>u,XO:()=>o,e4:()=>a});let n={Lait:{fridge:3,freezer:90,pantry:1},Laitier:{fridge:3,freezer:30,pantry:1},Yaourt:{fridge:5,freezer:60,pantry:1},Fromage:{fridge:7,freezer:90,pantry:2},CrÃ¨me:{fridge:3,freezer:60,pantry:1},Beurre:{fridge:14,freezer:180,pantry:7},Charcuterie:{fridge:4,freezer:60,pantry:1},Jambon:{fridge:3,freezer:60,pantry:1},Saucisson:{fridge:7,freezer:90,pantry:3},PÃ¢tÃ©:{fridge:3,freezer:60,pantry:1},"Viande cuite":{fridge:3,freezer:90,pantry:1},Confiture:{fridge:30,freezer:180,pantry:14},Miel:{fridge:365,freezer:365,pantry:365},Sauce:{fridge:7,freezer:90,pantry:3},Mayonnaise:{fridge:7,freezer:null,pantry:1},Ketchup:{fridge:30,freezer:90,pantry:14},Moutarde:{fridge:60,freezer:90,pantry:30},"Jus de fruits":{fridge:5,freezer:90,pantry:2},Soda:{fridge:3,freezer:null,pantry:1},Vin:{fridge:5,freezer:null,pantry:3},Huile:{fridge:90,freezer:365,pantry:60},Vinaigre:{fridge:180,freezer:365,pantry:90},Pain:{fridge:3,freezer:30,pantry:2},PÃ¢tisserie:{fridge:2,freezer:30,pantry:1},Viennoiserie:{fridge:2,freezer:30,pantry:1},Conserve:{fridge:3,freezer:90,pantry:2},Compote:{fridge:5,freezer:90,pantry:2},Salade:{fridge:2,freezer:null,pantry:1},"L\xe9gumes cuits":{fridge:3,freezer:90,pantry:1},_default:{fridge:7,freezer:90,pantry:3}};function a(e,r,t=new Date,a=null){let o=n[e]||n._default,s=o[r]||o.fridge;if(null===s)return null;let i=new Date(t);if(i.setDate(i.getDate()+s),a){let e=new Date(a);if(i>e)return e}return i}function o(e,r=null){if(r&&n[r])return r;let t=e.toLowerCase();return t.includes("lait")&&!t.includes("coco")?"Lait":t.includes("yaourt")||t.includes("yogurt")||t.includes("yoghourt")?"Yaourt":t.includes("fromage")?"Fromage":t.includes("cr\xe8me")||t.includes("creme")?"Cr\xe8me":t.includes("beurre")?"Beurre":t.includes("jambon")?"Jambon":t.includes("saucisson")||t.includes("salami")?"Saucisson":t.includes("p\xe2t\xe9")||t.includes("pate")||t.includes("terrine")?"P\xe2t\xe9":t.includes("confiture")||t.includes("gel\xe9e")?"Confiture":t.includes("miel")?"Miel":t.includes("mayonnaise")||t.includes("mayo")?"Mayonnaise":t.includes("ketchup")?"Ketchup":t.includes("moutarde")?"Moutarde":t.includes("jus")?"Jus de fruits":t.includes("soda")||t.includes("cola")||t.includes("limonade")?"Soda":t.includes("vin")?"Vin":t.includes("huile")?"Huile":t.includes("vinaigre")?"Vinaigre":t.includes("pain")||t.includes("baguette")?"Pain":t.includes("croissant")||t.includes("pain au")||t.includes("brioche")?"Viennoiserie":t.includes("conserve")||t.includes("bocal")?"Conserve":t.includes("compote")?"Compote":t.includes("sauce")?"Sauce":t.includes("salade")||t.includes("laitue")?"Salade":"_default"}function s(e,r,t){return t<=0?"âš ï¸ Produit p\xe9rim\xe9, \xe0 jeter":1===t?"\uD83D\uDD25 \xc0 consommer aujourd'hui":t<=3?`â° ${t} jours restants, \xe0 consommer rapidement`:t<=7?`âœ“ ${t} jours restants`:`âœ“ Bon \xe9tat (${t} jours)`}let i={fridge:3,freezer:90,counter:1};function u(e=new Date,r="fridge"){let t=i[r]||i.fridge,n=new Date(e);return n.setDate(n.getDate()+t),n}},7043:(e,r,t)=>{t.d(r,{OQ:()=>s});var n=t(9498);let a="https://yylkwfikfbottngglaxj.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5bGt3ZmlrZmJvdHRuZ2dsYXhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1NjUwNzAsImV4cCI6MjA3MjE0MTA3MH0.h-GTmBH9onVHNJLLuafw9jwS9G8azVaQGelf-oUK-xc",s=null;if(a&&o)try{console.log("\uD83D\uDD17 Connexion \xe0 Supabase r\xe9el:",a),s=(0,n.eI)(a,o,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}catch(e){console.error("[Supabase] Erreur lors de la cr\xe9ation du client",e instanceof Error?e:Error(String(e)))}else{let e=[!a&&"NEXT_PUBLIC_SUPABASE_URL",!o&&"NEXT_PUBLIC_SUPABASE_ANON_KEY"].filter(Boolean);Error(`Supabase non configur\xe9. Variables manquantes: ${e.join(", ")}`)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[948,766,70,958],()=>t(6408));module.exports=n})();