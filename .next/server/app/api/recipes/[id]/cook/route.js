"use strict";(()=>{var e={};e.id=349,e.ids=[349],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},6998:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var n={};t.r(n),t.d(n,{POST:()=>l});var i=t(9303),o=t(8716),a=t(670),s=t(7070),u=t(344),d=t(1615),c=t(5303);async function l(e,{params:r}){try{let t=(0,u.createRouteHandlerClient)({cookies:d.cookies}),{data:{user:n},error:i}=await t.auth.getUser();if(i||!n)return s.NextResponse.json({error:"Non authentifi\xe9"},{status:401});let{id:o}=r,{portions:a,storageMethod:l,notes:p,ingredients:f=[]}=await e.json();if(!a||a<1)return s.NextResponse.json({error:"Le nombre de portions doit \xeatre sup\xe9rieur \xe0 0"},{status:400});if(!l||!["fridge","freezer","counter"].includes(l))return s.NextResponse.json({error:"Mode de stockage invalide"},{status:400});let{data:g,error:m}=await t.from("recipes").select("id, name").eq("id",o).single();if(m||!g)return s.NextResponse.json({error:"Recette non trouv\xe9e"},{status:404});let y=new Date,x=(0,c.MV)(y,l),{data:z,error:h}=await t.from("cooked_dishes").insert({user_id:n.id,name:g.name,recipe_id:parseInt(o),portions_cooked:a,portions_remaining:a,storage_method:l,cooked_at:y.toISOString(),expiration_date:x.toISOString().split("T")[0],notes:p||null}).select().single();if(h)return console.error("Erreur cr\xe9ation plat:",h),s.NextResponse.json({error:"Erreur lors de la cr\xe9ation du plat"},{status:500});let _=[];if(f&&f.length>0)for(let e of f){let{lot_id:r,quantity_used:i,unit:o,product_name:a}=e;if(!r||!i||i<=0)continue;let{data:s,error:u}=await t.from("inventory_lots").select("id, quantity, unit, product_name").eq("id",r).eq("user_id",n.id).single();if(u||!s){console.warn(`Lot ${r} non trouv\xe9, ignor\xe9`);continue}let d=Math.max(0,s.quantity-i),{error:c}=await t.from("inventory_lots").update({quantity:d,updated_at:new Date().toISOString()}).eq("id",r);if(c){console.error(`Erreur mise \xe0 jour lot ${r}:`,c);continue}let{error:l}=await t.from("cooked_dish_ingredients").insert({dish_id:z.id,lot_id:r,quantity_used:i,unit:o||s.unit,product_name:a||s.product_name});l?console.error("Erreur enregistrement ingr\xe9dient:",l):_.push({product_name:a||s.product_name,quantity_used:i,unit:o||s.unit})}return s.NextResponse.json({success:!0,dish:z,ingredients_used:_,message:`"${g.name}" ajout\xe9 au garde-manger avec ${a} portion${a>1?"s":""} !`})}catch(e){return console.error("Erreur /api/recipes/[id]/cook:",e),s.NextResponse.json({error:"Erreur serveur"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/recipes/[id]/cook/route",pathname:"/api/recipes/[id]/cook",filename:"route",bundlePath:"app/api/recipes/[id]/cook/route"},resolvedPagePath:"/workspaces/garde-manger-app/app/api/recipes/[id]/cook/route.js",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:m}=p,y="/api/recipes/[id]/cook/route";function x(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},5303:(e,r,t)=>{t.d(r,{BK:()=>a,MV:()=>u,XO:()=>o,e4:()=>i});let n={Lait:{fridge:3,freezer:90,pantry:1},Laitier:{fridge:3,freezer:30,pantry:1},Yaourt:{fridge:5,freezer:60,pantry:1},Fromage:{fridge:7,freezer:90,pantry:2},Crème:{fridge:3,freezer:60,pantry:1},Beurre:{fridge:14,freezer:180,pantry:7},Charcuterie:{fridge:4,freezer:60,pantry:1},Jambon:{fridge:3,freezer:60,pantry:1},Saucisson:{fridge:7,freezer:90,pantry:3},Pâté:{fridge:3,freezer:60,pantry:1},"Viande cuite":{fridge:3,freezer:90,pantry:1},Confiture:{fridge:30,freezer:180,pantry:14},Miel:{fridge:365,freezer:365,pantry:365},Sauce:{fridge:7,freezer:90,pantry:3},Mayonnaise:{fridge:7,freezer:null,pantry:1},Ketchup:{fridge:30,freezer:90,pantry:14},Moutarde:{fridge:60,freezer:90,pantry:30},"Jus de fruits":{fridge:5,freezer:90,pantry:2},Soda:{fridge:3,freezer:null,pantry:1},Vin:{fridge:5,freezer:null,pantry:3},Huile:{fridge:90,freezer:365,pantry:60},Vinaigre:{fridge:180,freezer:365,pantry:90},Pain:{fridge:3,freezer:30,pantry:2},Pâtisserie:{fridge:2,freezer:30,pantry:1},Viennoiserie:{fridge:2,freezer:30,pantry:1},Conserve:{fridge:3,freezer:90,pantry:2},Compote:{fridge:5,freezer:90,pantry:2},Salade:{fridge:2,freezer:null,pantry:1},"L\xe9gumes cuits":{fridge:3,freezer:90,pantry:1},_default:{fridge:7,freezer:90,pantry:3}};function i(e,r,t=new Date,i=null){let o=n[e]||n._default,a=o[r]||o.fridge;if(null===a)return null;let s=new Date(t);if(s.setDate(s.getDate()+a),i){let e=new Date(i);if(s>e)return e}return s}function o(e,r=null){if(r&&n[r])return r;let t=e.toLowerCase();return t.includes("lait")&&!t.includes("coco")?"Lait":t.includes("yaourt")||t.includes("yogurt")||t.includes("yoghourt")?"Yaourt":t.includes("fromage")?"Fromage":t.includes("cr\xe8me")||t.includes("creme")?"Cr\xe8me":t.includes("beurre")?"Beurre":t.includes("jambon")?"Jambon":t.includes("saucisson")||t.includes("salami")?"Saucisson":t.includes("p\xe2t\xe9")||t.includes("pate")||t.includes("terrine")?"P\xe2t\xe9":t.includes("confiture")||t.includes("gel\xe9e")?"Confiture":t.includes("miel")?"Miel":t.includes("mayonnaise")||t.includes("mayo")?"Mayonnaise":t.includes("ketchup")?"Ketchup":t.includes("moutarde")?"Moutarde":t.includes("jus")?"Jus de fruits":t.includes("soda")||t.includes("cola")||t.includes("limonade")?"Soda":t.includes("vin")?"Vin":t.includes("huile")?"Huile":t.includes("vinaigre")?"Vinaigre":t.includes("pain")||t.includes("baguette")?"Pain":t.includes("croissant")||t.includes("pain au")||t.includes("brioche")?"Viennoiserie":t.includes("conserve")||t.includes("bocal")?"Conserve":t.includes("compote")?"Compote":t.includes("sauce")?"Sauce":t.includes("salade")||t.includes("laitue")?"Salade":"_default"}function a(e,r,t){return t<=0?"⚠️ Produit p\xe9rim\xe9, \xe0 jeter":1===t?"\uD83D\uDD25 \xc0 consommer aujourd'hui":t<=3?`⏰ ${t} jours restants, \xe0 consommer rapidement`:t<=7?`✓ ${t} jours restants`:`✓ Bon \xe9tat (${t} jours)`}let s={fridge:3,freezer:90,counter:1};function u(e=new Date,r="fridge"){let t=s[r]||s.fridge,n=new Date(e);return n.setDate(n.getDate()+t),n}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[948,766,70,958],()=>t(6998));module.exports=n})();