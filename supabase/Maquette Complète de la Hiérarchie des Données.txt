erDiagram
    %% --- Cœur Alimentaire ---
    canonical_foods {
        id PK
        name
        nutrition_id FK
        category_id FK
    }
    cultivars {
        id PK
        canonical_food_id FK
        name
    }
    archetypes {
        id PK
        canonical_food_id FK
        name
    }
    products {
        id PK
        archetype_id FK
        name
        brand
    }
    cultivars |

|--|{ canonical_foods : "est une variété de"
    archetypes |

|--|{ canonical_foods : "est une forme de"
    products |

|--|{ archetypes : "est une instance de"

    %% --- Recettes & Intelligence d'Assemblage ---
    recipes {
        id PK
        name
        role
    }
    recipe_ingredients {
        id PK
        recipe_id FK
        canonical_food_id FK
        cultivar_id FK
        archetype_id FK
    }
    instructions {
        id PK
        recipe_id FK
        step_number
    }
    recipe_pairings {
        main_recipe_id PK, FK
        side_recipe_id PK, FK
    }
    tags {
        id PK
        name
    }
    recipe_tags {
        recipe_id PK, FK
        tag_id PK, FK
    }
    recipes |

|--|{ recipe_ingredients : "requiert"
    recipes |

|--|{ instructions : "a pour étapes"
    recipes }o--o{ recipes : "s'associe avec (classique)"
    recipes }o--o{ tags : "est tagué avec"
    recipe_ingredients }o..|| canonical_foods : "peut être un"
    recipe_ingredients }o..|| cultivars : "peut être un"
    recipe_ingredients }o..|| archetypes : "peut être un"
    recipe_tags |

|--|
| recipes : link
    recipe_tags |

|--|
| tags : link
    recipe_pairings |

|--|
| recipes : "plat principal"
    recipe_pairings |

|--|
| recipes : "accompagnement"

    %% --- Utilisateur & Inventaire ---
    users {
        id PK
        username
    }
    inventory_lots {
        id PK
        user_id FK
        canonical_food_id FK
        cultivar_id FK
        archetype_id FK
        product_id FK
    }
    locations {
        id PK
        user_id FK
        name
    }
    user_recipe_interactions {
        id PK
        user_id FK
        recipe_id FK
    }
    meal_plans {
        id PK
        user_id FK
    }
    planned_meals {
        id PK
        plan_id FK
        recipe_id FK
    }
    users |

|--|{ inventory_lots : "possède"
    users |

|--|{ locations : "définit"
    users |

|--|{ user_recipe_interactions : "interagit avec"
    users |

|--|{ meal_plans : "crée"
    inventory_lots }o..|| canonical_foods : "peut être un"
    inventory_lots }o..|| cultivars : "peut être un"
    inventory_lots }o..|| archetypes : "peut être un"
    inventory_lots }o..|| products : "peut être un"
    recipes |

|--|{ user_recipe_interactions : "est l'objet de"
    meal_plans |

|--|{ planned_meals : "contient"
    recipes |

|--|{ planned_meals : "est planifiée dans"

    %% --- Données de Support & Intelligence Nutritionnelle ---
    nutritional_data {
        id PK
        source_id
    }
    cooking_nutrition_factors {
        id PK
        cooking_method
        factor_type
        factor_value
    }
    reference_categories {
        id PK
        name
    }
    countries {
        id PK
        name
    }
    processes {
        id PK
        name
    }
    seasonality {
        id PK
        food_id FK
    }
    unit_conversions_generic {
        id PK
    }
    canonical_foods |

|--|
| nutritional_data : "a pour nutrition"
    canonical_foods |

|--o{ reference_categories : "appartient à"
    canonical_foods }o--o{ countries : "a pour origine"
    canonical_foods }o--o{ processes : "peut subir"
    canonical_foods |

|--o{ seasonality : "a une saisonnalité"
    recipes.. cooking_nutrition_factors : "utilise pour calcul"