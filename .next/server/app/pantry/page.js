(()=>{var e={};e.id=145,e.ids=[145],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},7140:(e,a,s)=>{"use strict";s.r(a),s.d(a,{GlobalError:()=>i.ZP,__next_app__:()=>u,originalPathname:()=>d,pages:()=>c,routeModule:()=>m,tree:()=>o}),s(592),s(3909),s(6926),s(5866);var t=s(3191),r=s(8716),i=s(5383),n=s(5231),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);s.d(a,l);let o=["",{children:["pantry",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,592)),"/workspaces/garde-manger-app/app/pantry/page.js"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,3909)),"/workspaces/garde-manger-app/app/layout.js"],error:[()=>Promise.resolve().then(s.bind(s,6926)),"/workspaces/garde-manger-app/app/error.jsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/workspaces/garde-manger-app/app/pantry/page.js"],d="/pantry/page",u={require:s,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/pantry/page",pathname:"/pantry",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},1003:(e,a,s)=>{Promise.resolve().then(s.bind(s,418))},418:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>L});var t=s(326),r=s(7577),i=s(5047),n=s(4122),l=s(3855),o=s(4019),c=s(2881);let d=(0,c.Z)("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),u=(0,c.Z)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),m=(0,c.Z)("snowflake",[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]]),p=(0,c.Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);var h=s(9813),g=s(7494);s(318);let _=(e,a)=>{let s=[];for(let e=0;e<=a.length;e++)s[e]=[e];for(let a=0;a<=e.length;a++)s[0][a]=a;for(let t=1;t<=a.length;t++)for(let r=1;r<=e.length;r++)a.charAt(t-1)===e.charAt(r-1)?s[t][r]=s[t-1][r-1]:s[t][r]=Math.min(s[t-1][r-1]+1,s[t][r-1]+1,s[t-1][r]+1);return s[a.length][e.length]},f=e=>{if(!e)return"";let a=["de","du","des","le","la","les","au","aux","en","et","ou","\xe0","avec","sans","pour","sur","sous","dans","par"],s={aoc:"AOC",aop:"AOP",igp:"IGP",bio:"Bio",saint:"Saint",sainte:"Sainte",st:"St",ste:"Ste"};return e.trim().replace(/\s+/g," ").toLowerCase().split(" ").map((e,t)=>e.includes("'")?e.split("'").map((e,r)=>0===r&&["d","l","c","n","s","t"].includes(e)?e:0===t||r>0?s[e]||e.charAt(0).toUpperCase()+e.slice(1):a.includes(e)?e:s[e]||e.charAt(0).toUpperCase()+e.slice(1)).join("'"):0===t?s[e]||e.charAt(0).toUpperCase()+e.slice(1):s[e]?s[e]:a.includes(e)?e:e.charAt(0).toUpperCase()+e.slice(1)).join(" ").trim()};function y({open:e,onClose:a,onLotCreated:s}){let[i,n]=(0,r.useState)(1),[c,y]=(0,r.useState)(""),[x,j]=(0,r.useState)([]),[v,D]=(0,r.useState)(!1),[b,N]=(0,r.useState)(null),[C,k]=(0,r.useState)(!1),[w,E]=(0,r.useState)([]),[S,q]=(0,r.useState)(!1),[M,$]=(0,r.useState)({qty_remaining:1,unit:"unit\xe9s",storage_method:"pantry",storage_place:"Garde-manger",expiration_date:""}),z=(0,r.useRef)(null),A=(0,r.useRef)(null);(0,r.useRef)(null);let P=(0,h.createClientComponentClient)(),[L,F]=(0,r.useState)([]),T=(0,r.useCallback)((e,a)=>{if(a){let e=a.toLowerCase();if(e.includes("camembert")||e.includes("brie")||e.includes("roquefort")||e.includes("rocamadour")||e.includes("gruy\xe8re")||e.includes("emmental")||e.includes("fromage"))return"\uD83E\uDDC0"}if(e&&w.length>0){let a=w.find(a=>a.id===e);if(a?.icon)return a.icon}if(a){let e=a.toLowerCase();for(let[a,s]of Object.entries({camembert:"\uD83E\uDDC0",brie:"\uD83E\uDDC0",roquefort:"\uD83E\uDDC0",gruyère:"\uD83E\uDDC0",emmental:"\uD83E\uDDC0",cheddar:"\uD83E\uDDC0",mozzarella:"\uD83E\uDDC0",parmesan:"\uD83E\uDDC0",chèvre:"\uD83E\uDDC0",feta:"\uD83E\uDDC0",bleu:"\uD83E\uDDC0",comté:"\uD83E\uDDC0",fromage:"\uD83E\uDDC0",tomate:"\uD83C\uDF45",pomme:"\uD83C\uDF4E",carotte:"\uD83E\uDD55","pomme de terre":"\uD83E\uDD54",banane:"\uD83C\uDF4C",fraise:"\uD83C\uDF53",orange:"\uD83C\uDF4A",citron:"\uD83C\uDF4B",brocoli:"\uD83E\uDD66",oignon:"\uD83E\uDDC5",ail:"�",salade:"�",courgette:"\uD83E\uDD52",aubergine:"�",poivron:"\uD83E\uDED1",radis:"\uD83E\uDD55",champignon:"\uD83C\uDF44",shiitake:"\uD83C\uDF44",cèpe:"\uD83C\uDF44",mousseron:"\uD83C\uDF44",lait:"\uD83E\uDD5B",yaourt:"\uD83E\uDD5B",crème:"\uD83E\uDD5B",beurre:"�",oeuf:"\uD83E\uDD5A",viande:"\uD83E\uDD69",boeuf:"\uD83E\uDD69",porc:"\uD83E\uDD69",poulet:"\uD83C\uDF57",poisson:"\uD83D\uDC1F",saumon:"\uD83D\uDC1F",thon:"\uD83D\uDC1F",pain:"\uD83C\uDF5E",riz:"\uD83C\uDF5A",pâtes:"\uD83C\uDF5D",blé:"\uD83C\uDF3E",quinoa:"\uD83C\uDF3E",avoine:"\uD83C\uDF3E",orge:"\uD83C\uDF3E"}))if(e.includes(a))return s}return"\uD83D\uDCE6"},[w]),O=(0,r.useCallback)((e,a=null,s=null)=>{if(s){let e=s.toLowerCase();if(e.includes("camembert")||e.includes("brie")||e.includes("roquefort")||e.includes("rocamadour")||e.includes("gruy\xe8re")||e.includes("emmental")||e.includes("fromage"))return{name:"Fromages",class:"category-fromages"};if(e.includes("champignon")||e.includes("shiitake")||e.includes("c\xe8pe")||e.includes("mousseron"))return{name:"Champignons",class:"category-champignons"};if(e.includes("viande")||e.includes("poulet")||e.includes("boeuf"))return{name:"Viandes",class:"category-viandes"};if(e.includes("p\xe2tes")||e.includes("riz")||e.includes("pain")||e.includes("pomme de terre")||e.includes("quinoa")||e.includes("bl\xe9"))return{name:"F\xe9culents",class:"category-feculents"}}if(a&&L.length>0){let e=L.find(e=>e.id===a);if(e?.label)return{name:e.label,class:"category-default"}}if(e&&w.length>0){let a=w.find(a=>a.id===e);if(a?.name)return{name:a.name,class:({Fruits:"category-fruits",Légumes:"category-legumes",Champignons:"category-champignons"})[a.name]||"category-default"}}return{name:"Alimentation",class:"category-default"}},[w,L]),R=(0,r.useCallback)((e,a)=>{let s=7;e&&(s="fridge"===a?e.shelf_life_days_fridge||7:"freezer"===a?e.shelf_life_days_freezer||90:e.shelf_life_days_pantry||30);let t=new Date;return t.setDate(t.getDate()+s),t.toISOString().split("T")[0]},[]);(0,r.useCallback)(async e=>{q(!0),D(!0),x.length>0&&await new Promise(e=>setTimeout(e,150));let a=(e||"").trim().toLowerCase();try{if(!a||0===a.length){let{data:e}=await P.from("canonical_foods").select(`
            id, canonical_name, category_id, subcategory_id, keywords, primary_unit,
            shelf_life_days_pantry, shelf_life_days_fridge, shelf_life_days_freezer
          `).order("id").limit(3);if(e){let a=e.map(e=>({id:e.id,name:e.canonical_name,type:"canonical",category_id:e.category_id,subcategory_id:e.subcategory_id,matchScore:50,primary_unit:e.primary_unit||"unit\xe9s",shelf_life_days_pantry:e.shelf_life_days_pantry,shelf_life_days_fridge:e.shelf_life_days_fridge,shelf_life_days_freezer:e.shelf_life_days_freezer,icon:T(e.category_id,e.canonical_name)})).slice(0,3);j(a)}D(!1);return}let e=[],s=new Set,{data:t}=await P.from("canonical_foods").select(`
          id, canonical_name, category_id, subcategory_id, keywords, primary_unit,
          shelf_life_days_pantry, shelf_life_days_fridge, shelf_life_days_freezer
        `).or(`canonical_name.ilike.%${a}%,keywords.cs.{${a}}`).limit(20),r=t||[];r&&r.forEach(a=>{s.has(a.canonical_name.toLowerCase())||(e.push({...a,type:"canonical",source_name:a.canonical_name,subcategory_id:a.subcategory_id}),s.add(a.canonical_name.toLowerCase()))});try{let{data:t}=await P.from("archetypes").select(`
            id, name, canonical_food_id, shelf_life_days,
            canonical_foods!inner(canonical_name, category_id, primary_unit, keywords)
          `).ilike("name",`%${a}%`).limit(20);t&&t.forEach(a=>{let t=a.name.toLowerCase();s.has(t)||(e.push({id:`arch_${a.id}`,canonical_name:a.name,category_id:a.canonical_foods?.category_id,primary_unit:a.canonical_foods?.primary_unit||"unit\xe9s",shelf_life_days_pantry:a.shelf_life_days,shelf_life_days_fridge:a.shelf_life_days,shelf_life_days_freezer:10*a.shelf_life_days,keywords:a.canonical_foods?.keywords,type:"archetype",source_name:a.name}),s.add(t))})}catch(e){console.log("Pas de table archetypes:",e)}try{let{data:t}=await P.from("cultivars").select(`
            id, cultivar_name, canonical_food_id,
            canonical_foods!inner(canonical_name, category_id, primary_unit, keywords,
              shelf_life_days_pantry, shelf_life_days_fridge, shelf_life_days_freezer)
          `).ilike("cultivar_name",`%${a}%`).limit(20);t&&t.forEach(a=>{let t=a.cultivar_name.toLowerCase();s.has(t)||(e.push({id:`cult_${a.id}`,canonical_name:a.cultivar_name,category_id:a.canonical_foods?.category_id,primary_unit:a.canonical_foods?.primary_unit||"unit\xe9s",shelf_life_days_pantry:a.canonical_foods?.shelf_life_days_pantry,shelf_life_days_fridge:a.canonical_foods?.shelf_life_days_fridge,shelf_life_days_freezer:a.canonical_foods?.shelf_life_days_freezer,keywords:a.canonical_foods?.keywords,type:"cultivar",source_name:a.cultivar_name}),s.add(t))})}catch(e){console.log("Pas de table cultivars:",e)}let i=e.map(e=>{let s=e.source_name.toLowerCase(),t=0;if(s===a)t=100;else if(s.startsWith(a))t=90;else if(s.includes(a))t=70;else{let e=_(a,s),r=Math.max(a.length,s.length);a.length,s.length;let i=(r-e)/r;i>.7&&2>=Math.abs(a.length-s.length)&&(t=Math.floor(60*i),"camambert"===a&&"camembert"===s&&(t=90))}return e.keywords&&Array.isArray(e.keywords)&&e.keywords.some(e=>e.toLowerCase().includes(a)||2>=_(a,e.toLowerCase()))&&(t+=15),"canonical"===e.type?t+=5:"cultivar"===e.type&&(t+=3),{id:e.id,name:e.source_name,type:e.type,category_id:e.category_id,subcategory_id:e.subcategory_id,matchScore:t,primary_unit:e.primary_unit||"unit\xe9s",shelf_life_days_pantry:e.shelf_life_days_pantry||30,shelf_life_days_fridge:e.shelf_life_days_fridge||7,shelf_life_days_freezer:e.shelf_life_days_freezer||90,icon:T(e.category_id,e.source_name)}}).filter(e=>e.matchScore>0).sort((e,a)=>a.matchScore-e.matchScore).slice(0,3);if(i.length<3){let{data:e}=await P.from("canonical_foods").select(`
            id, canonical_name, category_id, primary_unit,
            shelf_life_days_pantry, shelf_life_days_fridge, shelf_life_days_freezer
          `).order("id").limit(3-i.length);if(e){let a=new Set(i.map(e=>e.name.toLowerCase()));e.forEach(e=>{a.has(e.canonical_name.toLowerCase())||i.push({id:e.id,name:e.canonical_name,type:"canonical",category_id:e.category_id,matchScore:25,primary_unit:e.primary_unit||"unit\xe9s",shelf_life_days_pantry:e.shelf_life_days_pantry||30,shelf_life_days_fridge:e.shelf_life_days_fridge||7,shelf_life_days_freezer:e.shelf_life_days_freezer||90,icon:T(e.category_id,e.canonical_name)})})}}setTimeout(()=>{j(i.slice(0,3)),q(!1)},100)}catch(e){console.error("Erreur recherche:",e);try{let{data:e}=await P.from("canonical_foods").select("id, canonical_name, category_id, primary_unit").limit(3);if(e){let a=e.map(e=>({id:e.id,name:e.canonical_name,type:"canonical",category_id:e.category_id,matchScore:20,primary_unit:e.primary_unit||"unit\xe9s",shelf_life_days_pantry:30,shelf_life_days_fridge:7,shelf_life_days_freezer:90,icon:T(e.category_id,e.canonical_name)}));setTimeout(()=>{j(a),q(!1)},100)}}catch(e){console.error("Erreur fallback:",e),setTimeout(()=>{j([]),q(!1)},100)}}finally{D(!1)}},[P,T,x.length]);let I=e=>{switch(e){case"kg":return .1;case"g":case"ml":case"cl":return 100;default:return .5}},B=e=>{let a;let s=I(M.unit),t=parseFloat(M.qty_remaining)||0;a="up"===e?t+s:Math.max(s,t-s),"kg"===M.unit?a=Math.round(10*a)/10:"unit\xe9s"===M.unit&&(a=Math.round(2*a)/2),$(e=>({...e,qty_remaining:a}))},U=e=>{N(e);let a=e.primary_unit||"unit\xe9s",s=R(e,M.storage_method);$(e=>({...e,unit:a,qty_remaining:1,expiration_date:s})),n(2)},G=e=>{let a="Garde-manger";"fridge"===e&&(a="R\xe9frig\xe9rateur"),"freezer"===e&&(a="Cong\xe9lateur");let s=R(b,e);$(t=>({...t,storage_method:e,storage_place:a,expiration_date:s}))},Z=async()=>{if(!b||!M.qty_remaining){g.A.warning("Veuillez s\xe9lectionner un produit et entrer une quantit\xe9");return}k(!0);try{let e=parseFloat(M.qty_remaining)||1,t=null;if("cultivar"===b.type){let e=b.id.toString().replace("cult_","");t=parseInt(e,10)}else if("archetype"===b.type){let e=b.id.toString().replace("arch_","");t=parseInt(e,10)}else t="custom"===b.type?null:parseInt(b.id,10);let r={canonical_food_id:"canonical"===b.type?t:null,qty_remaining:e,initial_qty:e,unit:M.unit,storage_method:M.storage_method,storage_place:M.storage_place,expiration_date:M.expiration_date||null,acquired_on:new Date().toISOString().split("T")[0],notes:"custom"===b.type?b.name:null};console.log("Donn\xe9es \xe0 ins\xe9rer:",r);let{data:i,error:n}=await P.from("inventory_lots").insert([r]).select().single();if(n){console.error("Erreur Supabase:",n),g.A.error(`Erreur lors de la cr\xe9ation: ${n.message}`);return}console.log("Lot cr\xe9\xe9:",i),g.A.success(`${f(b.name)} ajout\xe9 au garde-manger !`),s?.(i),a()}catch(e){console.error("Erreur cr\xe9ation lot:",e),g.A.error("Erreur lors de la cr\xe9ation du lot")}finally{k(!1)}};return e?t.jsx("div",{className:"modal-overlay",onClick:a,children:(0,t.jsxs)("div",{ref:z,className:"modal-container",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsxs)("div",{className:"header-title",children:[t.jsx(l.Z,{size:20}),"Ajouter un produit"]}),t.jsx("button",{onClick:a,className:"close-btn",children:t.jsx(o.Z,{size:18})})]}),(0,t.jsxs)("div",{className:"modal-body",children:[1===i&&t.jsx(t.Fragment,{children:(0,t.jsxs)("div",{className:"search-section",children:[t.jsx("div",{className:"search-wrapper",children:t.jsx("input",{ref:A,type:"text",placeholder:"Rechercher un produit...",value:c,onChange:e=>y(e.target.value),className:"search-input"})}),v&&t.jsx("div",{className:"search-loading",children:"Recherche..."}),(0,t.jsxs)("div",{className:`search-results ${S?"transitioning":""}`,children:[x.map(e=>(0,t.jsxs)("div",{className:"product-item",onClick:()=>U(e),children:[t.jsx("span",{className:"product-icon",children:e.icon}),(0,t.jsxs)("div",{className:"product-info",children:[t.jsx("span",{className:"product-name",children:f(e.name)}),t.jsx("span",{className:`product-category-badge ${O(e.category_id,e.subcategory_id,e.name).class}`,children:O(e.category_id,e.subcategory_id,e.name).name})]})]},`${e.type}-${e.id}`)),!v&&0===x.length&&c&&(0,t.jsxs)("div",{className:"no-results",children:[(0,t.jsxs)("div",{children:['Aucun produit trouv\xe9 pour "',c,'"']}),t.jsx("div",{className:"no-results-tip",children:"Voulez-vous cr\xe9er ce produit ?"}),(0,t.jsxs)("button",{onClick:()=>U({id:"custom",name:c,type:"custom",category_id:null,primary_unit:"unit\xe9s",shelf_life_days_pantry:7,shelf_life_days_fridge:7,shelf_life_days_freezer:90,icon:"\uD83D\uDCE6"}),className:"create-custom-btn",children:['✨ Cr\xe9er "',c,'"']})]}),!v&&0===x.length&&!c&&t.jsx("div",{className:"no-results",children:"Chargement des suggestions..."})]})]})}),2===i&&b&&(()=>{let e=function(e={}){let a={...e};if(e.productName){let s=e.productName.toLowerCase();for(let[e,t]of Object.entries({banane:{grams_per_unit:120,primary_unit:"u"},pomme:{grams_per_unit:150,primary_unit:"u"},orange:{grams_per_unit:200,primary_unit:"u"},carotte:{grams_per_unit:80,primary_unit:"u"},lait:{density_g_per_ml:1.03,primary_unit:"ml"},eau:{density_g_per_ml:1,primary_unit:"ml"},huile:{density_g_per_ml:.9,primary_unit:"ml"}}))if(s.includes(e)){Object.assign(a,t);break}}let s=[{value:"g",label:"Grammes"},{value:"kg",label:"Kilogrammes"},{value:"ml",label:"Millilitres"},{value:"cl",label:"Centilitres"},{value:"l",label:"Litres"},{value:"u",label:"Pi\xe8ce(s)"}],t=!!a.density_g_per_ml,r=!!a.grams_per_unit,i=(a.primary_unit||"").toLowerCase(),n=[];return"g"===i||"kg"===i?(n.push("g","kg"),t&&n.push("ml","cl","l"),r&&n.push("u")):"ml"===i||"cl"===i||"l"===i?(n.push("ml","cl","l"),t&&n.push("g","kg"),r&&n.push("u")):"u"===i||"unit\xe9s"===i||"pi\xe8ce"===i?(n.push("u"),r&&n.push("g","kg"),t&&n.push("ml","cl","l")):n=s.map(e=>e.value),n=[...new Set(n)],s.filter(e=>n.includes(e.value))}(b);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"selected-product-card",children:[t.jsx("span",{className:"product-icon-large",children:T(b.category_id,b.name)}),(0,t.jsxs)("div",{className:"product-details",children:[t.jsx("div",{className:"product-name",children:f(b.name)}),t.jsx("div",{className:"product-category",children:b.subcategory||"G\xe9n\xe9ral"})]}),t.jsx("button",{onClick:()=>n(1),className:"change-btn",children:"Changer"})]}),(0,t.jsxs)("div",{className:"form-section",children:[(0,t.jsxs)("div",{className:"quantity-section",children:[t.jsx("label",{children:"Quantit\xe9"}),(0,t.jsxs)("div",{className:"quantity-controls",children:[t.jsx("button",{onClick:()=>B("down"),className:"qty-btn",children:"-"}),t.jsx("input",{type:"number",value:M.qty_remaining,onChange:e=>$(a=>({...a,qty_remaining:parseFloat(e.target.value)||0})),className:"qty-input",step:I(M.unit),min:"0"}),t.jsx("button",{onClick:()=>B("up"),className:"qty-btn",children:"+"})]})]}),(0,t.jsxs)("div",{className:"unit-section",children:[t.jsx("label",{children:"Unit\xe9"}),t.jsx("select",{value:M.unit,onChange:e=>$(a=>({...a,unit:e.target.value})),className:"unit-select",children:e.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{className:"storage-section",children:[t.jsx("label",{children:"Stockage"}),(0,t.jsxs)("div",{className:"storage-methods",children:[(0,t.jsxs)("button",{onClick:()=>G("pantry"),className:`storage-btn ${"pantry"===M.storage_method?"active":""}`,children:[t.jsx(d,{size:16}),"Garde-manger"]}),(0,t.jsxs)("button",{onClick:()=>G("fridge"),className:`storage-btn ${"fridge"===M.storage_method?"active":""}`,children:[t.jsx(u,{size:16}),"Frigo"]}),(0,t.jsxs)("button",{onClick:()=>G("freezer"),className:`storage-btn ${"freezer"===M.storage_method?"active":""}`,children:[t.jsx(m,{size:16}),"Cong\xe9lateur"]})]})]}),(0,t.jsxs)("div",{className:"expiration-section",children:[t.jsx("label",{children:"Date d'expiration"}),(0,t.jsxs)("div",{className:"expiration-input",children:[t.jsx(p,{size:16,className:"calendar-icon"}),t.jsx("input",{type:"date",value:M.expiration_date,onChange:e=>$(a=>({...a,expiration_date:e.target.value})),className:"date-input"})]})]})]})]})})()]}),t.jsx("div",{className:"modal-footer",children:2===i&&(0,t.jsxs)(t.Fragment,{children:[t.jsx("button",{onClick:()=>n(1),className:"back-btn",children:"Retour"}),t.jsx("button",{onClick:Z,disabled:C,className:"create-btn",children:C?"Cr\xe9ation...":"Cr\xe9er le lot"})]})})]})}):null}let x=e=>{if(!e)return"";let a=["de","du","des","le","la","les","au","aux","et","ou","en"];return e.toLowerCase().split(/[\s-]+/).map((e,s)=>0!==s&&a.includes(e)?e:e.charAt(0).toUpperCase()+e.slice(1)).join(" ")};function j({item:e,onConsume:a,onEdit:s,onDelete:i,onUpdateQuantity:n,onOpen:l}){var o,c;let[d,u]=(0,r.useState)(!1),[m,p]=(0,r.useState)(!1),h={productName:e.product_name,grams_per_unit:e.grams_per_unit,density_g_per_ml:e.density_g_per_ml,primary_unit:e.primary_unit},g=function(e,a,s={}){let t={...s};console.log("Conversion pour:",{productName:s.productName,qty:e,currentUnit:a,density:s.density_g_per_ml,gramsPerUnit:s.grams_per_unit});let r=[],i=Number(t.density_g_per_ml)||0,n=Number(t.grams_per_unit)||0,l=n>0,o=i>0;if(!l&&!o)return console.log("Pas de m\xe9tadonn\xe9es disponibles pour les conversions"),[];let c=a?.toLowerCase();function d(e){return e>=1e3?{unit:"kg",qty:Math.round(e/1e3*100)/100,label:`${Math.round(e/1e3*100)/100} kg`}:{unit:"g",qty:Math.round(e),label:`${Math.round(e)} g`}}if(l){if("u"===c||"pi\xe8ce"===c||"pi\xe8ces"===c||"unit\xe9s"===c){let a=d(e*n);r.push(a)}if("g"===c){let a=Math.round(e/n*10)/10;a>=.1&&r.push({unit:"u",qty:a,label:1===a?"1 pi\xe8ce":`${a} pi\xe8ces`}),e>=1e3&&r.push({unit:"kg",qty:Math.round(e/1e3*100)/100,label:`${Math.round(e/1e3*100)/100} kg`})}if("kg"===c){let a=1e3*e;e<1&&r.push({unit:"g",qty:Math.round(a),label:`${Math.round(a)} g`});let s=Math.round(a/n*10)/10;s>=.1&&r.push({unit:"u",qty:s,label:1===s?"1 pi\xe8ce":`${s} pi\xe8ces`})}}if(o&&!l){if("ml"===c||"cl"===c||"l"===c){let a=e;"cl"===c&&(a=10*e),"l"===c&&(a=1e3*e);let s=d(Math.round(a*i));r.push(s),"ml"===c&&a>=1e3?r.push({unit:"L",qty:Math.round(a/1e3*100)/100,label:`${Math.round(a/1e3*100)/100} L`}):"l"===c&&a<1&&r.push({unit:"mL",qty:Math.round(1e3*a),label:`${Math.round(1e3*a)} mL`})}if("g"===c||"kg"===c){var u;let a=e;"kg"===c&&(a=1e3*e);let s=(u=Math.round(a/i))>=1e3?{unit:"L",qty:Math.round(u/1e3*100)/100,label:`${Math.round(u/1e3*100)/100} L`}:u>=100?{unit:"cL",qty:Math.round(u/10),label:`${Math.round(u/10)} cL`}:{unit:"mL",qty:Math.round(u),label:`${Math.round(u)} mL`};r.push(s),"g"===c&&a>=1e3?r.push({unit:"kg",qty:Math.round(a/1e3*100)/100,label:`${Math.round(a/1e3*100)/100} kg`}):"kg"===c&&a<1e3&&r.push({unit:"g",qty:Math.round(a),label:`${Math.round(a)} g`})}}return r}(e.qty_remaining,e.unit,h);d&&(console.log(`--- CARD DEBUG pour "${e.product_name}" ---`),console.log("Donn\xe9es item brutes:",{unit_weight_grams:e.unit_weight_grams,grams_per_unit:e.grams_per_unit,density_g_per_ml:e.density_g_per_ml,qty_remaining:e.qty_remaining,unit:e.unit}),console.log("ProductMeta calcul\xe9:",h),console.log("Conversions trouv\xe9es:",g),console.log("--- FIN DEBUG ---"));let _=async a=>{if(l&&!m){a.stopPropagation(),p(!0);try{await l(e.id)}finally{p(!1)}}},f=e=>e?new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"short"}):null,y=(e,a)=>{a.stopPropagation(),e(),u(!1)};return(0,t.jsxs)("div",{className:"product-card",onClick:()=>{u(!d)},style:{cursor:"pointer"},children:[(0,t.jsxs)("div",{className:"card-header",children:[t.jsx("h3",{children:x(e.product_name)||"Sans nom"}),e.category_name&&t.jsx("span",{className:"category-badge",children:e.category_name})]}),(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"info-row",children:[t.jsx("span",{className:"info-icon",children:"\uD83D\uDCE6"}),(0,t.jsxs)("div",{className:"quantity-section",children:[(0,t.jsxs)("span",{className:"info-value",children:[e.qty_remaining||0," ",e.unit||"unit\xe9"]}),d&&g.length>0&&t.jsx("div",{className:"quick-conversions",children:g.map((a,s)=>(0,t.jsxs)("button",{className:"conversion-btn",onClick:s=>{s.stopPropagation(),n&&"function"==typeof n&&n(e.id,a.qty,a.unit)},title:`Convertir en ${a.label}`,children:["↔ ",a.label]},s))})]})]}),(0,t.jsxs)("div",{className:"info-row",children:[t.jsx("span",{className:"info-icon",children:"\uD83D\uDCCD"}),t.jsx("span",{className:"info-value",children:e.storage_place||"Non sp\xe9cifi\xe9"})]}),t.jsx("div",{className:"info-row",children:t.jsx("span",{className:`status-badge ${(e=>{switch(e){case"expired":return"status-expired";case"expiring_soon":return"status-expiring";default:return"status-good"}})(e.expiration_status)}`,children:(o=e.expiration_status,c=e.days_until_expiration,o&&"no_date"!==o?"expired"===o?`Expir\xe9 depuis ${Math.abs(c)}j`:"expiring_soon"===o?`Expire dans ${c}j`:`${c}j restants`:"\uD83D\uDCC5 Pas de date")})}),e.expiration_date&&(0,t.jsxs)("div",{className:"info-row",children:[t.jsx("span",{className:"info-icon",children:"\uD83D\uDDD3️"}),t.jsx("span",{className:"info-value",children:f(e.expiration_date)}),e.is_opened&&e.adjusted_expiration_date&&(0,t.jsxs)("span",{className:"dlc-adjusted",title:"DLC ajust\xe9e apr\xe8s ouverture",children:["→ ",f(e.adjusted_expiration_date)]})]}),e.is_opened&&t.jsx("div",{className:"info-row",children:(0,t.jsxs)("span",{className:"opened-badge",children:["✅ Ouvert le ",f(e.opened_at)]})})]}),d&&(0,t.jsxs)("div",{className:"card-actions",children:[!e.is_opened&&l&&(0,t.jsxs)("button",{className:"action-btn open",onClick:_,disabled:m,title:"Marquer comme ouvert (ajuste la date de p\xe9remption)",children:[m?"⏳":"\uD83D\uDCE6"," ",m?"Ouverture...":"Ouvrir"]}),t.jsx("button",{className:"action-btn consume",onClick:e=>y(a,e),children:"✓ Consommer"}),t.jsx("button",{className:"action-btn edit",onClick:e=>y(s,e),children:"✏️ Modifier"}),t.jsx("button",{className:"action-btn delete",onClick:e=>y(i,e),children:"\uD83D\uDDD1️ Supprimer"})]})]})}function v({isOpen:e,onClose:a,onConfirm:s,title:r="Confirmer l'action",message:i="\xcates-vous s\xfbr de vouloir continuer ?",confirmText:n="Confirmer",cancelText:l="Annuler"}){return e?t.jsx("div",{className:"confirm-overlay",onClick:a,children:(0,t.jsxs)("div",{className:"confirm-dialog",onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{className:"confirm-title",children:r}),t.jsx("p",{className:"confirm-message",children:i}),(0,t.jsxs)("div",{className:"confirm-actions",children:[t.jsx("button",{className:"confirm-btn cancel-btn",onClick:a,children:l}),t.jsx("button",{className:"confirm-btn confirm-btn-primary",onClick:()=>{s(),a()},children:n})]})]})}):null}s(9197);let D=(0,c.Z)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),b=(0,c.Z)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);s(8948);let N=[{value:"garde-manger",label:"Garde-manger",icon:"\uD83C\uDFE0",factor:1},{value:"r\xe9frig\xe9rateur",label:"R\xe9frig\xe9rateur",icon:"❄️",factor:2},{value:"cong\xe9lateur",label:"Cong\xe9lateur",icon:"\uD83E\uDDCA",factor:10},{value:"cave",label:"Cave",icon:"\uD83C\uDFDB️",factor:1.5},{value:"placard",label:"Placard",icon:"\uD83D\uDEAA",factor:1}],C=["u","g","kg","mL","cL","L"];function k({item:e,onUpdate:a,onCancel:s}){let[i,n]=(0,r.useState)(e.qty_remaining),[l,c]=(0,r.useState)(e.unit),[d,u]=(0,r.useState)(e.storage_place||"garde-manger"),m=e.expiration_date?e.expiration_date.split("T")[0]:"",h=e.storage_place||"garde-manger",g=new Date(e.created_at||Date.now()),[_,f]=(0,r.useState)(m),[y,x]=(0,r.useState)(!1),[j,v]=(0,r.useState)(!1),k=e.density_g_per_ml||0,w=e.grams_per_unit||0,E=a=>{if(e.canonical_foods){let s=e.canonical_foods;switch(a){case"r\xe9frig\xe9rateur":return s.shelf_life_days_fridge||2*s.shelf_life_days_pantry;case"cong\xe9lateur":return s.shelf_life_days_freezer||30*s.shelf_life_days_pantry;case"garde-manger":case"placard":return s.shelf_life_days_pantry||7;case"cave":return 1.5*s.shelf_life_days_pantry||10;default:return 7}}else if(e.cultivars){let s=e.cultivars;switch(a){case"r\xe9frig\xe9rateur":return s.shelf_life_days_fridge||2*s.shelf_life_days_pantry;case"cong\xe9lateur":return s.shelf_life_days_freezer||30*s.shelf_life_days_pantry;case"garde-manger":case"placard":return s.shelf_life_days_pantry||7;case"cave":return 1.5*s.shelf_life_days_pantry||10;default:return 7}}else if(e.archetypes){let s=e.archetypes;switch(a){case"r\xe9frig\xe9rateur":return s.shelf_life_days_fridge||2*s.shelf_life_days_pantry;case"cong\xe9lateur":return s.shelf_life_days_freezer||30*s.shelf_life_days_pantry;case"garde-manger":case"placard":return s.shelf_life_days_pantry||7;case"cave":return 1.5*s.shelf_life_days_pantry||10;default:return 7}}switch(a){case"r\xe9frig\xe9rateur":return 14;case"cong\xe9lateur":return 365;case"garde-manger":case"placard":default:return 7;case"cave":return 30}},S=e=>{let a=new Date,s=E(h),t=E(e),r=new Date(a);return r.setDate(a.getDate()+Math.max(0,Math.round(t*(1-Math.min(Math.floor((a-g)/864e5)/s,1))))),r.toISOString().split("T")[0]},q=e=>{let a=e!==h;u(e),a?(f(S(e)),v(!0),setTimeout(()=>v(!1),1500)):f(m)},M=e=>{let a=l.toLowerCase(),s=e.toLowerCase(),t=i;if(w>0&&("u"===a&&"g"===s?t=Math.round(i*w):"g"===a&&"u"===s?t=Math.round(i/w*10)/10:"u"===a&&"kg"===s?t=Math.round(i*w/1e3*100)/100:"kg"===a&&"u"===s?t=Math.round(1e3*i/w*10)/10:"g"===a&&"kg"===s?t=Math.round(i/1e3*100)/100:"kg"===a&&"g"===s&&(t=Math.round(1e3*i))),k>0){if(["ml","cl","l"].includes(a)&&["g","kg"].includes(s)){let e=i;"cl"===a&&(e*=10),"l"===a&&(e*=1e3);let r=e*k;t="kg"===s?Math.round(r/1e3*100)/100:Math.round(r)}else if(["g","kg"].includes(a)&&["ml","cl","l"].includes(s)){let e=i;"kg"===a&&(e*=1e3);let r=e/k;t="l"===s?Math.round(r/1e3*100)/100:"cl"===s?Math.round(r/10):Math.round(r)}else if(["ml","cl","l"].includes(a)&&["ml","cl","l"].includes(s)){let e=i;"cl"===a&&(e*=10),"l"===a&&(e*=1e3),t="l"===s?Math.round(e/1e3*100)/100:"cl"===s?Math.round(e/10):Math.round(e)}else["g","kg"].includes(a)&&["g","kg"].includes(s)&&("g"===a&&"kg"===s?t=Math.round(i/1e3*100)/100:"kg"===a&&"g"===s&&(t=Math.round(1e3*i)))}c(e),n(t),t!==i&&(x(!0),setTimeout(()=>x(!1),1e3))};return t.jsx("div",{className:"modal-overlay",onClick:s,children:(0,t.jsxs)("div",{className:"modal-container",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsxs)("div",{className:"header-title",children:[t.jsx(D,{size:16}),"Modifier ",e.product_name]}),t.jsx("button",{className:"close-btn",onClick:s,children:t.jsx(o.Z,{size:16})})]}),(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"form-section",children:[(0,t.jsxs)("div",{className:"section-header",children:[t.jsx(D,{size:16}),t.jsx("span",{children:"Quantit\xe9"})]}),(0,t.jsxs)("div",{className:"quantity-controls",children:[(0,t.jsxs)("div",{className:"quantity-input-wrapper",children:[t.jsx("button",{type:"button",className:"qty-btn minus",onClick:()=>{let e="u"===l?1:.1;n(a=>Math.max(0,Math.round((a-e)*10)/10))},disabled:i<=0,children:"−"}),t.jsx("input",{type:"number",value:i,onChange:e=>n(parseFloat(e.target.value)||0),className:`qty-input ${y?"converted":""}`,step:"0.1",min:"0"}),t.jsx("button",{type:"button",className:"qty-btn plus",onClick:()=>{let e="u"===l?1:.1;n(a=>Math.round((a+e)*10)/10)},children:"+"})]}),t.jsx("div",{className:"unit-selector",children:C.map(e=>t.jsx("button",{type:"button",className:`unit-btn ${l===e?"active":""}`,onClick:()=>M(e),children:e},e))})]})]}),(0,t.jsxs)("div",{className:"form-section",children:[(0,t.jsxs)("div",{className:"section-header",children:[t.jsx(b,{size:16}),t.jsx("span",{children:"Emplacement"})]}),t.jsx("div",{className:"location-grid",children:N.map(e=>{let a=E(h),s=E(e.value),r=s>a,i=s<a,n=e.value===h;return(0,t.jsxs)("button",{type:"button",className:`location-btn ${d===e.value?"selected":""} ${r&&!n?"extends-life":""} ${i&&!n?"shortens-life":""}`,onClick:()=>q(e.value),title:n?"Emplacement d'origine":r?`Conservation plus longue (${Math.round(s)} jours)`:i?`Conservation plus courte (${Math.round(s)} jours)`:`M\xeame dur\xe9e de conservation (${Math.round(s)} jours)`,children:[t.jsx("span",{className:"location-icon",children:e.icon}),t.jsx("span",{className:"location-label",children:e.label}),(0,t.jsxs)("div",{className:"shelf-life-info",children:[Math.round(s),"j"]}),r&&!n&&t.jsx("span",{className:"duration-indicator",children:"+"}),i&&!n&&t.jsx("span",{className:"duration-indicator",children:"-"})]},e.value)})})]}),(0,t.jsxs)("div",{className:"form-section",children:[(0,t.jsxs)("div",{className:"section-header",children:[t.jsx(p,{size:16}),t.jsx("span",{children:"Date d'expiration (optionnelle)"})]}),t.jsx("input",{type:"date",value:_,onChange:e=>f(e.target.value),className:`date-input ${j?"date-adjusted":""}`,min:new Date().toISOString().split("T")[0]}),j&&(0,t.jsxs)("div",{className:"date-adjustment-notice",children:["\uD83D\uDCC5 Date ajust\xe9e automatiquement pour ",N.find(e=>e.value===d)?.label]})]}),(0,t.jsxs)("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"action-btn secondary",onClick:s,children:"Annuler"}),t.jsx("button",{type:"button",className:"action-btn primary",onClick:()=>{i>0&&a(e.id,{qty_remaining:i,unit:l,storage_place:d,expiration_date:_||null})},disabled:i<=0,children:"Sauvegarder"})]})]})]})})}function w({activeTab:e,onTabChange:a,stats:s}){let r=[{id:"inventory",label:"Inventaire",icon:"\uD83D\uDCE6",badge:s?.totalProducts||0,description:"Tous vos produits"},{id:"waste",label:"\xc0 Risque",icon:"⚠️",badge:s?.atRiskCount||0,badgeColor:s?.atRiskCount>0?"warning":"default",description:"Produits qui expirent"},{id:"stats",label:"Statistiques",icon:"\uD83D\uDCCA",description:"Vue d'ensemble"}];return t.jsx("div",{className:"pantry-tabs-container",children:t.jsx("div",{className:"pantry-tabs",children:r.map(s=>(0,t.jsxs)("button",{className:`pantry-tab ${e===s.id?"active":""}`,onClick:()=>a(s.id),children:[t.jsx("span",{className:"tab-icon",children:s.icon}),(0,t.jsxs)("div",{className:"tab-content",children:[t.jsx("span",{className:"tab-label",children:s.label}),t.jsx("span",{className:"tab-description",children:s.description})]}),void 0!==s.badge&&t.jsx("span",{className:`tab-badge ${s.badgeColor||"default"}`,children:s.badge})]},s.id))})})}function E({dish:e,onConsume:a,onChangeStorage:s,onDelete:i,onRefresh:n}){let[l,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),p=e=>e?new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A",h=()=>e.days_until_expiration<=0?"expired":e.days_until_expiration<=1?"urgent":e.days_until_expiration<=3?"warning":"good",g=async s=>{if(a&&!c){s.stopPropagation(),d(!0);try{await a(e.id,1)}finally{d(!1)}}},_=async a=>{if(!s||u)return;a.stopPropagation();let t="freezer"===e.storage_method?"fridge":"freezer";m(!0);try{await s(e.id,t)}finally{m(!1)}},f=async a=>{i&&(a.stopPropagation(),confirm(`Supprimer le plat "${e.name}" ?`)&&await i(e.id))};return(0,t.jsxs)("div",{className:"cooked-dish-card",onClick:()=>o(!l),children:[(0,t.jsxs)("div",{className:"dish-header",children:[e.recipe?.image_url?t.jsx("div",{className:"dish-image",style:{backgroundImage:`url(${e.recipe.image_url})`}}):t.jsx("div",{className:"dish-image-placeholder",children:"\uD83C\uDF7D️"}),(0,t.jsxs)("div",{className:"dish-info",children:[t.jsx("h3",{className:"dish-name",children:e.name}),e.recipe?.title&&(0,t.jsxs)("span",{className:"dish-recipe",children:["\uD83D\uDCD6 ",e.recipe.title]})]}),t.jsx("div",{className:`urgency-badge ${h()}`,children:e.days_until_expiration<=0?"Expir\xe9":`${e.days_until_expiration}j`})]}),(0,t.jsxs)("div",{className:"dish-body",children:[(0,t.jsxs)("div",{className:"dish-detail",children:[t.jsx("span",{className:"detail-icon",children:"\uD83C\uDF7D️"}),t.jsx("span",{className:"detail-label",children:"Portions:"}),(0,t.jsxs)("span",{className:"detail-value portions-indicator",children:[e.portions_remaining," / ",e.portions_cooked]})]}),(0,t.jsxs)("div",{className:"dish-detail",children:[t.jsx("span",{className:"detail-icon",children:(()=>{switch(e.storage_method){case"fridge":return"❄️";case"freezer":return"\uD83E\uDDCA";case"counter":return"\uD83C\uDFE0";default:return"\uD83D\uDCE6"}})()}),t.jsx("span",{className:"detail-label",children:"Stockage:"}),t.jsx("span",{className:"detail-value",children:(()=>{switch(e.storage_method){case"fridge":return"Frigo";case"freezer":return"Cong\xe9lateur";case"counter":return"Comptoir";default:return"Inconnu"}})()})]}),(0,t.jsxs)("div",{className:"dish-detail",children:[t.jsx("span",{className:"detail-icon",children:"\uD83D\uDCC5"}),t.jsx("span",{className:"detail-label",children:"Cuisin\xe9 le:"}),t.jsx("span",{className:"detail-value",children:p(e.cooked_at)})]}),(0,t.jsxs)("div",{className:"dish-detail",children:[t.jsx("span",{className:"detail-icon",children:"⏰"}),t.jsx("span",{className:"detail-label",children:"Expire le:"}),t.jsx("span",{className:`detail-value ${h()}`,children:p(e.expiration_date)})]}),e.notes&&(0,t.jsxs)("div",{className:"dish-notes",children:[t.jsx("span",{className:"detail-icon",children:"\uD83D\uDCDD"}),t.jsx("span",{className:"notes-text",children:e.notes})]})]}),t.jsx("div",{className:"portions-progress",children:t.jsx("div",{className:"portions-progress-bar",style:{width:`${e.portions_remaining/e.portions_cooked*100}%`}})}),l&&(0,t.jsxs)("div",{className:"dish-actions",children:[(0,t.jsxs)("button",{className:"action-btn consume",onClick:g,disabled:c||0===e.portions_remaining,title:"Manger 1 portion",children:[c?"⏳":"\uD83C\uDF74"," ",c?"Manger...":"Manger"]}),(0,t.jsxs)("button",{className:"action-btn freeze",onClick:_,disabled:u,title:"freezer"===e.storage_method?"Mettre au frigo":"Congeler",children:[u?"⏳":"freezer"===e.storage_method?"❄️":"\uD83E\uDDCA",u?"D\xe9placement...":"freezer"===e.storage_method?"D\xe9congeler":"Congeler"]}),t.jsx("button",{className:"action-btn delete",onClick:f,title:"Supprimer ce plat",children:"\uD83D\uDDD1️ Supprimer"})]})]})}function S({userId:e,onActionComplete:a}){let[s,i]=(0,r.useState)([]),[n,l]=(0,r.useState)(!0),[o,c]=(0,r.useState)("all"),d=async()=>{try{l(!0);let e=new URLSearchParams;e.append("onlyWithPortions","true"),"expiring"===o&&e.append("expiringInDays","3");let a=await fetch(`/api/cooked-dishes?${e.toString()}`),s=await a.json();s.success?i(s.dishes||[]):(console.error("Erreur chargement plats:",s.error),i([]))}catch(e){console.error("Erreur:",e),i([])}finally{l(!1)}},u=async(e,s)=>{try{let t=await fetch(`/api/cooked-dishes/${e}/consume`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({portions:s})}),r=await t.json();r.success?(await d(),a&&a(),r.fullyConsumed&&console.log("\uD83C\uDF89",r.message)):alert(r.error||"Erreur lors de la consommation")}catch(e){console.error("Erreur:",e),alert("Erreur lors de la consommation")}},m=async(e,s)=>{try{let t=await fetch(`/api/cooked-dishes/${e}/storage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storageMethod:s})}),r=await t.json();r.success?(await d(),a&&a(),console.log("✅",r.message)):alert(r.error||"Erreur lors du changement de stockage")}catch(e){console.error("Erreur:",e),alert("Erreur lors du changement de stockage")}},p=async e=>{try{let s=await fetch(`/api/cooked-dishes/${e}`,{method:"DELETE"}),t=await s.json();t.success?(await d(),a&&a(),console.log("✅",t.message)):alert(t.error||"Erreur lors de la suppression")}catch(e){console.error("Erreur:",e),alert("Erreur lors de la suppression")}};return n?(0,t.jsxs)("div",{className:"cooked-dishes-loading",children:[t.jsx("div",{className:"spinner"}),t.jsx("p",{children:"Chargement des plats cuisin\xe9s..."})]}):(0,t.jsxs)("div",{className:"cooked-dishes-manager",children:[(0,t.jsxs)("div",{className:"cooked-dishes-header",children:[(0,t.jsxs)("div",{className:"header-title",children:[t.jsx("h2",{children:"\uD83C\uDF7D️ Plats Cuisin\xe9s"}),(0,t.jsxs)("span",{className:"dishes-count",children:[s.length," ",s.length>1?"plats":"plat"]})]}),(0,t.jsxs)("div",{className:"filter-buttons",children:[t.jsx("button",{className:`filter-btn ${"all"===o?"active":""}`,onClick:()=>c("all"),children:"Tous"}),t.jsx("button",{className:`filter-btn ${"expiring"===o?"active":""}`,onClick:()=>c("expiring"),children:"⚠️ \xc0 finir (3j)"})]})]}),0===s.length?(0,t.jsxs)("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-icon",children:"\uD83C\uDF7D️"}),t.jsx("h3",{children:"Aucun plat cuisin\xe9"}),t.jsx("p",{children:"expiring"===o?"Aucun plat ne p\xe9rime dans les 3 prochains jours":"Commencez par cuisiner un plat et il appara\xeetra ici"})]}):t.jsx("div",{className:"dishes-grid",children:s.map(e=>t.jsx(E,{dish:e,onConsume:u,onChangeStorage:m,onDelete:p},e.id))})]})}s(6665),s(9670),s(4002),s(893);let q={CRITIQUE:"#ef4444",URGENT:"#f97316",ATTENTION:"#f59e0b",BIENTÔT:"#eab308",NORMAL:"#84cc16",FRAIS:"#22c55e"},M={freeze:"\uD83E\uDDCA",preserve:"\uD83E\uDD6B",cook:"\uD83D\uDC68‍\uD83C\uDF73",transform:"\uD83D\uDD04",share:"\uD83E\uDD1D",consumed:"✅"};function $({userId:e}){let[a,s]=(0,r.useState)(!0),[i,n]=(0,r.useState)(null),[l,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[u,m]=(0,r.useState)("all"),[p,h]=(0,r.useState)("grid"),[g,_]=(0,r.useState)(null),[f,y]=(0,r.useState)(null);async function x(){s(!0);try{let a=await fetch("/api/restes/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,daysThreshold:7,includeOpened:!0,includeStats:!0,includeRecipeSuggestions:!0})});if(!a.ok)throw Error("Erreur lors de l'analyse");let s=await a.json();n(s.analysis),o(s.recipeSuggestions),d(s.stats)}catch(e){console.error("Erreur:",e),alert("Erreur lors du chargement de l'analyse")}finally{s(!1)}}async function j(a,s){y(a.lotId);try{let t=await fetch("/api/restes/action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,lotId:a.lotId,actionType:s,quantitySaved:a.quantity,notes:`Action sur ${a.productName}`})});if(!t.ok)throw Error("Erreur lors de l'action");let r=await t.json();alert(r.message),await x()}catch(e){console.error("Erreur:",e),alert("Erreur lors de l'action")}finally{y(null)}}let v=(0,r.useMemo)(()=>i?.risks?"all"===u?i.risks:"critical"===u?i.risks.filter(e=>"CRITIQUE"===e.urgency.level):"urgent"===u?i.risks.filter(e=>"URGENT"===e.urgency.level):"warning"===u?i.risks.filter(e=>"ATTENTION"===e.urgency.level):i.risks:[],[i,u]);return a?(0,t.jsxs)("div",{className:"restes-manager loading",children:[t.jsx("div",{className:"spinner"}),t.jsx("p",{children:"Analyse en cours..."})]}):i&&0!==i.risks.length?(0,t.jsxs)("div",{className:"restes-manager",children:[(0,t.jsxs)("div",{className:"restes-header",children:[(0,t.jsxs)("div",{className:"header-title",children:[t.jsx("h1",{children:"\uD83D\uDDD1️ Gestion Anti-Gaspillage"}),t.jsx("p",{className:"header-subtitle",children:i.summary.message})]}),(0,t.jsxs)("div",{className:"header-stats",children:[t.jsx(z,{icon:"⚠️",label:"\xc0 risque",value:i.stats.totalAtRisk,color:"#ef4444"}),t.jsx(z,{icon:"\uD83D\uDD25",label:"Critiques",value:i.stats.criticalCount,color:"#f97316"}),t.jsx(z,{icon:"⏰",label:"Urgents",value:i.stats.urgentCount,color:"#f59e0b"}),c&&(0,t.jsxs)(t.Fragment,{children:[t.jsx(z,{icon:"\uD83D\uDCB0",label:"\xc9conomis\xe9",value:`${c.estimatedMoneySaved}€`,color:"#22c55e"}),t.jsx(z,{icon:"\uD83C\uDF0D",label:"CO₂ \xe9vit\xe9",value:`${c.co2Saved}kg`,color:"#16a34a"})]})]})]}),(0,t.jsxs)("div",{className:"restes-controls",children:[(0,t.jsxs)("div",{className:"filter-buttons",children:[(0,t.jsxs)("button",{className:`filter-btn ${"all"===u?"active":""}`,onClick:()=>m("all"),children:["Tous (",i.risks.length,")"]}),(0,t.jsxs)("button",{className:`filter-btn ${"critical"===u?"active":""}`,onClick:()=>m("critical"),children:["\uD83D\uDD25 Critiques (",i.stats.criticalCount,")"]}),(0,t.jsxs)("button",{className:`filter-btn ${"urgent"===u?"active":""}`,onClick:()=>m("urgent"),children:["⏰ Urgents (",i.stats.urgentCount,")"]}),(0,t.jsxs)("button",{className:`filter-btn ${"warning"===u?"active":""}`,onClick:()=>m("warning"),children:["⚠️ Attention (",i.stats.warningCount,")"]})]}),(0,t.jsxs)("div",{className:"view-toggle",children:[t.jsx("button",{className:`view-btn ${"grid"===p?"active":""}`,onClick:()=>h("grid"),title:"Vue grille",children:"▦"}),t.jsx("button",{className:`view-btn ${"list"===p?"active":""}`,onClick:()=>h("list"),title:"Vue liste",children:"☰"})]})]}),t.jsx("h2",{className:"ingredients-section-title",children:"\uD83E\uDD6B Ingr\xe9dients \xe0 Risque"}),t.jsx("div",{className:`restes-list ${p}`,children:v.map(e=>t.jsx(A,{risk:e,expanded:g===e.lotId,onToggle:()=>_(g===e.lotId?null:e.lotId),onAction:a=>j(e,a),isProcessing:f===e.lotId},e.lotId))}),t.jsx("div",{className:"cooked-dishes-section",children:t.jsx(S,{userId:e,onActionComplete:x})}),l&&l.suggestions.length>0&&(0,t.jsxs)("div",{className:"recipe-suggestions",children:[t.jsx("h2",{children:"\uD83D\uDCA1 Recettes sugg\xe9r\xe9es"}),t.jsx("p",{className:"suggestions-subtitle",children:l.message}),t.jsx("div",{className:"suggestions-list",children:l.suggestions.slice(0,5).map(e=>t.jsx(P,{suggestion:e},e.recipeId))})]})]}):t.jsx("div",{className:"restes-manager empty",children:(0,t.jsxs)("div",{className:"empty-state",children:[t.jsx("span",{className:"empty-icon",children:"\uD83C\uDF89"}),t.jsx("h2",{children:"Aucun produit \xe0 risque !"}),t.jsx("p",{children:"Tous vos produits sont en bon \xe9tat. Continuez ainsi !"}),c&&(0,t.jsxs)("div",{className:"empty-stats",children:[(0,t.jsxs)("p",{children:["Ce mois-ci, vous avez sauv\xe9 ",(0,t.jsxs)("strong",{children:[c.quantitySaved,"kg"]})," de nourriture"]}),(0,t.jsxs)("p",{children:["\xc9conomies: ",(0,t.jsxs)("strong",{children:[c.estimatedMoneySaved,"€"]})," | CO₂ \xe9vit\xe9: ",(0,t.jsxs)("strong",{children:[c.co2Saved,"kg"]})]})]})]})})}function z({icon:e,label:a,value:s,color:r}){return(0,t.jsxs)("div",{className:"stat-card",children:[t.jsx("span",{className:"stat-icon",style:{color:r},children:e}),(0,t.jsxs)("div",{className:"stat-content",children:[t.jsx("div",{className:"stat-value",style:{color:r},children:s}),t.jsx("div",{className:"stat-label",children:a})]})]})}function A({risk:e,expanded:a,onToggle:s,onAction:r,isProcessing:i}){let n=q[e.urgency.level]||"#6b7280";return(0,t.jsxs)("div",{className:"risk-card",style:{borderLeftColor:n},children:[(0,t.jsxs)("div",{className:"risk-header",onClick:s,children:[(0,t.jsxs)("div",{className:"risk-main",children:[(0,t.jsxs)("div",{className:"risk-product",children:[t.jsx("span",{className:"product-name",children:e.productName}),e.isOpened&&t.jsx("span",{className:"opened-badge",children:"\uD83D\uDCE6 Ouvert"})]}),(0,t.jsxs)("div",{className:"risk-info",children:[(0,t.jsxs)("span",{className:"quantity",children:[e.quantity," ",e.unit]}),(0,t.jsxs)("span",{className:"location",children:[e.locationIcon," ",e.location]})]})]}),(0,t.jsxs)("div",{className:"risk-urgency",children:[t.jsx("div",{className:"urgency-badge",style:{backgroundColor:n},children:e.urgency.level}),t.jsx("div",{className:"days-left",children:e.daysLeft<0?t.jsx("span",{className:"expired",children:"P\xc9RIM\xc9"}):0===e.daysLeft?t.jsx("span",{className:"today",children:"Expire aujourd'hui"}):1===e.daysLeft?t.jsx("span",{className:"tomorrow",children:"Expire demain"}):(0,t.jsxs)("span",{children:["Dans ",e.daysLeft,"j"]})}),(0,t.jsxs)("div",{className:"urgency-score",children:["Score: ",e.urgency.score,"/100"]})]}),t.jsx("button",{className:"expand-btn",onClick:e=>{e.stopPropagation(),s()},children:a?"▼":"▶"})]}),a&&(0,t.jsxs)("div",{className:"risk-details",children:[(0,t.jsxs)("div",{className:"recommendation",children:[t.jsx("strong",{children:"Recommandation:"}),t.jsx("p",{children:e.recommendation})]}),(0,t.jsxs)("div",{className:"actions",children:[t.jsx("h4",{children:"Actions possibles:"}),(0,t.jsxs)("div",{className:"action-buttons",children:[e.actions.map(e=>(0,t.jsxs)("button",{className:"action-btn",onClick:()=>r(e.id),disabled:i,title:e.description,children:[M[e.id]," ",e.label]},e.id)),t.jsx("button",{className:"action-btn consumed",onClick:()=>r("consumed"),disabled:i,children:"✅ Consomm\xe9"})]})]}),i&&(0,t.jsxs)("div",{className:"processing",children:[t.jsx("div",{className:"spinner-small"}),t.jsx("span",{children:"Action en cours..."})]})]})]})}function P({suggestion:e}){return(0,t.jsxs)("div",{className:"recipe-suggestion-card",children:[(0,t.jsxs)("div",{className:"suggestion-header",children:[t.jsx("h3",{children:e.recipeName}),(0,t.jsxs)("div",{className:"match-badge",children:[e.matchCount," produit",e.matchCount>1?"s":""]})]}),e.description&&t.jsx("p",{className:"suggestion-description",children:e.description}),(0,t.jsxs)("div",{className:"suggestion-meta",children:[(0,t.jsxs)("span",{children:["⏱️ ",e.prepTime+e.cookTime," min"]}),(0,t.jsxs)("span",{children:["\uD83D\uDC65 ",e.servings," pers."]}),(0,t.jsxs)("span",{children:["\uD83D\uDCCA Score: ",Math.round(e.urgencyScore)]})]}),(0,t.jsxs)("div",{className:"suggestion-products",children:[t.jsx("strong",{children:"Produits utilis\xe9s:"}),t.jsx("div",{className:"products-tags",children:e.matchingProducts.map((e,a)=>t.jsx("span",{className:"product-tag",children:e},a))})]}),(0,t.jsxs)("div",{className:"suggestion-impact",children:[(0,t.jsxs)("span",{children:["\uD83D\uDCB0 ≈ ",e.wasteReduction.estimatedValue,"€ sauv\xe9s"]}),(0,t.jsxs)("span",{children:["\uD83C\uDF0D ≈ ",e.wasteReduction.co2,"kg CO₂"]})]}),t.jsx("button",{className:"view-recipe-btn",children:"Voir la recette →"})]})}function L(){(0,i.useRouter)(),(0,i.useSearchParams)();let[e,a]=(0,r.useState)([]),[s,l]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(!1),[m,p]=(0,r.useState)(""),[h,g]=(0,r.useState)("all"),[_,f]=(0,r.useState)("expiration"),[x,D]=(0,r.useState)("asc"),[b,N]=(0,r.useState)(!1),[C,E]=(0,r.useState)(null),[S,q]=(0,r.useState)(!1),[M,z]=(0,r.useState)(null),[A,P]=(0,r.useState)(!1),[L,F]=(0,r.useState)("inventory"),[T,O]=(0,r.useState)(null);async function R(){if(!A){P(!0),c(!0);try{let{data:e,error:s}=await n.OQ.from("inventory_lots").select("*").order("expiration_date",{ascending:!0,nullsLast:!0});if(s)throw console.error("Erreur lors du chargement des lots:",s),s;if(e&&e.length>0){let a=e.filter(e=>e.canonical_food_id).map(e=>e.canonical_food_id);if(a.length>0){let{data:s,error:t}=await n.OQ.from("canonical_foods").select("id, canonical_name, density_g_per_ml, unit_weight_grams, shelf_life_days_pantry").in("id",a);if(!t&&s){let a={};s.forEach(e=>{a[e.id]=e}),e=e.map(e=>e.canonical_food_id&&a[e.canonical_food_id]?{...e,canonical_foods:a[e.canonical_food_id]}:e)}}}let t=(e||[]).map(e=>{let a="Produit sans nom";return e.canonical_food_id&&e.canonical_foods?.canonical_name?a=e.canonical_foods.canonical_name:e.notes?a=e.notes.split("\n")[0]:e.product_name&&(a=e.product_name),{...e,product_name:a,expiration_status:function(e){if(!e)return"no_date";let a=new Date,s=new Date(e),t=Math.ceil((s-a)/864e5);return t<0?"expired":t<=3?"expiring_soon":"good"}(e.expiration_date),days_until_expiration:function(e){if(!e)return null;let a=new Date,s=new Date(e);return Math.ceil((s-a)/864e5)}(e.expiration_date),grams_per_unit:e.canonical_foods?.unit_weight_grams||null,density_g_per_ml:e.canonical_foods?.density_g_per_ml||null,primary_unit:e.unit}});a(t)}catch(e){console.error("Erreur lors du chargement:",e),a([])}finally{c(!1),P(!1)}}}async function I(s){let t;let r=e.find(e=>e.id===s);if(!r)return;let i=r.qty_remaining;t="u"===r.unit?1:"kg"===r.unit?i>=2?.5:i>=1?.2:.1:"g"===r.unit?i>=1e3?100:i>=500?50:i>=100?20:10:"L"===r.unit?i>=2?.5:i>=1?.2:.1:"mL"===r.unit?i>=1e3?100:i>=500?50:25:.1;let l=Math.max(0,Math.round((i-t)*100)/100);if(0===l){Z(s);return}a(e=>e.map(e=>e.id===s?{...e,qty_remaining:l}:e));try{let{error:e}=await n.OQ.from("inventory_lots").update({qty_remaining:l}).eq("id",s);e&&(console.error("Erreur lors de la consommation:",e),await R())}catch(e){console.error("Erreur:",e),await R()}}async function B(e){try{let a=await fetch("/api/lots/manage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"open",lotId:e})}),s=await a.json();if(!a.ok){console.error("Erreur lors de l'ouverture du produit:",s.error),alert(s.error||"Erreur lors de l'ouverture du produit");return}s.success&&(await R(),s.message&&console.log("✅",s.message))}catch(e){console.error("Erreur lors de l'ouverture:",e),alert("Erreur lors de l'ouverture du produit")}}async function U(e,s){console.log("Mise \xe0 jour lot:",{id:e,updates:s}),q(!1),z(null),a(a=>a.map(a=>a.id===e?{...a,qty_remaining:parseFloat(s.qty_remaining),unit:s.unit,storage_place:s.storage_place,expiration_date:s.expiration_date}:a));try{let{error:a}=await n.OQ.from("inventory_lots").update({qty_remaining:parseFloat(s.qty_remaining),unit:s.unit,storage_place:s.storage_place,expiration_date:s.expiration_date}).eq("id",e);if(a)throw console.error("Erreur Supabase lors de la mise \xe0 jour:",a),a;console.log("Mise \xe0 jour r\xe9ussie en base de donn\xe9es")}catch(e){console.error("Erreur lors de la mise \xe0 jour:",e),alert("Erreur lors de la mise \xe0 jour: "+e.message),await R()}}async function G(e,a,s){return U(e,{qty_remaining:a,unit:s})}function Z(a){E(e.find(e=>e.id===a)),N(!0)}async function V(){if(!C)return;let e=C.id;a(a=>a.filter(a=>a.id!==e));try{let{error:a}=await n.OQ.from("inventory_lots").delete().eq("id",e);a?(console.error("Erreur lors de la suppression:",a),await R(),alert("Erreur lors de la suppression: "+a.message)):console.log("Article supprim\xe9 avec succ\xe8s")}catch(e){console.error("Erreur:",e),await R()}}function Q(){u(!1),R()}let W={totalProducts:e.length,atRiskCount:e.filter(e=>"expired"===e.expiration_status||"expiring_soon"===e.expiration_status).length};return o?(0,t.jsxs)("div",{className:"pantry-loading",children:[t.jsx("div",{className:"loading-spinner"}),t.jsx("p",{children:"Chargement du garde-manger..."})]}):(0,t.jsxs)("div",{className:"pantry-container",children:[t.jsx(w,{activeTab:L,onTabChange:F,stats:W}),"inventory"===L&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"pantry-controls",children:[(0,t.jsxs)("div",{className:"top-row",children:[t.jsx("input",{type:"text",placeholder:"Rechercher un produit...",value:m,onChange:e=>p(e.target.value),className:"search-input"}),(0,t.jsxs)("div",{className:"stats-filter",children:[(0,t.jsxs)("button",{className:`stat-filter-btn ${"all"===h?"active":""}`,onClick:()=>g("all"),title:"Afficher tous les articles",children:[t.jsx("span",{className:"stat-number",children:e.length}),t.jsx("span",{className:"stat-label",children:"TOUT"})]}),(0,t.jsxs)("button",{className:`stat-filter-btn expired ${"expired"===h?"active":""}`,onClick:()=>g("expired"===h?"all":"expired"),title:"Afficher uniquement les produits expir\xe9s",children:[t.jsx("span",{className:"stat-number",children:e.filter(e=>"expired"===e.expiration_status).length}),t.jsx("span",{className:"stat-label",children:"EXPIR\xc9S"})]}),(0,t.jsxs)("button",{className:`stat-filter-btn expiring ${"expiring_soon"===h?"active":""}`,onClick:()=>g("expiring_soon"===h?"all":"expiring_soon"),title:"Afficher uniquement les produits qui expirent bient\xf4t",children:[t.jsx("span",{className:"stat-number",children:e.filter(e=>"expiring_soon"===e.expiration_status).length}),t.jsx("span",{className:"stat-label",children:"EXPIRE BIENT\xd4T"})]}),(0,t.jsxs)("button",{className:`stat-filter-btn good ${"good"===h?"active":""}`,onClick:()=>g("good"===h?"all":"good"),title:"Afficher uniquement les produits en bon \xe9tat",children:[t.jsx("span",{className:"stat-number",children:e.filter(e=>"good"===e.expiration_status).length}),t.jsx("span",{className:"stat-label",children:"BON \xc9TAT"})]})]})]}),(0,t.jsxs)("div",{className:"sort-controls",children:[t.jsx("span",{className:"sort-label",children:"Trier par :"}),(0,t.jsxs)("div",{className:"sort-options",children:[(0,t.jsxs)("button",{className:`sort-btn ${"expiration"===_?"active":""}`,onClick:()=>{"expiration"===_?D("asc"===x?"desc":"asc"):(f("expiration"),D("asc"))},children:["\uD83D\uDCC5 Expiration ","expiration"===_&&("asc"===x?"↗️":"↘️")]}),(0,t.jsxs)("button",{className:`sort-btn ${"quantity"===_?"active":""}`,onClick:()=>{"quantity"===_?D("asc"===x?"desc":"asc"):(f("quantity"),D("desc"))},children:["\uD83D\uDCE6 Quantit\xe9 ","quantity"===_&&("asc"===x?"↗️":"↘️")]}),(0,t.jsxs)("button",{className:`sort-btn ${"name"===_?"active":""}`,onClick:()=>{"name"===_?D("asc"===x?"desc":"asc"):(f("name"),D("asc"))},children:["\uD83D\uDD24 Nom ","name"===_&&("asc"===x?"↗️":"↘️")]}),(0,t.jsxs)("button",{className:`sort-btn ${"location"===_?"active":""}`,onClick:()=>{"location"===_?D("asc"===x?"desc":"asc"):(f("location"),D("asc"))},children:["\uD83D\uDCCD Emplacement ","location"===_&&("asc"===x?"↗️":"↘️")]})]}),s.length!==e.length&&(0,t.jsxs)("span",{className:"filter-count",children:[s.length," / ",e.length," articles"]})]})]}),t.jsx("div",{className:"pantry-grid",children:0===s.length?(0,t.jsxs)("div",{className:"empty-state",children:[t.jsx("h2",{children:"Aucun article trouv\xe9"}),t.jsx("p",{children:"Ajustez vos filtres ou ajoutez des articles"})]}):s.map(a=>t.jsx(j,{item:a,onConsume:()=>I(a.id),onEdit:()=>(function(a){let s=e.find(e=>e.id===a);s&&(z(s),q(!0))})(a.id),onDelete:()=>Z(a.id),onUpdateQuantity:G,onOpen:()=>B(a.id)},a.id))})]}),"waste"===L&&T&&t.jsx($,{userId:T,onActionComplete:R}),"stats"===L&&t.jsx("div",{className:"stats-view",children:(0,t.jsxs)("div",{className:"stats-content",style:{background:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(10px)",borderRadius:"16px",padding:"2rem",maxWidth:"800px",margin:"0 auto"},children:[t.jsx("h2",{style:{marginBottom:"2rem",color:"var(--forest-700)"},children:"\uD83D\uDCCA Vue d'ensemble"}),(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1.5rem"},children:[(0,t.jsxs)("div",{className:"stat-box",children:[t.jsx("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:"\uD83D\uDCE6"}),t.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"var(--forest-700)"},children:e.length}),t.jsx("div",{style:{fontSize:"0.9rem",color:"var(--earth-600)"},children:"Produits total"})]}),(0,t.jsxs)("div",{className:"stat-box",children:[t.jsx("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:"\uD83D\uDD25"}),t.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#ef4444"},children:e.filter(e=>"expired"===e.expiration_status).length}),t.jsx("div",{style:{fontSize:"0.9rem",color:"var(--earth-600)"},children:"Expir\xe9s"})]}),(0,t.jsxs)("div",{className:"stat-box",children:[t.jsx("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:"⏰"}),t.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#f97316"},children:e.filter(e=>"expiring_soon"===e.expiration_status).length}),t.jsx("div",{style:{fontSize:"0.9rem",color:"var(--earth-600)"},children:"Expire bient\xf4t"})]}),(0,t.jsxs)("div",{className:"stat-box",children:[t.jsx("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:"✅"}),t.jsx("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#22c55e"},children:e.filter(e=>"good"===e.expiration_status).length}),t.jsx("div",{style:{fontSize:"0.9rem",color:"var(--earth-600)"},children:"Bon \xe9tat"})]})]}),(0,t.jsxs)("div",{style:{marginTop:"2rem",padding:"1.5rem",background:"rgba(255, 255, 255, 0.5)",borderRadius:"12px"},children:[t.jsx("h3",{style:{marginBottom:"1rem",color:"var(--forest-700)"},children:"\uD83D\uDCA1 Conseil"}),t.jsx("p",{style:{color:"var(--earth-700)",lineHeight:"1.6"},children:W.atRiskCount>0?`Vous avez ${W.atRiskCount} produit(s) \xe0 risque. Consultez l'onglet "\xc0 Risque" pour des suggestions anti-gaspillage.`:"Excellent ! Aucun produit \xe0 risque pour le moment. Continuez comme \xe7a ! \uD83C\uDF89"})]})]})}),d&&t.jsx(y,{open:d,onClose:Q,onLotCreated:Q}),t.jsx("button",{className:"pantry-fab",onClick:()=>u(!0),title:"Ajouter un article",children:"+"}),t.jsx(v,{isOpen:b,onClose:()=>{N(!1),E(null)},onConfirm:V,title:"Supprimer l'article",message:`\xcates-vous s\xfbr de vouloir supprimer "${C?.product_name}" ?`,confirmText:"Supprimer",cancelText:"Annuler"}),S&&M&&t.jsx(k,{item:M,onUpdate:U,onCancel:()=>{q(!1),z(null)}})]})}s(1169)},3855:(e,a,s)=>{"use strict";s.d(a,{Z:()=>t});let t=(0,s(2881).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},4019:(e,a,s)=>{"use strict";s.d(a,{Z:()=>t});let t=(0,s(2881).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},592:(e,a,s)=>{"use strict";s.r(a),s.d(a,{$$typeof:()=>n,__esModule:()=>i,default:()=>l});var t=s(8570);let r=(0,t.createProxy)(String.raw`/workspaces/garde-manger-app/app/pantry/page.js`),{__esModule:i,$$typeof:n}=r;r.default;let l=(0,t.createProxy)(String.raw`/workspaces/garde-manger-app/app/pantry/page.js#default`)},9670:()=>{},4002:()=>{},8948:()=>{},6665:()=>{},318:()=>{},1169:()=>{},9197:()=>{},893:()=>{}};var a=require("../../webpack-runtime.js");a.C(e);var s=e=>a(a.s=e),t=a.X(0,[948,618,813,146],()=>s(7140));module.exports=t})();