(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[145],{913:function(e,a,t){Promise.resolve().then(t.bind(t,6525))},6525:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return F}});var s=t(7437),n=t(2265),i=t(6463),r=t(5626),l=t(2513),c=t(4697),o=t(8030);let d=(0,o.Z)("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),u=(0,o.Z)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]),m=(0,o.Z)("snowflake",[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]]),h=(0,o.Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);var p=t(4392),g=t(1430);t(5929);let f=(e,a)=>{let t=[];for(let e=0;e<=a.length;e++)t[e]=[e];for(let a=0;a<=e.length;a++)t[0][a]=a;for(let s=1;s<=a.length;s++)for(let n=1;n<=e.length;n++)a.charAt(s-1)===e.charAt(n-1)?t[s][n]=t[s-1][n-1]:t[s][n]=Math.min(t[s-1][n-1]+1,t[s][n-1]+1,t[s-1][n]+1);return t[a.length][e.length]},_=e=>{if(!e)return"";let a=["de","du","des","le","la","les","au","aux","en","et","ou","\xe0","avec","sans","pour","sur","sous","dans","par"],t={aoc:"AOC",aop:"AOP",igp:"IGP",bio:"Bio",saint:"Saint",sainte:"Sainte",st:"St",ste:"Ste"};return e.trim().replace(/\s+/g," ").toLowerCase().split(" ").map((e,s)=>e.includes("'")?e.split("'").map((e,n)=>0===n&&["d","l","c","n","s","t"].includes(e)?e:0===s||n>0?t[e]||e.charAt(0).toUpperCase()+e.slice(1):a.includes(e)?e:t[e]||e.charAt(0).toUpperCase()+e.slice(1)).join("'"):0===s?t[e]||e.charAt(0).toUpperCase()+e.slice(1):t[e]?t[e]:a.includes(e)?e:e.charAt(0).toUpperCase()+e.slice(1)).join(" ").trim()};function y(e){let{open:a,onClose:t,onLotCreated:i}=e,[r,o]=(0,n.useState)(1),[y,x]=(0,n.useState)(""),[v,j]=(0,n.useState)([]),[D,b]=(0,n.useState)(!1),[N,C]=(0,n.useState)(null),[k,w]=(0,n.useState)(!1),[E,S]=(0,n.useState)([]),[M,q]=(0,n.useState)(!1),[z,A]=(0,n.useState)({qty_remaining:1,unit:"unit\xe9s",storage_method:"pantry",storage_place:"Garde-manger",expiration_date:""}),L=(0,n.useRef)(null),T=(0,n.useRef)(null),F=(0,n.useRef)(null),I=(0,p.createClientComponentClient)(),[P,O]=(0,n.useState)([]);(0,n.useEffect)(()=>{(async()=>{try{let{data:e}=await I.from("reference_categories").select("id, name, icon, color_hex").order("sort_priority"),{data:a}=await I.from("reference_subcategories").select("id, category_id, code, label, icon");e&&S(e),a&&O(a)}catch(e){console.log("Erreur chargement cat\xe9gories:",e)}})()},[I]),(0,n.useEffect)(()=>{a&&(o(1),x(""),j([]),C(null),A({qty_remaining:1,unit:"unit\xe9s",storage_method:"pantry",storage_place:"Garde-manger",expiration_date:""}),setTimeout(()=>{var e;null===(e=T.current)||void 0===e||e.focus()},100))},[a]);let R=(0,n.useCallback)((e,a)=>{if(a){let e=a.toLowerCase();if(e.includes("camembert")||e.includes("brie")||e.includes("roquefort")||e.includes("rocamadour")||e.includes("gruy\xe8re")||e.includes("emmental")||e.includes("fromage"))return"\uD83E\uDDC0"}if(e&&E.length>0){let a=E.find(a=>a.id===e);if(null==a?void 0:a.icon)return a.icon}if(a){let e=a.toLowerCase();for(let[a,t]of Object.entries({camembert:"\uD83E\uDDC0",brie:"\uD83E\uDDC0",roquefort:"\uD83E\uDDC0",gruyère:"\uD83E\uDDC0",emmental:"\uD83E\uDDC0",cheddar:"\uD83E\uDDC0",mozzarella:"\uD83E\uDDC0",parmesan:"\uD83E\uDDC0",chèvre:"\uD83E\uDDC0",feta:"\uD83E\uDDC0",bleu:"\uD83E\uDDC0",comté:"\uD83E\uDDC0",fromage:"\uD83E\uDDC0",tomate:"\uD83C\uDF45",pomme:"\uD83C\uDF4E",carotte:"\uD83E\uDD55","pomme de terre":"\uD83E\uDD54",banane:"\uD83C\uDF4C",fraise:"\uD83C\uDF53",orange:"\uD83C\uDF4A",citron:"\uD83C\uDF4B",brocoli:"\uD83E\uDD66",oignon:"\uD83E\uDDC5",ail:"�",salade:"�",courgette:"\uD83E\uDD52",aubergine:"�",poivron:"\uD83E\uDED1",radis:"\uD83E\uDD55",champignon:"\uD83C\uDF44",shiitake:"\uD83C\uDF44",cèpe:"\uD83C\uDF44",mousseron:"\uD83C\uDF44",lait:"\uD83E\uDD5B",yaourt:"\uD83E\uDD5B",crème:"\uD83E\uDD5B",beurre:"�",oeuf:"\uD83E\uDD5A",viande:"\uD83E\uDD69",boeuf:"\uD83E\uDD69",porc:"\uD83E\uDD69",poulet:"\uD83C\uDF57",poisson:"\uD83D\uDC1F",saumon:"\uD83D\uDC1F",thon:"\uD83D\uDC1F",pain:"\uD83C\uDF5E",riz:"\uD83C\uDF5A",pâtes:"\uD83C\uDF5D",blé:"\uD83C\uDF3E",quinoa:"\uD83C\uDF3E",avoine:"\uD83C\uDF3E",orge:"\uD83C\uDF3E"}))if(e.includes(a))return t}return"\uD83D\uDCE6"},[E]),Z=(0,n.useCallback)(function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t){let e=t.toLowerCase();if(e.includes("camembert")||e.includes("brie")||e.includes("roquefort")||e.includes("rocamadour")||e.includes("gruy\xe8re")||e.includes("emmental")||e.includes("fromage"))return{name:"Fromages",class:"category-fromages"};if(e.includes("champignon")||e.includes("shiitake")||e.includes("c\xe8pe")||e.includes("mousseron"))return{name:"Champignons",class:"category-champignons"};if(e.includes("viande")||e.includes("poulet")||e.includes("boeuf"))return{name:"Viandes",class:"category-viandes"};if(e.includes("p\xe2tes")||e.includes("riz")||e.includes("pain")||e.includes("pomme de terre")||e.includes("quinoa")||e.includes("bl\xe9"))return{name:"F\xe9culents",class:"category-feculents"}}if(a&&P.length>0){let e=P.find(e=>e.id===a);if(null==e?void 0:e.label)return{name:e.label,class:"category-default"}}if(e&&E.length>0){let a=E.find(a=>a.id===e);if(null==a?void 0:a.name)return{name:a.name,class:({Fruits:"category-fruits",Légumes:"category-legumes",Champignons:"category-champignons"})[a.name]||"category-default"}}return{name:"Alimentation",class:"category-default"}},[E,P]),U=(0,n.useCallback)((e,a)=>{let t=7;e&&(t="fridge"===a?e.shelf_life_days_fridge||7:"freezer"===a?e.shelf_life_days_freezer||90:e.shelf_life_days_pantry||30);let s=new Date;return s.setDate(s.getDate()+t),s.toISOString().split("T")[0]},[]),B=(0,n.useCallback)(async e=>{q(!0),b(!0),v.length>0&&await new Promise(e=>setTimeout(e,150));let a=(e||"").trim().toLowerCase();try{if(!a||0===a.length){let{data:e}=await I.from("canonical_foods").select("\n            id, canonical_name, category_id, subcategory_id, keywords, primary_unit,\n            shelf_life_days_pantry, shelf_life_days_fridge, shelf_life_days_freezer\n          ").order("id").limit(3);if(e){let a=e.map(e=>({id:e.id,name:e.canonical_name,type:"canonical",category_id:e.category_id,subcategory_id:e.subcategory_id,matchScore:50,primary_unit:e.primary_unit||"unit\xe9s",shelf_life_days_pantry:e.shelf_life_days_pantry,shelf_life_days_fridge:e.shelf_life_days_fridge,shelf_life_days_freezer:e.shelf_life_days_freezer,icon:R(e.category_id,e.canonical_name)})).slice(0,3);j(a)}b(!1);return}let e=[],t=new Set,{data:s}=await I.from("canonical_foods").select("\n          id, canonical_name, category_id, subcategory_id, keywords, primary_unit,\n          shelf_life_days_pantry, shelf_life_days_fridge, shelf_life_days_freezer\n        ").or("canonical_name.ilike.%".concat(a,"%,keywords.cs.{").concat(a,"}")).limit(20),n=s||[];n&&n.forEach(a=>{t.has(a.canonical_name.toLowerCase())||(e.push({...a,type:"canonical",source_name:a.canonical_name,subcategory_id:a.subcategory_id}),t.add(a.canonical_name.toLowerCase()))});try{let{data:s}=await I.from("archetypes").select("\n            id, name, canonical_food_id, shelf_life_days,\n            canonical_foods!inner(canonical_name, category_id, primary_unit, keywords)\n          ").ilike("name","%".concat(a,"%")).limit(20);s&&s.forEach(a=>{let s=a.name.toLowerCase();if(!t.has(s)){var n,i,r;e.push({id:"arch_".concat(a.id),canonical_name:a.name,category_id:null===(n=a.canonical_foods)||void 0===n?void 0:n.category_id,primary_unit:(null===(i=a.canonical_foods)||void 0===i?void 0:i.primary_unit)||"unit\xe9s",shelf_life_days_pantry:a.shelf_life_days,shelf_life_days_fridge:a.shelf_life_days,shelf_life_days_freezer:10*a.shelf_life_days,keywords:null===(r=a.canonical_foods)||void 0===r?void 0:r.keywords,type:"archetype",source_name:a.name}),t.add(s)}})}catch(e){console.log("Pas de table archetypes:",e)}try{let{data:s}=await I.from("cultivars").select("\n            id, cultivar_name, canonical_food_id,\n            canonical_foods!inner(canonical_name, category_id, primary_unit, keywords,\n              shelf_life_days_pantry, shelf_life_days_fridge, shelf_life_days_freezer)\n          ").ilike("cultivar_name","%".concat(a,"%")).limit(20);s&&s.forEach(a=>{let s=a.cultivar_name.toLowerCase();if(!t.has(s)){var n,i,r,l,c,o;e.push({id:"cult_".concat(a.id),canonical_name:a.cultivar_name,category_id:null===(n=a.canonical_foods)||void 0===n?void 0:n.category_id,primary_unit:(null===(i=a.canonical_foods)||void 0===i?void 0:i.primary_unit)||"unit\xe9s",shelf_life_days_pantry:null===(r=a.canonical_foods)||void 0===r?void 0:r.shelf_life_days_pantry,shelf_life_days_fridge:null===(l=a.canonical_foods)||void 0===l?void 0:l.shelf_life_days_fridge,shelf_life_days_freezer:null===(c=a.canonical_foods)||void 0===c?void 0:c.shelf_life_days_freezer,keywords:null===(o=a.canonical_foods)||void 0===o?void 0:o.keywords,type:"cultivar",source_name:a.cultivar_name}),t.add(s)}})}catch(e){console.log("Pas de table cultivars:",e)}let i=e.map(e=>{let t=e.source_name.toLowerCase(),s=0;if(t===a)s=100;else if(t.startsWith(a))s=90;else if(t.includes(a))s=70;else{let e=f(a,t),n=Math.max(a.length,t.length);a.length,t.length;let i=(n-e)/n;i>.7&&2>=Math.abs(a.length-t.length)&&(s=Math.floor(60*i),"camambert"===a&&"camembert"===t&&(s=90))}return e.keywords&&Array.isArray(e.keywords)&&e.keywords.some(e=>e.toLowerCase().includes(a)||2>=f(a,e.toLowerCase()))&&(s+=15),"canonical"===e.type?s+=5:"cultivar"===e.type&&(s+=3),{id:e.id,name:e.source_name,type:e.type,category_id:e.category_id,subcategory_id:e.subcategory_id,matchScore:s,primary_unit:e.primary_unit||"unit\xe9s",shelf_life_days_pantry:e.shelf_life_days_pantry||30,shelf_life_days_fridge:e.shelf_life_days_fridge||7,shelf_life_days_freezer:e.shelf_life_days_freezer||90,icon:R(e.category_id,e.source_name)}}).filter(e=>e.matchScore>0).sort((e,a)=>a.matchScore-e.matchScore).slice(0,3);if(i.length<3){let{data:e}=await I.from("canonical_foods").select("\n            id, canonical_name, category_id, primary_unit,\n            shelf_life_days_pantry, shelf_life_days_fridge, shelf_life_days_freezer\n          ").order("id").limit(3-i.length);if(e){let a=new Set(i.map(e=>e.name.toLowerCase()));e.forEach(e=>{a.has(e.canonical_name.toLowerCase())||i.push({id:e.id,name:e.canonical_name,type:"canonical",category_id:e.category_id,matchScore:25,primary_unit:e.primary_unit||"unit\xe9s",shelf_life_days_pantry:e.shelf_life_days_pantry||30,shelf_life_days_fridge:e.shelf_life_days_fridge||7,shelf_life_days_freezer:e.shelf_life_days_freezer||90,icon:R(e.category_id,e.canonical_name)})})}}setTimeout(()=>{j(i.slice(0,3)),q(!1)},100)}catch(e){console.error("Erreur recherche:",e);try{let{data:e}=await I.from("canonical_foods").select("id, canonical_name, category_id, primary_unit").limit(3);if(e){let a=e.map(e=>({id:e.id,name:e.canonical_name,type:"canonical",category_id:e.category_id,matchScore:20,primary_unit:e.primary_unit||"unit\xe9s",shelf_life_days_pantry:30,shelf_life_days_fridge:7,shelf_life_days_freezer:90,icon:R(e.category_id,e.canonical_name)}));setTimeout(()=>{j(a),q(!1)},100)}}catch(e){console.error("Erreur fallback:",e),setTimeout(()=>{j([]),q(!1)},100)}}finally{b(!1)}},[I,R,v.length]);(0,n.useEffect)(()=>{a&&1===r&&setTimeout(()=>{B("")},200)},[a,r,B]),(0,n.useEffect)(()=>(F.current&&clearTimeout(F.current),F.current=setTimeout(()=>{B(y)},0===y.length?0:300),()=>{F.current&&clearTimeout(F.current)}),[y,B]);let G=e=>{switch(e){case"kg":return .1;case"g":case"ml":case"cl":return 100;default:return .5}},V=e=>{let a;let t=G(z.unit),s=parseFloat(z.qty_remaining)||0;a="up"===e?s+t:Math.max(t,s-t),"kg"===z.unit?a=Math.round(10*a)/10:"unit\xe9s"===z.unit&&(a=Math.round(2*a)/2),A(e=>({...e,qty_remaining:a}))},Q=e=>{C(e);let a=e.primary_unit||"unit\xe9s",t=U(e,z.storage_method);A(e=>({...e,unit:a,qty_remaining:1,expiration_date:t})),o(2)},J=e=>{let a="Garde-manger";"fridge"===e&&(a="R\xe9frig\xe9rateur"),"freezer"===e&&(a="Cong\xe9lateur");let t=U(N,e);A(s=>({...s,storage_method:e,storage_place:a,expiration_date:t}))},W=async()=>{if(!N||!z.qty_remaining){g.A.warning("Veuillez s\xe9lectionner un produit et entrer une quantit\xe9");return}w(!0);try{let e=parseFloat(z.qty_remaining)||1,a=null;if("cultivar"===N.type){let e=N.id.toString().replace("cult_","");a=parseInt(e,10)}else if("archetype"===N.type){let e=N.id.toString().replace("arch_","");a=parseInt(e,10)}else a="custom"===N.type?null:parseInt(N.id,10);let s={canonical_food_id:"canonical"===N.type?a:null,qty_remaining:e,initial_qty:e,unit:z.unit,storage_method:z.storage_method,storage_place:z.storage_place,expiration_date:z.expiration_date||null,acquired_on:new Date().toISOString().split("T")[0],notes:"custom"===N.type?N.name:null};console.log("Donn\xe9es \xe0 ins\xe9rer:",s);let{data:n,error:r}=await I.from("inventory_lots").insert([s]).select().single();if(r){console.error("Erreur Supabase:",r),g.A.error("Erreur lors de la cr\xe9ation: ".concat(r.message));return}console.log("Lot cr\xe9\xe9:",n),g.A.success("".concat(_(N.name)," ajout\xe9 au garde-manger !")),null==i||i(n),t()}catch(e){console.error("Erreur cr\xe9ation lot:",e),g.A.error("Erreur lors de la cr\xe9ation du lot")}finally{w(!1)}};return a?(0,s.jsx)("div",{className:"modal-overlay",onClick:t,children:(0,s.jsxs)("div",{ref:L,className:"modal-container",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"modal-header",children:[(0,s.jsxs)("div",{className:"header-title",children:[(0,s.jsx)(l.Z,{size:20}),"Ajouter un produit"]}),(0,s.jsx)("button",{onClick:t,className:"close-btn",children:(0,s.jsx)(c.Z,{size:18})})]}),(0,s.jsxs)("div",{className:"modal-body",children:[1===r&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"search-section",children:[(0,s.jsx)("div",{className:"search-wrapper",children:(0,s.jsx)("input",{ref:T,type:"text",placeholder:"Rechercher un produit...",value:y,onChange:e=>x(e.target.value),className:"search-input"})}),D&&(0,s.jsx)("div",{className:"search-loading",children:"Recherche..."}),(0,s.jsxs)("div",{className:"search-results ".concat(M?"transitioning":""),children:[v.map(e=>(0,s.jsxs)("div",{className:"product-item",onClick:()=>Q(e),children:[(0,s.jsx)("span",{className:"product-icon",children:e.icon}),(0,s.jsxs)("div",{className:"product-info",children:[(0,s.jsx)("span",{className:"product-name",children:_(e.name)}),(0,s.jsx)("span",{className:"product-category-badge ".concat(Z(e.category_id,e.subcategory_id,e.name).class),children:Z(e.category_id,e.subcategory_id,e.name).name})]})]},"".concat(e.type,"-").concat(e.id))),!D&&0===v.length&&y&&(0,s.jsxs)("div",{className:"no-results",children:[(0,s.jsxs)("div",{children:['Aucun produit trouv\xe9 pour "',y,'"']}),(0,s.jsx)("div",{className:"no-results-tip",children:"Voulez-vous cr\xe9er ce produit ?"}),(0,s.jsxs)("button",{onClick:()=>Q({id:"custom",name:y,type:"custom",category_id:null,primary_unit:"unit\xe9s",shelf_life_days_pantry:7,shelf_life_days_fridge:7,shelf_life_days_freezer:90,icon:"\uD83D\uDCE6"}),className:"create-custom-btn",children:['✨ Cr\xe9er "',y,'"']})]}),!D&&0===v.length&&!y&&(0,s.jsx)("div",{className:"no-results",children:"Chargement des suggestions..."})]})]})}),2===r&&N&&(()=>{let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a={...e};if(e.productName){let t=e.productName.toLowerCase();for(let[e,s]of Object.entries({banane:{grams_per_unit:120,primary_unit:"u"},pomme:{grams_per_unit:150,primary_unit:"u"},orange:{grams_per_unit:200,primary_unit:"u"},carotte:{grams_per_unit:80,primary_unit:"u"},lait:{density_g_per_ml:1.03,primary_unit:"ml"},eau:{density_g_per_ml:1,primary_unit:"ml"},huile:{density_g_per_ml:.9,primary_unit:"ml"}}))if(t.includes(e)){Object.assign(a,s);break}}let t=[{value:"g",label:"Grammes"},{value:"kg",label:"Kilogrammes"},{value:"ml",label:"Millilitres"},{value:"cl",label:"Centilitres"},{value:"l",label:"Litres"},{value:"u",label:"Pi\xe8ce(s)"}],s=!!a.density_g_per_ml,n=!!a.grams_per_unit,i=(a.primary_unit||"").toLowerCase(),r=[];return"g"===i||"kg"===i?(r.push("g","kg"),s&&r.push("ml","cl","l"),n&&r.push("u")):"ml"===i||"cl"===i||"l"===i?(r.push("ml","cl","l"),s&&r.push("g","kg"),n&&r.push("u")):"u"===i||"unit\xe9s"===i||"pi\xe8ce"===i?(r.push("u"),n&&r.push("g","kg"),s&&r.push("ml","cl","l")):r=t.map(e=>e.value),r=[...new Set(r)],t.filter(e=>r.includes(e.value))}(N);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"selected-product-card",children:[(0,s.jsx)("span",{className:"product-icon-large",children:R(N.category_id,N.name)}),(0,s.jsxs)("div",{className:"product-details",children:[(0,s.jsx)("div",{className:"product-name",children:_(N.name)}),(0,s.jsx)("div",{className:"product-category",children:N.subcategory||"G\xe9n\xe9ral"})]}),(0,s.jsx)("button",{onClick:()=>o(1),className:"change-btn",children:"Changer"})]}),(0,s.jsxs)("div",{className:"form-section",children:[(0,s.jsxs)("div",{className:"quantity-section",children:[(0,s.jsx)("label",{children:"Quantit\xe9"}),(0,s.jsxs)("div",{className:"quantity-controls",children:[(0,s.jsx)("button",{onClick:()=>V("down"),className:"qty-btn",children:"-"}),(0,s.jsx)("input",{type:"number",value:z.qty_remaining,onChange:e=>A(a=>({...a,qty_remaining:parseFloat(e.target.value)||0})),className:"qty-input",step:G(z.unit),min:"0"}),(0,s.jsx)("button",{onClick:()=>V("up"),className:"qty-btn",children:"+"})]})]}),(0,s.jsxs)("div",{className:"unit-section",children:[(0,s.jsx)("label",{children:"Unit\xe9"}),(0,s.jsx)("select",{value:z.unit,onChange:e=>A(a=>({...a,unit:e.target.value})),className:"unit-select",children:e.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("div",{className:"storage-section",children:[(0,s.jsx)("label",{children:"Stockage"}),(0,s.jsxs)("div",{className:"storage-methods",children:[(0,s.jsxs)("button",{onClick:()=>J("pantry"),className:"storage-btn ".concat("pantry"===z.storage_method?"active":""),children:[(0,s.jsx)(d,{size:16}),"Garde-manger"]}),(0,s.jsxs)("button",{onClick:()=>J("fridge"),className:"storage-btn ".concat("fridge"===z.storage_method?"active":""),children:[(0,s.jsx)(u,{size:16}),"Frigo"]}),(0,s.jsxs)("button",{onClick:()=>J("freezer"),className:"storage-btn ".concat("freezer"===z.storage_method?"active":""),children:[(0,s.jsx)(m,{size:16}),"Cong\xe9lateur"]})]})]}),(0,s.jsxs)("div",{className:"expiration-section",children:[(0,s.jsx)("label",{children:"Date d'expiration"}),(0,s.jsxs)("div",{className:"expiration-input",children:[(0,s.jsx)(h,{size:16,className:"calendar-icon"}),(0,s.jsx)("input",{type:"date",value:z.expiration_date,onChange:e=>A(a=>({...a,expiration_date:e.target.value})),className:"date-input"})]})]})]})]})})()]}),(0,s.jsx)("div",{className:"modal-footer",children:2===r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>o(1),className:"back-btn",children:"Retour"}),(0,s.jsx)("button",{onClick:W,disabled:k,className:"create-btn",children:k?"Cr\xe9ation...":"Cr\xe9er le lot"})]})})]})}):null}let x=e=>{if(!e)return"";let a=["de","du","des","le","la","les","au","aux","et","ou","en"];return e.toLowerCase().split(/[\s-]+/).map((e,t)=>0!==t&&a.includes(e)?e:e.charAt(0).toUpperCase()+e.slice(1)).join(" ")};function v(e){var a,t;let{item:i,onConsume:r,onEdit:l,onDelete:c,onUpdateQuantity:o,onOpen:d}=e,[u,m]=(0,n.useState)(!1),[h,p]=(0,n.useState)(!1),g={productName:i.product_name,grams_per_unit:i.grams_per_unit,density_g_per_ml:i.density_g_per_ml,primary_unit:i.primary_unit},f=function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s={...t};console.log("Conversion pour:",{productName:t.productName,qty:e,currentUnit:a,density:t.density_g_per_ml,gramsPerUnit:t.grams_per_unit});let n=[],i=Number(s.density_g_per_ml)||0,r=Number(s.grams_per_unit)||0,l=r>0,c=i>0;if(!l&&!c)return console.log("Pas de m\xe9tadonn\xe9es disponibles pour les conversions"),[];let o=null==a?void 0:a.toLowerCase();function d(e){return e>=1e3?{unit:"kg",qty:Math.round(e/1e3*100)/100,label:"".concat(Math.round(e/1e3*100)/100," kg")}:{unit:"g",qty:Math.round(e),label:"".concat(Math.round(e)," g")}}if(l){if("u"===o||"pi\xe8ce"===o||"pi\xe8ces"===o||"unit\xe9s"===o){let a=d(e*r);n.push(a)}if("g"===o){let a=Math.round(e/r*10)/10;a>=.1&&n.push({unit:"u",qty:a,label:1===a?"1 pi\xe8ce":"".concat(a," pi\xe8ces")}),e>=1e3&&n.push({unit:"kg",qty:Math.round(e/1e3*100)/100,label:"".concat(Math.round(e/1e3*100)/100," kg")})}if("kg"===o){let a=1e3*e;e<1&&n.push({unit:"g",qty:Math.round(a),label:"".concat(Math.round(a)," g")});let t=Math.round(a/r*10)/10;t>=.1&&n.push({unit:"u",qty:t,label:1===t?"1 pi\xe8ce":"".concat(t," pi\xe8ces")})}}if(c&&!l){if("ml"===o||"cl"===o||"l"===o){let a=e;"cl"===o&&(a=10*e),"l"===o&&(a=1e3*e);let t=d(Math.round(a*i));n.push(t),"ml"===o&&a>=1e3?n.push({unit:"L",qty:Math.round(a/1e3*100)/100,label:"".concat(Math.round(a/1e3*100)/100," L")}):"l"===o&&a<1&&n.push({unit:"mL",qty:Math.round(1e3*a),label:"".concat(Math.round(1e3*a)," mL")})}if("g"===o||"kg"===o){var u;let a=e;"kg"===o&&(a=1e3*e);let t=(u=Math.round(a/i))>=1e3?{unit:"L",qty:Math.round(u/1e3*100)/100,label:"".concat(Math.round(u/1e3*100)/100," L")}:u>=100?{unit:"cL",qty:Math.round(u/10),label:"".concat(Math.round(u/10)," cL")}:{unit:"mL",qty:Math.round(u),label:"".concat(Math.round(u)," mL")};n.push(t),"g"===o&&a>=1e3?n.push({unit:"kg",qty:Math.round(a/1e3*100)/100,label:"".concat(Math.round(a/1e3*100)/100," kg")}):"kg"===o&&a<1e3&&n.push({unit:"g",qty:Math.round(a),label:"".concat(Math.round(a)," g")})}}return n}(i.qty_remaining,i.unit,g);u&&(console.log('--- CARD DEBUG pour "'.concat(i.product_name,'" ---')),console.log("Donn\xe9es item brutes:",{unit_weight_grams:i.unit_weight_grams,grams_per_unit:i.grams_per_unit,density_g_per_ml:i.density_g_per_ml,qty_remaining:i.qty_remaining,unit:i.unit}),console.log("ProductMeta calcul\xe9:",g),console.log("Conversions trouv\xe9es:",f),console.log("--- FIN DEBUG ---"));let _=async e=>{if(d&&!h){e.stopPropagation(),p(!0);try{await d(i.id)}finally{p(!1)}}},y=e=>e?new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"short"}):null,v=(e,a)=>{a.stopPropagation(),e(),m(!1)};return(0,s.jsxs)("div",{className:"product-card",onClick:()=>{m(!u)},style:{cursor:"pointer"},children:[(0,s.jsxs)("div",{className:"card-header",children:[(0,s.jsx)("h3",{children:x(i.product_name)||"Sans nom"}),i.category_name&&(0,s.jsx)("span",{className:"category-badge",children:i.category_name})]}),(0,s.jsxs)("div",{className:"card-body",children:[(0,s.jsxs)("div",{className:"info-row",children:[(0,s.jsx)("span",{className:"info-icon",children:"\uD83D\uDCE6"}),(0,s.jsxs)("div",{className:"quantity-section",children:[(0,s.jsxs)("span",{className:"info-value",children:[i.qty_remaining||0," ",i.unit||"unit\xe9"]}),u&&f.length>0&&(0,s.jsx)("div",{className:"quick-conversions",children:f.map((e,a)=>(0,s.jsxs)("button",{className:"conversion-btn",onClick:a=>{a.stopPropagation(),o&&"function"==typeof o&&o(i.id,e.qty,e.unit)},title:"Convertir en ".concat(e.label),children:["↔ ",e.label]},a))})]})]}),(0,s.jsxs)("div",{className:"info-row",children:[(0,s.jsx)("span",{className:"info-icon",children:"\uD83D\uDCCD"}),(0,s.jsx)("span",{className:"info-value",children:i.storage_place||"Non sp\xe9cifi\xe9"})]}),(0,s.jsx)("div",{className:"info-row",children:(0,s.jsx)("span",{className:"status-badge ".concat((e=>{switch(e){case"expired":return"status-expired";case"expiring_soon":return"status-expiring";default:return"status-good"}})(i.expiration_status)),children:(a=i.expiration_status,t=i.days_until_expiration,a&&"no_date"!==a?"expired"===a?"Expir\xe9 depuis ".concat(Math.abs(t),"j"):"expiring_soon"===a?"Expire dans ".concat(t,"j"):"".concat(t,"j restants"):"\uD83D\uDCC5 Pas de date")})}),i.expiration_date&&(0,s.jsxs)("div",{className:"info-row",children:[(0,s.jsx)("span",{className:"info-icon",children:"\uD83D\uDDD3️"}),(0,s.jsx)("span",{className:"info-value",children:y(i.expiration_date)}),i.is_opened&&i.adjusted_expiration_date&&(0,s.jsxs)("span",{className:"dlc-adjusted",title:"DLC ajust\xe9e apr\xe8s ouverture",children:["→ ",y(i.adjusted_expiration_date)]})]}),i.is_opened&&(0,s.jsx)("div",{className:"info-row",children:(0,s.jsxs)("span",{className:"opened-badge",children:["✅ Ouvert le ",y(i.opened_at)]})})]}),u&&(0,s.jsxs)("div",{className:"card-actions",children:[!i.is_opened&&d&&(0,s.jsxs)("button",{className:"action-btn open",onClick:_,disabled:h,title:"Marquer comme ouvert (ajuste la date de p\xe9remption)",children:[h?"⏳":"\uD83D\uDCE6"," ",h?"Ouverture...":"Ouvrir"]}),(0,s.jsx)("button",{className:"action-btn consume",onClick:e=>v(r,e),children:"✓ Consommer"}),(0,s.jsx)("button",{className:"action-btn edit",onClick:e=>v(l,e),children:"✏️ Modifier"}),(0,s.jsx)("button",{className:"action-btn delete",onClick:e=>v(c,e),children:"\uD83D\uDDD1️ Supprimer"})]})]})}function j(e){let{isOpen:a,onClose:t,onConfirm:n,title:i="Confirmer l'action",message:r="\xcates-vous s\xfbr de vouloir continuer ?",confirmText:l="Confirmer",cancelText:c="Annuler"}=e;return a?(0,s.jsx)("div",{className:"confirm-overlay",onClick:t,children:(0,s.jsxs)("div",{className:"confirm-dialog",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("h3",{className:"confirm-title",children:i}),(0,s.jsx)("p",{className:"confirm-message",children:r}),(0,s.jsxs)("div",{className:"confirm-actions",children:[(0,s.jsx)("button",{className:"confirm-btn cancel-btn",onClick:t,children:c}),(0,s.jsx)("button",{className:"confirm-btn confirm-btn-primary",onClick:()=>{n(),t()},children:l})]})]})}):null}t(5996);let D=(0,o.Z)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),b=(0,o.Z)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);t(6079);let N=[{value:"garde-manger",label:"Garde-manger",icon:"\uD83C\uDFE0",factor:1},{value:"r\xe9frig\xe9rateur",label:"R\xe9frig\xe9rateur",icon:"❄️",factor:2},{value:"cong\xe9lateur",label:"Cong\xe9lateur",icon:"\uD83E\uDDCA",factor:10},{value:"cave",label:"Cave",icon:"\uD83C\uDFDB️",factor:1.5},{value:"placard",label:"Placard",icon:"\uD83D\uDEAA",factor:1}],C=["u","g","kg","mL","cL","L"];function k(e){var a;let{item:t,onUpdate:i,onCancel:r}=e,[l,o]=(0,n.useState)(t.qty_remaining),[d,u]=(0,n.useState)(t.unit),[m,p]=(0,n.useState)(t.storage_place||"garde-manger"),g=t.expiration_date?t.expiration_date.split("T")[0]:"",f=t.storage_place||"garde-manger",_=new Date(t.created_at||Date.now()),[y,x]=(0,n.useState)(g),[v,j]=(0,n.useState)(!1),[k,w]=(0,n.useState)(!1),E=t.density_g_per_ml||0,S=t.grams_per_unit||0,M=e=>{if(t.canonical_foods){let a=t.canonical_foods;switch(e){case"r\xe9frig\xe9rateur":return a.shelf_life_days_fridge||2*a.shelf_life_days_pantry;case"cong\xe9lateur":return a.shelf_life_days_freezer||30*a.shelf_life_days_pantry;case"garde-manger":case"placard":return a.shelf_life_days_pantry||7;case"cave":return 1.5*a.shelf_life_days_pantry||10;default:return 7}}else if(t.cultivars){let a=t.cultivars;switch(e){case"r\xe9frig\xe9rateur":return a.shelf_life_days_fridge||2*a.shelf_life_days_pantry;case"cong\xe9lateur":return a.shelf_life_days_freezer||30*a.shelf_life_days_pantry;case"garde-manger":case"placard":return a.shelf_life_days_pantry||7;case"cave":return 1.5*a.shelf_life_days_pantry||10;default:return 7}}else if(t.archetypes){let a=t.archetypes;switch(e){case"r\xe9frig\xe9rateur":return a.shelf_life_days_fridge||2*a.shelf_life_days_pantry;case"cong\xe9lateur":return a.shelf_life_days_freezer||30*a.shelf_life_days_pantry;case"garde-manger":case"placard":return a.shelf_life_days_pantry||7;case"cave":return 1.5*a.shelf_life_days_pantry||10;default:return 7}}switch(e){case"r\xe9frig\xe9rateur":return 14;case"cong\xe9lateur":return 365;case"garde-manger":case"placard":default:return 7;case"cave":return 30}},q=e=>{let a=new Date,t=M(f),s=M(e),n=new Date(a);return n.setDate(a.getDate()+Math.max(0,Math.round(s*(1-Math.min(Math.floor((a-_)/864e5)/t,1))))),n.toISOString().split("T")[0]},z=e=>{let a=e!==f;p(e),a?(x(q(e)),w(!0),setTimeout(()=>w(!1),1500)):x(g)},A=e=>{let a=d.toLowerCase(),t=e.toLowerCase(),s=l;if(S>0&&("u"===a&&"g"===t?s=Math.round(l*S):"g"===a&&"u"===t?s=Math.round(l/S*10)/10:"u"===a&&"kg"===t?s=Math.round(l*S/1e3*100)/100:"kg"===a&&"u"===t?s=Math.round(1e3*l/S*10)/10:"g"===a&&"kg"===t?s=Math.round(l/1e3*100)/100:"kg"===a&&"g"===t&&(s=Math.round(1e3*l))),E>0){if(["ml","cl","l"].includes(a)&&["g","kg"].includes(t)){let e=l;"cl"===a&&(e*=10),"l"===a&&(e*=1e3);let n=e*E;s="kg"===t?Math.round(n/1e3*100)/100:Math.round(n)}else if(["g","kg"].includes(a)&&["ml","cl","l"].includes(t)){let e=l;"kg"===a&&(e*=1e3);let n=e/E;s="l"===t?Math.round(n/1e3*100)/100:"cl"===t?Math.round(n/10):Math.round(n)}else if(["ml","cl","l"].includes(a)&&["ml","cl","l"].includes(t)){let e=l;"cl"===a&&(e*=10),"l"===a&&(e*=1e3),s="l"===t?Math.round(e/1e3*100)/100:"cl"===t?Math.round(e/10):Math.round(e)}else["g","kg"].includes(a)&&["g","kg"].includes(t)&&("g"===a&&"kg"===t?s=Math.round(l/1e3*100)/100:"kg"===a&&"g"===t&&(s=Math.round(1e3*l)))}u(e),o(s),s!==l&&(j(!0),setTimeout(()=>j(!1),1e3))};return(0,s.jsx)("div",{className:"modal-overlay",onClick:r,children:(0,s.jsxs)("div",{className:"modal-container",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"modal-header",children:[(0,s.jsxs)("div",{className:"header-title",children:[(0,s.jsx)(D,{size:16}),"Modifier ",t.product_name]}),(0,s.jsx)("button",{className:"close-btn",onClick:r,children:(0,s.jsx)(c.Z,{size:16})})]}),(0,s.jsxs)("div",{className:"modal-content",children:[(0,s.jsxs)("div",{className:"form-section",children:[(0,s.jsxs)("div",{className:"section-header",children:[(0,s.jsx)(D,{size:16}),(0,s.jsx)("span",{children:"Quantit\xe9"})]}),(0,s.jsxs)("div",{className:"quantity-controls",children:[(0,s.jsxs)("div",{className:"quantity-input-wrapper",children:[(0,s.jsx)("button",{type:"button",className:"qty-btn minus",onClick:()=>{let e="u"===d?1:.1;o(a=>Math.max(0,Math.round((a-e)*10)/10))},disabled:l<=0,children:"−"}),(0,s.jsx)("input",{type:"number",value:l,onChange:e=>o(parseFloat(e.target.value)||0),className:"qty-input ".concat(v?"converted":""),step:"0.1",min:"0"}),(0,s.jsx)("button",{type:"button",className:"qty-btn plus",onClick:()=>{let e="u"===d?1:.1;o(a=>Math.round((a+e)*10)/10)},children:"+"})]}),(0,s.jsx)("div",{className:"unit-selector",children:C.map(e=>(0,s.jsx)("button",{type:"button",className:"unit-btn ".concat(d===e?"active":""),onClick:()=>A(e),children:e},e))})]})]}),(0,s.jsxs)("div",{className:"form-section",children:[(0,s.jsxs)("div",{className:"section-header",children:[(0,s.jsx)(b,{size:16}),(0,s.jsx)("span",{children:"Emplacement"})]}),(0,s.jsx)("div",{className:"location-grid",children:N.map(e=>{let a=M(f),t=M(e.value),n=t>a,i=t<a,r=e.value===f;return(0,s.jsxs)("button",{type:"button",className:"location-btn ".concat(m===e.value?"selected":""," ").concat(n&&!r?"extends-life":""," ").concat(i&&!r?"shortens-life":""),onClick:()=>z(e.value),title:r?"Emplacement d'origine":n?"Conservation plus longue (".concat(Math.round(t)," jours)"):i?"Conservation plus courte (".concat(Math.round(t)," jours)"):"M\xeame dur\xe9e de conservation (".concat(Math.round(t)," jours)"),children:[(0,s.jsx)("span",{className:"location-icon",children:e.icon}),(0,s.jsx)("span",{className:"location-label",children:e.label}),(0,s.jsxs)("div",{className:"shelf-life-info",children:[Math.round(t),"j"]}),n&&!r&&(0,s.jsx)("span",{className:"duration-indicator",children:"+"}),i&&!r&&(0,s.jsx)("span",{className:"duration-indicator",children:"-"})]},e.value)})})]}),(0,s.jsxs)("div",{className:"form-section",children:[(0,s.jsxs)("div",{className:"section-header",children:[(0,s.jsx)(h,{size:16}),(0,s.jsx)("span",{children:"Date d'expiration (optionnelle)"})]}),(0,s.jsx)("input",{type:"date",value:y,onChange:e=>x(e.target.value),className:"date-input ".concat(k?"date-adjusted":""),min:new Date().toISOString().split("T")[0]}),k&&(0,s.jsxs)("div",{className:"date-adjustment-notice",children:["\uD83D\uDCC5 Date ajust\xe9e automatiquement pour ",null===(a=N.find(e=>e.value===m))||void 0===a?void 0:a.label]})]}),(0,s.jsxs)("div",{className:"form-actions",children:[(0,s.jsx)("button",{type:"button",className:"action-btn secondary",onClick:r,children:"Annuler"}),(0,s.jsx)("button",{type:"button",className:"action-btn primary",onClick:()=>{l>0&&i(t.id,{qty_remaining:l,unit:d,storage_place:m,expiration_date:y||null})},disabled:l<=0,children:"Sauvegarder"})]})]})]})})}function w(e){let{activeTab:a,onTabChange:t,stats:n}=e,i=[{id:"inventory",label:"Inventaire",icon:"\uD83D\uDCE6",badge:(null==n?void 0:n.totalProducts)||0,description:"Tous vos produits"},{id:"waste",label:"\xc0 Risque",icon:"⚠️",badge:(null==n?void 0:n.atRiskCount)||0,badgeColor:(null==n?void 0:n.atRiskCount)>0?"warning":"default",description:"Produits qui expirent"},{id:"stats",label:"Statistiques",icon:"\uD83D\uDCCA",description:"Vue d'ensemble"}];return(0,s.jsx)("div",{className:"pantry-tabs-container",children:(0,s.jsx)("div",{className:"pantry-tabs",children:i.map(e=>(0,s.jsxs)("button",{className:"pantry-tab ".concat(a===e.id?"active":""),onClick:()=>t(e.id),children:[(0,s.jsx)("span",{className:"tab-icon",children:e.icon}),(0,s.jsxs)("div",{className:"tab-content",children:[(0,s.jsx)("span",{className:"tab-label",children:e.label}),(0,s.jsx)("span",{className:"tab-description",children:e.description})]}),void 0!==e.badge&&(0,s.jsx)("span",{className:"tab-badge ".concat(e.badgeColor||"default"),children:e.badge})]},e.id))})})}function E(e){var a,t;let{dish:i,onConsume:r,onChangeStorage:l,onDelete:c,onRefresh:o}=e,[d,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)(!1),[p,g]=(0,n.useState)(!1),f=e=>e?new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A",_=()=>i.days_until_expiration<=0?"expired":i.days_until_expiration<=1?"urgent":i.days_until_expiration<=3?"warning":"good",y=async e=>{if(r&&!m){e.stopPropagation(),h(!0);try{await r(i.id,1)}finally{h(!1)}}},x=async e=>{if(!l||p)return;e.stopPropagation();let a="freezer"===i.storage_method?"fridge":"freezer";g(!0);try{await l(i.id,a)}finally{g(!1)}},v=async e=>{c&&(e.stopPropagation(),confirm('Supprimer le plat "'.concat(i.name,'" ?'))&&await c(i.id))};return(0,s.jsxs)("div",{className:"cooked-dish-card",onClick:()=>u(!d),children:[(0,s.jsxs)("div",{className:"dish-header",children:[(null===(a=i.recipe)||void 0===a?void 0:a.image_url)?(0,s.jsx)("div",{className:"dish-image",style:{backgroundImage:"url(".concat(i.recipe.image_url,")")}}):(0,s.jsx)("div",{className:"dish-image-placeholder",children:"\uD83C\uDF7D️"}),(0,s.jsxs)("div",{className:"dish-info",children:[(0,s.jsx)("h3",{className:"dish-name",children:i.name}),(null===(t=i.recipe)||void 0===t?void 0:t.title)&&(0,s.jsxs)("span",{className:"dish-recipe",children:["\uD83D\uDCD6 ",i.recipe.title]})]}),(0,s.jsx)("div",{className:"urgency-badge ".concat(_()),children:i.days_until_expiration<=0?"Expir\xe9":"".concat(i.days_until_expiration,"j")})]}),(0,s.jsxs)("div",{className:"dish-body",children:[(0,s.jsxs)("div",{className:"dish-detail",children:[(0,s.jsx)("span",{className:"detail-icon",children:"\uD83C\uDF7D️"}),(0,s.jsx)("span",{className:"detail-label",children:"Portions:"}),(0,s.jsxs)("span",{className:"detail-value portions-indicator",children:[i.portions_remaining," / ",i.portions_cooked]})]}),(0,s.jsxs)("div",{className:"dish-detail",children:[(0,s.jsx)("span",{className:"detail-icon",children:(()=>{switch(i.storage_method){case"fridge":return"❄️";case"freezer":return"\uD83E\uDDCA";case"counter":return"\uD83C\uDFE0";default:return"\uD83D\uDCE6"}})()}),(0,s.jsx)("span",{className:"detail-label",children:"Stockage:"}),(0,s.jsx)("span",{className:"detail-value",children:(()=>{switch(i.storage_method){case"fridge":return"Frigo";case"freezer":return"Cong\xe9lateur";case"counter":return"Comptoir";default:return"Inconnu"}})()})]}),(0,s.jsxs)("div",{className:"dish-detail",children:[(0,s.jsx)("span",{className:"detail-icon",children:"\uD83D\uDCC5"}),(0,s.jsx)("span",{className:"detail-label",children:"Cuisin\xe9 le:"}),(0,s.jsx)("span",{className:"detail-value",children:f(i.cooked_at)})]}),(0,s.jsxs)("div",{className:"dish-detail",children:[(0,s.jsx)("span",{className:"detail-icon",children:"⏰"}),(0,s.jsx)("span",{className:"detail-label",children:"Expire le:"}),(0,s.jsx)("span",{className:"detail-value ".concat(_()),children:f(i.expiration_date)})]}),i.notes&&(0,s.jsxs)("div",{className:"dish-notes",children:[(0,s.jsx)("span",{className:"detail-icon",children:"\uD83D\uDCDD"}),(0,s.jsx)("span",{className:"notes-text",children:i.notes})]})]}),(0,s.jsx)("div",{className:"portions-progress",children:(0,s.jsx)("div",{className:"portions-progress-bar",style:{width:"".concat(i.portions_remaining/i.portions_cooked*100,"%")}})}),d&&(0,s.jsxs)("div",{className:"dish-actions",children:[(0,s.jsxs)("button",{className:"action-btn consume",onClick:y,disabled:m||0===i.portions_remaining,title:"Manger 1 portion",children:[m?"⏳":"\uD83C\uDF74"," ",m?"Manger...":"Manger"]}),(0,s.jsxs)("button",{className:"action-btn freeze",onClick:x,disabled:p,title:"freezer"===i.storage_method?"Mettre au frigo":"Congeler",children:[p?"⏳":"freezer"===i.storage_method?"❄️":"\uD83E\uDDCA",p?"D\xe9placement...":"freezer"===i.storage_method?"D\xe9congeler":"Congeler"]}),(0,s.jsx)("button",{className:"action-btn delete",onClick:v,title:"Supprimer ce plat",children:"\uD83D\uDDD1️ Supprimer"})]})]})}function S(e){let{userId:a,onActionComplete:t}=e,[i,r]=(0,n.useState)([]),[l,c]=(0,n.useState)(!0),[o,d]=(0,n.useState)("all");(0,n.useEffect)(()=>{a&&u()},[a,o]);let u=async()=>{try{c(!0);let e=new URLSearchParams;e.append("onlyWithPortions","true"),"expiring"===o&&e.append("expiringInDays","3");let a=await fetch("/api/cooked-dishes?".concat(e.toString())),t=await a.json();t.success?r(t.dishes||[]):(console.error("Erreur chargement plats:",t.error),r([]))}catch(e){console.error("Erreur:",e),r([])}finally{c(!1)}},m=async(e,a)=>{try{let s=await fetch("/api/cooked-dishes/".concat(e,"/consume"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({portions:a})}),n=await s.json();n.success?(await u(),t&&t(),n.fullyConsumed&&console.log("\uD83C\uDF89",n.message)):alert(n.error||"Erreur lors de la consommation")}catch(e){console.error("Erreur:",e),alert("Erreur lors de la consommation")}},h=async(e,a)=>{try{let s=await fetch("/api/cooked-dishes/".concat(e,"/storage"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storageMethod:a})}),n=await s.json();n.success?(await u(),t&&t(),console.log("✅",n.message)):alert(n.error||"Erreur lors du changement de stockage")}catch(e){console.error("Erreur:",e),alert("Erreur lors du changement de stockage")}},p=async e=>{try{let a=await fetch("/api/cooked-dishes/".concat(e),{method:"DELETE"}),s=await a.json();s.success?(await u(),t&&t(),console.log("✅",s.message)):alert(s.error||"Erreur lors de la suppression")}catch(e){console.error("Erreur:",e),alert("Erreur lors de la suppression")}};return l?(0,s.jsxs)("div",{className:"cooked-dishes-loading",children:[(0,s.jsx)("div",{className:"spinner"}),(0,s.jsx)("p",{children:"Chargement des plats cuisin\xe9s..."})]}):(0,s.jsxs)("div",{className:"cooked-dishes-manager",children:[(0,s.jsxs)("div",{className:"cooked-dishes-header",children:[(0,s.jsxs)("div",{className:"header-title",children:[(0,s.jsx)("h2",{children:"\uD83C\uDF7D️ Plats Cuisin\xe9s"}),(0,s.jsxs)("span",{className:"dishes-count",children:[i.length," ",i.length>1?"plats":"plat"]})]}),(0,s.jsxs)("div",{className:"filter-buttons",children:[(0,s.jsx)("button",{className:"filter-btn ".concat("all"===o?"active":""),onClick:()=>d("all"),children:"Tous"}),(0,s.jsx)("button",{className:"filter-btn ".concat("expiring"===o?"active":""),onClick:()=>d("expiring"),children:"⚠️ \xc0 finir (3j)"})]})]}),0===i.length?(0,s.jsxs)("div",{className:"empty-state",children:[(0,s.jsx)("div",{className:"empty-icon",children:"\uD83C\uDF7D️"}),(0,s.jsx)("h3",{children:"Aucun plat cuisin\xe9"}),(0,s.jsx)("p",{children:"expiring"===o?"Aucun plat ne p\xe9rime dans les 3 prochains jours":"Commencez par cuisiner un plat et il appara\xeetra ici"})]}):(0,s.jsx)("div",{className:"dishes-grid",children:i.map(e=>(0,s.jsx)(E,{dish:e,onConsume:m,onChangeStorage:h,onDelete:p},e.id))})]})}t(9122),t(8299),t(937),t(4506);let M={CRITIQUE:"#ef4444",URGENT:"#f97316",ATTENTION:"#f59e0b",BIENTÔT:"#eab308",NORMAL:"#84cc16",FRAIS:"#22c55e"},q={freeze:"\uD83E\uDDCA",preserve:"\uD83E\uDD6B",cook:"\uD83D\uDC68‍\uD83C\uDF73",transform:"\uD83D\uDD04",share:"\uD83E\uDD1D",consumed:"✅"};function z(e){let{userId:a}=e,[t,i]=(0,n.useState)(!0),[r,l]=(0,n.useState)(null),[c,o]=(0,n.useState)(null),[d,u]=(0,n.useState)(null),[m,h]=(0,n.useState)("all"),[p,g]=(0,n.useState)("grid"),[f,_]=(0,n.useState)(null),[y,x]=(0,n.useState)(null);async function v(){i(!0);try{let e=await fetch("/api/restes/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a,daysThreshold:7,includeOpened:!0,includeStats:!0,includeRecipeSuggestions:!0})});if(!e.ok)throw Error("Erreur lors de l'analyse");let t=await e.json();l(t.analysis),o(t.recipeSuggestions),u(t.stats)}catch(e){console.error("Erreur:",e),alert("Erreur lors du chargement de l'analyse")}finally{i(!1)}}async function j(e,t){x(e.lotId);try{let s=await fetch("/api/restes/action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a,lotId:e.lotId,actionType:t,quantitySaved:e.quantity,notes:"Action sur ".concat(e.productName)})});if(!s.ok)throw Error("Erreur lors de l'action");let n=await s.json();alert(n.message),await v()}catch(e){console.error("Erreur:",e),alert("Erreur lors de l'action")}finally{x(null)}}(0,n.useEffect)(()=>{a&&v()},[a]);let D=(0,n.useMemo)(()=>(null==r?void 0:r.risks)?"all"===m?r.risks:"critical"===m?r.risks.filter(e=>"CRITIQUE"===e.urgency.level):"urgent"===m?r.risks.filter(e=>"URGENT"===e.urgency.level):"warning"===m?r.risks.filter(e=>"ATTENTION"===e.urgency.level):r.risks:[],[r,m]);return t?(0,s.jsxs)("div",{className:"restes-manager loading",children:[(0,s.jsx)("div",{className:"spinner"}),(0,s.jsx)("p",{children:"Analyse en cours..."})]}):r&&0!==r.risks.length?(0,s.jsxs)("div",{className:"restes-manager",children:[(0,s.jsxs)("div",{className:"restes-header",children:[(0,s.jsxs)("div",{className:"header-title",children:[(0,s.jsx)("h1",{children:"\uD83D\uDDD1️ Gestion Anti-Gaspillage"}),(0,s.jsx)("p",{className:"header-subtitle",children:r.summary.message})]}),(0,s.jsxs)("div",{className:"header-stats",children:[(0,s.jsx)(A,{icon:"⚠️",label:"\xc0 risque",value:r.stats.totalAtRisk,color:"#ef4444"}),(0,s.jsx)(A,{icon:"\uD83D\uDD25",label:"Critiques",value:r.stats.criticalCount,color:"#f97316"}),(0,s.jsx)(A,{icon:"⏰",label:"Urgents",value:r.stats.urgentCount,color:"#f59e0b"}),d&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(A,{icon:"\uD83D\uDCB0",label:"\xc9conomis\xe9",value:"".concat(d.estimatedMoneySaved,"€"),color:"#22c55e"}),(0,s.jsx)(A,{icon:"\uD83C\uDF0D",label:"CO₂ \xe9vit\xe9",value:"".concat(d.co2Saved,"kg"),color:"#16a34a"})]})]})]}),(0,s.jsxs)("div",{className:"restes-controls",children:[(0,s.jsxs)("div",{className:"filter-buttons",children:[(0,s.jsxs)("button",{className:"filter-btn ".concat("all"===m?"active":""),onClick:()=>h("all"),children:["Tous (",r.risks.length,")"]}),(0,s.jsxs)("button",{className:"filter-btn ".concat("critical"===m?"active":""),onClick:()=>h("critical"),children:["\uD83D\uDD25 Critiques (",r.stats.criticalCount,")"]}),(0,s.jsxs)("button",{className:"filter-btn ".concat("urgent"===m?"active":""),onClick:()=>h("urgent"),children:["⏰ Urgents (",r.stats.urgentCount,")"]}),(0,s.jsxs)("button",{className:"filter-btn ".concat("warning"===m?"active":""),onClick:()=>h("warning"),children:["⚠️ Attention (",r.stats.warningCount,")"]})]}),(0,s.jsxs)("div",{className:"view-toggle",children:[(0,s.jsx)("button",{className:"view-btn ".concat("grid"===p?"active":""),onClick:()=>g("grid"),title:"Vue grille",children:"▦"}),(0,s.jsx)("button",{className:"view-btn ".concat("list"===p?"active":""),onClick:()=>g("list"),title:"Vue liste",children:"☰"})]})]}),(0,s.jsx)("h2",{className:"ingredients-section-title",children:"\uD83E\uDD6B Ingr\xe9dients \xe0 Risque"}),(0,s.jsx)("div",{className:"restes-list ".concat(p),children:D.map(e=>(0,s.jsx)(L,{risk:e,expanded:f===e.lotId,onToggle:()=>_(f===e.lotId?null:e.lotId),onAction:a=>j(e,a),isProcessing:y===e.lotId},e.lotId))}),(0,s.jsx)("div",{className:"cooked-dishes-section",children:(0,s.jsx)(S,{userId:a,onActionComplete:v})}),c&&c.suggestions.length>0&&(0,s.jsxs)("div",{className:"recipe-suggestions",children:[(0,s.jsx)("h2",{children:"\uD83D\uDCA1 Recettes sugg\xe9r\xe9es"}),(0,s.jsx)("p",{className:"suggestions-subtitle",children:c.message}),(0,s.jsx)("div",{className:"suggestions-list",children:c.suggestions.slice(0,5).map(e=>(0,s.jsx)(T,{suggestion:e},e.recipeId))})]})]}):(0,s.jsx)("div",{className:"restes-manager empty",children:(0,s.jsxs)("div",{className:"empty-state",children:[(0,s.jsx)("span",{className:"empty-icon",children:"\uD83C\uDF89"}),(0,s.jsx)("h2",{children:"Aucun produit \xe0 risque !"}),(0,s.jsx)("p",{children:"Tous vos produits sont en bon \xe9tat. Continuez ainsi !"}),d&&(0,s.jsxs)("div",{className:"empty-stats",children:[(0,s.jsxs)("p",{children:["Ce mois-ci, vous avez sauv\xe9 ",(0,s.jsxs)("strong",{children:[d.quantitySaved,"kg"]})," de nourriture"]}),(0,s.jsxs)("p",{children:["\xc9conomies: ",(0,s.jsxs)("strong",{children:[d.estimatedMoneySaved,"€"]})," | CO₂ \xe9vit\xe9: ",(0,s.jsxs)("strong",{children:[d.co2Saved,"kg"]})]})]})]})})}function A(e){let{icon:a,label:t,value:n,color:i}=e;return(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("span",{className:"stat-icon",style:{color:i},children:a}),(0,s.jsxs)("div",{className:"stat-content",children:[(0,s.jsx)("div",{className:"stat-value",style:{color:i},children:n}),(0,s.jsx)("div",{className:"stat-label",children:t})]})]})}function L(e){let{risk:a,expanded:t,onToggle:n,onAction:i,isProcessing:r}=e,l=M[a.urgency.level]||"#6b7280";return(0,s.jsxs)("div",{className:"risk-card",style:{borderLeftColor:l},children:[(0,s.jsxs)("div",{className:"risk-header",onClick:n,children:[(0,s.jsxs)("div",{className:"risk-main",children:[(0,s.jsxs)("div",{className:"risk-product",children:[(0,s.jsx)("span",{className:"product-name",children:a.productName}),a.isOpened&&(0,s.jsx)("span",{className:"opened-badge",children:"\uD83D\uDCE6 Ouvert"})]}),(0,s.jsxs)("div",{className:"risk-info",children:[(0,s.jsxs)("span",{className:"quantity",children:[a.quantity," ",a.unit]}),(0,s.jsxs)("span",{className:"location",children:[a.locationIcon," ",a.location]})]})]}),(0,s.jsxs)("div",{className:"risk-urgency",children:[(0,s.jsx)("div",{className:"urgency-badge",style:{backgroundColor:l},children:a.urgency.level}),(0,s.jsx)("div",{className:"days-left",children:a.daysLeft<0?(0,s.jsx)("span",{className:"expired",children:"P\xc9RIM\xc9"}):0===a.daysLeft?(0,s.jsx)("span",{className:"today",children:"Expire aujourd'hui"}):1===a.daysLeft?(0,s.jsx)("span",{className:"tomorrow",children:"Expire demain"}):(0,s.jsxs)("span",{children:["Dans ",a.daysLeft,"j"]})}),(0,s.jsxs)("div",{className:"urgency-score",children:["Score: ",a.urgency.score,"/100"]})]}),(0,s.jsx)("button",{className:"expand-btn",onClick:e=>{e.stopPropagation(),n()},children:t?"▼":"▶"})]}),t&&(0,s.jsxs)("div",{className:"risk-details",children:[(0,s.jsxs)("div",{className:"recommendation",children:[(0,s.jsx)("strong",{children:"Recommandation:"}),(0,s.jsx)("p",{children:a.recommendation})]}),(0,s.jsxs)("div",{className:"actions",children:[(0,s.jsx)("h4",{children:"Actions possibles:"}),(0,s.jsxs)("div",{className:"action-buttons",children:[a.actions.map(e=>(0,s.jsxs)("button",{className:"action-btn",onClick:()=>i(e.id),disabled:r,title:e.description,children:[q[e.id]," ",e.label]},e.id)),(0,s.jsx)("button",{className:"action-btn consumed",onClick:()=>i("consumed"),disabled:r,children:"✅ Consomm\xe9"})]})]}),r&&(0,s.jsxs)("div",{className:"processing",children:[(0,s.jsx)("div",{className:"spinner-small"}),(0,s.jsx)("span",{children:"Action en cours..."})]})]})]})}function T(e){let{suggestion:a}=e;return(0,s.jsxs)("div",{className:"recipe-suggestion-card",children:[(0,s.jsxs)("div",{className:"suggestion-header",children:[(0,s.jsx)("h3",{children:a.recipeName}),(0,s.jsxs)("div",{className:"match-badge",children:[a.matchCount," produit",a.matchCount>1?"s":""]})]}),a.description&&(0,s.jsx)("p",{className:"suggestion-description",children:a.description}),(0,s.jsxs)("div",{className:"suggestion-meta",children:[(0,s.jsxs)("span",{children:["⏱️ ",a.prepTime+a.cookTime," min"]}),(0,s.jsxs)("span",{children:["\uD83D\uDC65 ",a.servings," pers."]}),(0,s.jsxs)("span",{children:["\uD83D\uDCCA Score: ",Math.round(a.urgencyScore)]})]}),(0,s.jsxs)("div",{className:"suggestion-products",children:[(0,s.jsx)("strong",{children:"Produits utilis\xe9s:"}),(0,s.jsx)("div",{className:"products-tags",children:a.matchingProducts.map((e,a)=>(0,s.jsx)("span",{className:"product-tag",children:e},a))})]}),(0,s.jsxs)("div",{className:"suggestion-impact",children:[(0,s.jsxs)("span",{children:["\uD83D\uDCB0 ≈ ",a.wasteReduction.estimatedValue,"€ sauv\xe9s"]}),(0,s.jsxs)("span",{children:["\uD83C\uDF0D ≈ ",a.wasteReduction.co2,"kg CO₂"]})]}),(0,s.jsx)("button",{className:"view-recipe-btn",children:"Voir la recette →"})]})}function F(){let e=(0,i.useRouter)(),a=(0,i.useSearchParams)(),[t,l]=(0,n.useState)([]),[c,o]=(0,n.useState)([]),[d,u]=(0,n.useState)(!0),[m,h]=(0,n.useState)(!1),[p,g]=(0,n.useState)(""),[f,_]=(0,n.useState)("all"),[x,D]=(0,n.useState)("expiration"),[b,N]=(0,n.useState)("asc"),[C,E]=(0,n.useState)(!1),[S,M]=(0,n.useState)(null),[q,A]=(0,n.useState)(!1),[L,T]=(0,n.useState)(null),[F,I]=(0,n.useState)(!1),[P,O]=(0,n.useState)("inventory"),[R,Z]=(0,n.useState)(null);function U(e){let a=e.qty_remaining||0,t=(e.unit||"").toLowerCase();if(e.grams_per_unit&&("u"===t||"pi\xe8ce"===t||"pi\xe8ces"===t))return a*e.grams_per_unit;switch(t){case"kg":case"l":return 1e3*a;case"g":case"ml":default:return a;case"cl":return 10*a}}async function B(){if(!F){I(!0),u(!0);try{let{data:e,error:a}=await r.OQ.from("inventory_lots").select("*").order("expiration_date",{ascending:!0,nullsLast:!0});if(a)throw console.error("Erreur lors du chargement des lots:",a),a;if(e&&e.length>0){let a=e.filter(e=>e.canonical_food_id).map(e=>e.canonical_food_id);if(a.length>0){let{data:t,error:s}=await r.OQ.from("canonical_foods").select("id, canonical_name, density_g_per_ml, unit_weight_grams, shelf_life_days_pantry").in("id",a);if(!s&&t){let a={};t.forEach(e=>{a[e.id]=e}),e=e.map(e=>e.canonical_food_id&&a[e.canonical_food_id]?{...e,canonical_foods:a[e.canonical_food_id]}:e)}}}let t=(e||[]).map(e=>{var a,t,s;let n="Produit sans nom";return e.canonical_food_id&&(null===(a=e.canonical_foods)||void 0===a?void 0:a.canonical_name)?n=e.canonical_foods.canonical_name:e.notes?n=e.notes.split("\n")[0]:e.product_name&&(n=e.product_name),{...e,product_name:n,expiration_status:function(e){if(!e)return"no_date";let a=new Date,t=new Date(e),s=Math.ceil((t-a)/864e5);return s<0?"expired":s<=3?"expiring_soon":"good"}(e.expiration_date),days_until_expiration:function(e){if(!e)return null;let a=new Date,t=new Date(e);return Math.ceil((t-a)/864e5)}(e.expiration_date),grams_per_unit:(null===(t=e.canonical_foods)||void 0===t?void 0:t.unit_weight_grams)||null,density_g_per_ml:(null===(s=e.canonical_foods)||void 0===s?void 0:s.density_g_per_ml)||null,primary_unit:e.unit}});l(t)}catch(e){console.error("Erreur lors du chargement:",e),l([])}finally{u(!1),I(!1)}}}async function G(e){let a;let s=t.find(a=>a.id===e);if(!s)return;let n=s.qty_remaining;a="u"===s.unit?1:"kg"===s.unit?n>=2?.5:n>=1?.2:.1:"g"===s.unit?n>=1e3?100:n>=500?50:n>=100?20:10:"L"===s.unit?n>=2?.5:n>=1?.2:.1:"mL"===s.unit?n>=1e3?100:n>=500?50:25:.1;let i=Math.max(0,Math.round((n-a)*100)/100);if(0===i){W(e);return}l(a=>a.map(a=>a.id===e?{...a,qty_remaining:i}:a));try{let{error:a}=await r.OQ.from("inventory_lots").update({qty_remaining:i}).eq("id",e);a&&(console.error("Erreur lors de la consommation:",a),await B())}catch(e){console.error("Erreur:",e),await B()}}async function V(e){try{let a=await fetch("/api/lots/manage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"open",lotId:e})}),t=await a.json();if(!a.ok){console.error("Erreur lors de l'ouverture du produit:",t.error),alert(t.error||"Erreur lors de l'ouverture du produit");return}t.success&&(await B(),t.message&&console.log("✅",t.message))}catch(e){console.error("Erreur lors de l'ouverture:",e),alert("Erreur lors de l'ouverture du produit")}}async function Q(e,a){console.log("Mise \xe0 jour lot:",{id:e,updates:a}),A(!1),T(null),l(t=>t.map(t=>t.id===e?{...t,qty_remaining:parseFloat(a.qty_remaining),unit:a.unit,storage_place:a.storage_place,expiration_date:a.expiration_date}:t));try{let{error:t}=await r.OQ.from("inventory_lots").update({qty_remaining:parseFloat(a.qty_remaining),unit:a.unit,storage_place:a.storage_place,expiration_date:a.expiration_date}).eq("id",e);if(t)throw console.error("Erreur Supabase lors de la mise \xe0 jour:",t),t;console.log("Mise \xe0 jour r\xe9ussie en base de donn\xe9es")}catch(e){console.error("Erreur lors de la mise \xe0 jour:",e),alert("Erreur lors de la mise \xe0 jour: "+e.message),await B()}}async function J(e,a,t){return Q(e,{qty_remaining:a,unit:t})}function W(e){M(t.find(a=>a.id===e)),E(!0)}async function X(){if(!S)return;let e=S.id;l(a=>a.filter(a=>a.id!==e));try{let{error:a}=await r.OQ.from("inventory_lots").delete().eq("id",e);a?(console.error("Erreur lors de la suppression:",a),await B(),alert("Erreur lors de la suppression: "+a.message)):console.log("Article supprim\xe9 avec succ\xe8s")}catch(e){console.error("Erreur:",e),await B()}}function H(){h(!1),B()}(0,n.useEffect)(()=>{r.OQ.auth.getUser().then(a=>{let{data:{user:t}}=a;t?Z(t.id):e.push("/login")})},[e]),(0,n.useEffect)(()=>{let e=a.get("tab");("waste"===e||"restes"===e)&&O("waste")},[a]),(0,n.useEffect)(()=>{B()},[]),(0,n.useEffect)(()=>{let e;e=[...t],p&&(e=e.filter(e=>(e.product_name||"").toLowerCase().includes(p.toLowerCase()))),"all"!==f&&(e=e.filter(e=>e.expiration_status===f)),e.sort((e,a)=>{let t=0;switch(x){case"expiration":t=e.expiration_date||a.expiration_date?e.expiration_date?a.expiration_date?new Date(e.expiration_date)-new Date(a.expiration_date):-1:1:0;break;case"quantity":t=U(e)-U(a);break;case"name":t=(e.product_name||"").localeCompare(a.product_name||"");break;case"location":t=(e.storage_place||"").localeCompare(a.storage_place||"");break;default:t=0}return"desc"===b?-t:t}),o(e)},[t,p,f,x,b]);let Y={totalProducts:t.length,atRiskCount:t.filter(e=>"expired"===e.expiration_status||"expiring_soon"===e.expiration_status).length};return d?(0,s.jsxs)("div",{className:"pantry-loading",children:[(0,s.jsx)("div",{className:"loading-spinner"}),(0,s.jsx)("p",{children:"Chargement du garde-manger..."})]}):(0,s.jsxs)("div",{className:"pantry-container",children:[(0,s.jsx)(w,{activeTab:P,onTabChange:O,stats:Y}),"inventory"===P&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"pantry-controls",children:[(0,s.jsxs)("div",{className:"top-row",children:[(0,s.jsx)("input",{type:"text",placeholder:"Rechercher un produit...",value:p,onChange:e=>g(e.target.value),className:"search-input"}),(0,s.jsxs)("div",{className:"stats-filter",children:[(0,s.jsxs)("button",{className:"stat-filter-btn ".concat("all"===f?"active":""),onClick:()=>_("all"),title:"Afficher tous les articles",children:[(0,s.jsx)("span",{className:"stat-number",children:t.length}),(0,s.jsx)("span",{className:"stat-label",children:"TOUT"})]}),(0,s.jsxs)("button",{className:"stat-filter-btn expired ".concat("expired"===f?"active":""),onClick:()=>_("expired"===f?"all":"expired"),title:"Afficher uniquement les produits expir\xe9s",children:[(0,s.jsx)("span",{className:"stat-number",children:t.filter(e=>"expired"===e.expiration_status).length}),(0,s.jsx)("span",{className:"stat-label",children:"EXPIR\xc9S"})]}),(0,s.jsxs)("button",{className:"stat-filter-btn expiring ".concat("expiring_soon"===f?"active":""),onClick:()=>_("expiring_soon"===f?"all":"expiring_soon"),title:"Afficher uniquement les produits qui expirent bient\xf4t",children:[(0,s.jsx)("span",{className:"stat-number",children:t.filter(e=>"expiring_soon"===e.expiration_status).length}),(0,s.jsx)("span",{className:"stat-label",children:"EXPIRE BIENT\xd4T"})]}),(0,s.jsxs)("button",{className:"stat-filter-btn good ".concat("good"===f?"active":""),onClick:()=>_("good"===f?"all":"good"),title:"Afficher uniquement les produits en bon \xe9tat",children:[(0,s.jsx)("span",{className:"stat-number",children:t.filter(e=>"good"===e.expiration_status).length}),(0,s.jsx)("span",{className:"stat-label",children:"BON \xc9TAT"})]})]})]}),(0,s.jsxs)("div",{className:"sort-controls",children:[(0,s.jsx)("span",{className:"sort-label",children:"Trier par :"}),(0,s.jsxs)("div",{className:"sort-options",children:[(0,s.jsxs)("button",{className:"sort-btn ".concat("expiration"===x?"active":""),onClick:()=>{"expiration"===x?N("asc"===b?"desc":"asc"):(D("expiration"),N("asc"))},children:["\uD83D\uDCC5 Expiration ","expiration"===x&&("asc"===b?"↗️":"↘️")]}),(0,s.jsxs)("button",{className:"sort-btn ".concat("quantity"===x?"active":""),onClick:()=>{"quantity"===x?N("asc"===b?"desc":"asc"):(D("quantity"),N("desc"))},children:["\uD83D\uDCE6 Quantit\xe9 ","quantity"===x&&("asc"===b?"↗️":"↘️")]}),(0,s.jsxs)("button",{className:"sort-btn ".concat("name"===x?"active":""),onClick:()=>{"name"===x?N("asc"===b?"desc":"asc"):(D("name"),N("asc"))},children:["\uD83D\uDD24 Nom ","name"===x&&("asc"===b?"↗️":"↘️")]}),(0,s.jsxs)("button",{className:"sort-btn ".concat("location"===x?"active":""),onClick:()=>{"location"===x?N("asc"===b?"desc":"asc"):(D("location"),N("asc"))},children:["\uD83D\uDCCD Emplacement ","location"===x&&("asc"===b?"↗️":"↘️")]})]}),c.length!==t.length&&(0,s.jsxs)("span",{className:"filter-count",children:[c.length," / ",t.length," articles"]})]})]}),(0,s.jsx)("div",{className:"pantry-grid",children:0===c.length?(0,s.jsxs)("div",{className:"empty-state",children:[(0,s.jsx)("h2",{children:"Aucun article trouv\xe9"}),(0,s.jsx)("p",{children:"Ajustez vos filtres ou ajoutez des articles"})]}):c.map(e=>(0,s.jsx)(v,{item:e,onConsume:()=>G(e.id),onEdit:()=>(function(e){let a=t.find(a=>a.id===e);a&&(T(a),A(!0))})(e.id),onDelete:()=>W(e.id),onUpdateQuantity:J,onOpen:()=>V(e.id)},e.id))})]}),"waste"===P&&R&&(0,s.jsx)(z,{userId:R,onActionComplete:B}),"stats"===P&&(0,s.jsx)("div",{className:"stats-view",children:(0,s.jsxs)("div",{className:"stats-content",style:{background:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(10px)",borderRadius:"16px",padding:"2rem",maxWidth:"800px",margin:"0 auto"},children:[(0,s.jsx)("h2",{style:{marginBottom:"2rem",color:"var(--forest-700)"},children:"\uD83D\uDCCA Vue d'ensemble"}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1.5rem"},children:[(0,s.jsxs)("div",{className:"stat-box",children:[(0,s.jsx)("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:"\uD83D\uDCE6"}),(0,s.jsx)("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"var(--forest-700)"},children:t.length}),(0,s.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--earth-600)"},children:"Produits total"})]}),(0,s.jsxs)("div",{className:"stat-box",children:[(0,s.jsx)("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:"\uD83D\uDD25"}),(0,s.jsx)("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#ef4444"},children:t.filter(e=>"expired"===e.expiration_status).length}),(0,s.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--earth-600)"},children:"Expir\xe9s"})]}),(0,s.jsxs)("div",{className:"stat-box",children:[(0,s.jsx)("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:"⏰"}),(0,s.jsx)("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#f97316"},children:t.filter(e=>"expiring_soon"===e.expiration_status).length}),(0,s.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--earth-600)"},children:"Expire bient\xf4t"})]}),(0,s.jsxs)("div",{className:"stat-box",children:[(0,s.jsx)("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:"✅"}),(0,s.jsx)("div",{style:{fontSize:"2rem",fontWeight:"bold",color:"#22c55e"},children:t.filter(e=>"good"===e.expiration_status).length}),(0,s.jsx)("div",{style:{fontSize:"0.9rem",color:"var(--earth-600)"},children:"Bon \xe9tat"})]})]}),(0,s.jsxs)("div",{style:{marginTop:"2rem",padding:"1.5rem",background:"rgba(255, 255, 255, 0.5)",borderRadius:"12px"},children:[(0,s.jsx)("h3",{style:{marginBottom:"1rem",color:"var(--forest-700)"},children:"\uD83D\uDCA1 Conseil"}),(0,s.jsx)("p",{style:{color:"var(--earth-700)",lineHeight:"1.6"},children:Y.atRiskCount>0?"Vous avez ".concat(Y.atRiskCount,' produit(s) \xe0 risque. Consultez l\'onglet "\xc0 Risque" pour des suggestions anti-gaspillage.'):"Excellent ! Aucun produit \xe0 risque pour le moment. Continuez comme \xe7a ! \uD83C\uDF89"})]})]})}),m&&(0,s.jsx)(y,{open:m,onClose:H,onLotCreated:H}),(0,s.jsx)("button",{className:"pantry-fab",onClick:()=>h(!0),title:"Ajouter un article",children:"+"}),(0,s.jsx)(j,{isOpen:C,onClose:()=>{E(!1),M(null)},onConfirm:X,title:"Supprimer l'article",message:'\xcates-vous s\xfbr de vouloir supprimer "'.concat(null==S?void 0:S.product_name,'" ?'),confirmText:"Supprimer",cancelText:"Annuler"}),q&&L&&(0,s.jsx)(k,{item:L,onUpdate:Q,onCancel:()=>{A(!1),T(null)}})]})}t(7575)},1430:function(e,a,t){"use strict";t.d(a,{A:function(){return m},default:function(){return p}});var s=t(7437),n=t(2265),i=t(2940),r=t(1935),l=t(6780),c=t(690);let o=0,d=null,u={success:{icon:i.Z,color:"green"},error:{icon:r.Z,color:"red"},warning:{icon:l.Z,color:"orange"},info:{icon:c.Z,color:"blue"}},m={success:e=>null==d?void 0:d(e,"success"),error:e=>null==d?void 0:d(e,"error"),warning:e=>null==d?void 0:d(e,"warning"),info:e=>null==d?void 0:d(e,"info")};function h(e){let{toast:a,onRemove:t}=e,{icon:i,color:r}=u[a.type];return(0,n.useEffect)(()=>{let e=setTimeout(()=>{t(a.id)},4e3);return()=>clearTimeout(e)},[a.id,t]),(0,s.jsxs)("div",{className:"toast toast-".concat(r),children:[(0,s.jsxs)("div",{className:"toast-content",children:[(0,s.jsx)(i,{size:20,className:"toast-icon"}),(0,s.jsx)("span",{className:"toast-message",children:a.message})]}),(0,s.jsx)("button",{onClick:()=>t(a.id),className:"toast-close",children:"\xd7"})]})}function p(){let[e,a]=(0,n.useState)([]),t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",s=++o,n={id:s,message:e,type:t};return a(e=>[...e,n]),s},i=e=>{a(a=>a.filter(a=>a.id!==e))};return((0,n.useEffect)(()=>(d=t,()=>{d=null}),[]),0===e.length)?null:(0,s.jsx)("div",{className:"toast-container",children:e.map(e=>(0,s.jsx)(h,{toast:e,onRemove:i},e.id))})}},5626:function(e,a,t){"use strict";t.d(a,{OQ:function(){return r}});var s=t(6887);let n="https://yylkwfikfbottngglaxj.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5bGt3ZmlrZmJvdHRuZ2dsYXhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1NjUwNzAsImV4cCI6MjA3MjE0MTA3MH0.h-GTmBH9onVHNJLLuafw9jwS9G8azVaQGelf-oUK-xc",r=null;if(n&&i)try{console.log("\uD83D\uDD17 Connexion \xe0 Supabase r\xe9el:",n),r=(0,s.eI)(n,i,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}catch(e){console.error("[Supabase] Erreur lors de la cr\xe9ation du client",e instanceof Error?e:Error(String(e)))}else{let e=[!n&&"NEXT_PUBLIC_SUPABASE_URL",!i&&"NEXT_PUBLIC_SUPABASE_ANON_KEY"].filter(Boolean);Error("Supabase non configur\xe9. Variables manquantes: ".concat(e.join(", ")))}},8030:function(e,a,t){"use strict";t.d(a,{Z:function(){return u}});var s=t(2265);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,a,t)=>t?t.toUpperCase():a.toLowerCase()),r=e=>{let a=i(e);return a.charAt(0).toUpperCase()+a.slice(1)},l=function(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return a.filter((e,a,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===a).join(" ").trim()},c=e=>{for(let a in e)if(a.startsWith("aria-")||"role"===a||"title"===a)return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,s.forwardRef)((e,a)=>{let{color:t="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:r,className:d="",children:u,iconNode:m,...h}=e;return(0,s.createElement)("svg",{ref:a,...o,width:n,height:n,stroke:t,strokeWidth:r?24*Number(i)/Number(n):i,className:l("lucide",d),...!u&&!c(h)&&{"aria-hidden":"true"},...h},[...m.map(e=>{let[a,t]=e;return(0,s.createElement)(a,t)}),...Array.isArray(u)?u:[u]])}),u=(e,a)=>{let t=(0,s.forwardRef)((t,i)=>{let{className:c,...o}=t;return(0,s.createElement)(d,{ref:i,iconNode:a,className:l("lucide-".concat(n(r(e))),"lucide-".concat(e),c),...o})});return t.displayName=r(e),t}},6780:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});let s=(0,t(8030).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},2940:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});let s=(0,t(8030).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1935:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});let s=(0,t(8030).Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},690:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});let s=(0,t(8030).Z)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},2513:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});let s=(0,t(8030).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},4697:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});let s=(0,t(8030).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},6463:function(e,a,t){"use strict";var s=t(1169);t.o(s,"useParams")&&t.d(a,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(a,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(a,{useSearchParams:function(){return s.useSearchParams}})},8299:function(){},937:function(){},6079:function(){},9122:function(){},5929:function(){},7575:function(){},5996:function(){},4506:function(){}},function(e){e.O(0,[389,887,392,971,23,744],function(){return e(e.s=913)}),_N_E=e.O()}]);