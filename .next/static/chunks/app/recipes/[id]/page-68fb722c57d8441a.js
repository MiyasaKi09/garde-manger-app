(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[836],{8732:function(e,n,i){Promise.resolve().then(i.bind(i,4300))},4300:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return j}});var s=i(7437),t=i(2265),r=i(6463),a=i(5626);let l={g:"mass",kg:"mass",ml:"vol",cl:"vol",l:"vol",u:"count"},c={g:1,kg:1e3,ml:1,cl:10,l:1e3,u:1},o=e=>l[(e||"").toLowerCase()]||null,d=(e,n)=>Number(e)*(c[(n||"").toLowerCase()]||1),u=(e,n)=>Number(e)/(c[(n||"").toLowerCase()]||1);var m=i(4817),h=i(4697);let p=(e,n)=>{let i=[];for(let e=0;e<=n.length;e++)i[e]=[e];for(let n=0;n<=e.length;n++)i[0][n]=n;for(let s=1;s<=n.length;s++)for(let t=1;t<=e.length;t++)n.charAt(s-1)===e.charAt(t-1)?i[s][t]=i[s-1][t-1]:i[s][t]=Math.min(i[s-1][t-1]+1,i[s][t-1]+1,i[s-1][t]+1);return i[n.length][e.length]},g=(e,n)=>{if(!e||e.length<2)return[];let i=e.toLowerCase().trim(),s=[];return n.forEach(e=>{var n,t;let r=e.name.toLowerCase(),a=(null===(n=e.category)||void 0===n?void 0:n.toLowerCase())||"",l=(null===(t=e.subcategory)||void 0===t?void 0:t.toLowerCase())||"",c=0,o="";if(r===i)c=100,o="exact";else if(r.startsWith(i))c=90,o="prefix";else if(r.includes(i))c=80,o="contains";else if(a.includes(i)||l.includes(i))c=70,o="category";else{let e=p(i,r);e<=2&&i.length>3&&(c=60-10*e,o="fuzzy")}c>0&&s.push({...e,score:c,matchType:o})}),s.sort((e,n)=>n.score-e.score).slice(0,20)};function x(e){let{availableIngredients:n,selectedIngredientId:i,onIngredientSelect:r,placeholder:a="Rechercher un ingr\xe9dient..."}=e,[l,c]=(0,t.useState)(""),[o,d]=(0,t.useState)(!1),[u,p]=(0,t.useState)([]),[x,v]=(0,t.useState)(null),j=(0,t.useRef)(null),f=(0,t.useRef)(null);(0,t.useEffect)(()=>{if(i){let e=n.find(e=>e.id===parseInt(i));e&&(v(e),c(e.name))}else v(null),c("")},[i,n]);let _=(0,t.useCallback)(e=>{if(c(e),e.length<2){p([]),d(!1);return}p(g(e,n)),d(!0)},[n]),N=e=>{v(e),c(e.name),d(!1),r(e.id)};return(0,t.useEffect)(()=>{let e=e=>{f.current&&!f.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,s.jsxs)("div",{className:"ingredient-search-selector",ref:f,children:[(0,s.jsxs)("div",{className:"search-input-container",children:[(0,s.jsx)(m.Z,{className:"search-icon",size:16}),(0,s.jsx)("input",{ref:j,type:"text",value:l,onChange:e=>_(e.target.value),onFocus:()=>{l.length>=2&&d(!0)},placeholder:a,className:"search-input"}),x&&(0,s.jsx)("button",{type:"button",onClick:()=>{var e;v(null),c(""),d(!1),r(""),null===(e=j.current)||void 0===e||e.focus()},className:"clear-button",title:"Effacer la s\xe9lection",children:(0,s.jsx)(h.Z,{size:16})})]}),o&&u.length>0&&(0,s.jsx)("div",{className:"search-dropdown",children:(0,s.jsx)("div",{className:"search-results",children:u.map(e=>(0,s.jsxs)("div",{className:"search-result-item",onClick:()=>N(e),children:[(0,s.jsxs)("div",{className:"ingredient-info",children:[(0,s.jsx)("div",{className:"ingredient-name",children:e.name}),(0,s.jsxs)("div",{className:"ingredient-details",children:[e.category,e.subcategory&&" • ".concat(e.subcategory)]})]}),(0,s.jsxs)("div",{className:"match-indicator",children:["exact"===e.matchType&&"\uD83C\uDFAF","prefix"===e.matchType&&"\uD83D\uDCCD","contains"===e.matchType&&"\uD83D\uDD0D","category"===e.matchType&&"\uD83D\uDCC2","fuzzy"===e.matchType&&"\uD83D\uDCA1"]})]},e.id))})}),o&&l.length>=2&&0===u.length&&(0,s.jsx)("div",{className:"search-dropdown",children:(0,s.jsx)("div",{className:"no-results",children:(0,s.jsxs)("div",{className:"no-results-text",children:['Aucun ingr\xe9dient trouv\xe9 pour "',l,'"']})})})]})}function v(e){let{recipeId:n,servings:i=1}=e,[r,l]=(0,t.useState)(null),[c,o]=(0,t.useState)(!0),[d,u]=(0,t.useState)(null);return((0,t.useEffect)(()=>{async function e(){try{o(!0),u(null),console.log("\uD83C\uDF4E Chargement nutritionnel pour recette",n);let{data:e,error:s}=await a.OQ.from("recipe_nutrition_cache").select("*").eq("recipe_id",n).maybeSingle();if(s&&console.error("❌ Erreur lecture cache:",s),e)console.log("⚡ Charg\xe9 depuis le cache"),l({Calories:{perServing:e.calories_per_serving*i,total:e.calories_total,unit:"kcal"},Protéines:{perServing:e.proteines_per_serving*i,total:e.proteines_total,unit:"g"},Glucides:{perServing:e.glucides_per_serving*i,total:e.glucides_total,unit:"g"},Lipides:{perServing:e.lipides_per_serving*i,total:e.lipides_total,unit:"g"}});else{if(console.log("\uD83D\uDD04 Pas de cache, d\xe9clenchement du calcul..."),!(await fetch("/api/recipes/".concat(n,"/nutrition/calculate"),{method:"POST"})).ok)throw Error("Erreur lors du calcul nutritionnel");console.log("✅ Calcul termin\xe9");let{data:e,error:s}=await a.OQ.from("recipe_nutrition_cache").select("*").eq("recipe_id",n).single();if(s||!e){u("Donn\xe9es nutritionnelles non disponibles");return}l({Calories:{perServing:e.calories_per_serving*i,total:e.calories_total,unit:"kcal"},Protéines:{perServing:e.proteines_per_serving*i,total:e.proteines_total,unit:"g"},Glucides:{perServing:e.glucides_per_serving*i,total:e.glucides_total,unit:"g"},Lipides:{perServing:e.lipides_per_serving*i,total:e.lipides_total,unit:"g"}})}}catch(e){console.error("❌ Erreur chargement nutrition:",e),u(e.message||"Erreur lors du calcul nutritionnel")}finally{o(!1)}}n&&e()},[n,i]),c)?(0,s.jsxs)("div",{className:"nutrition-facts loading",children:[(0,s.jsx)("div",{className:"loading-spinner",children:"⏳"}),(0,s.jsx)("p",{children:"Calcul des valeurs nutritionnelles..."})]}):d?(0,s.jsxs)("div",{className:"nutrition-facts error",children:[(0,s.jsx)("div",{className:"error-icon",children:"ℹ️"}),(0,s.jsx)("p",{className:"error-message",children:d}),(0,s.jsx)("p",{className:"error-hint",children:"Les donn\xe9es nutritionnelles seront disponibles une fois que les ingr\xe9dients auront \xe9t\xe9 li\xe9s \xe0 la base Ciqual."})]}):r&&0!==Object.keys(r).length?(0,s.jsxs)("div",{className:"nutrition-facts",children:[(0,s.jsxs)("div",{className:"nutrition-header",children:[(0,s.jsx)("h3",{children:"\uD83D\uDCCA Informations Nutritionnelles"}),(0,s.jsxs)("p",{className:"servings-info",children:["Par portion ",i>1&&"(\xd7".concat(i,")")]})]}),(0,s.jsxs)("div",{className:"nutrition-grid",children:[r.Calories&&(0,s.jsxs)("div",{className:"nutrient-row calories",children:[(0,s.jsx)("span",{className:"nutrient-icon",children:"\uD83D\uDD25"}),(0,s.jsx)("span",{className:"nutrient-name",children:"\xc9nergie"}),(0,s.jsxs)("span",{className:"nutrient-value",children:[(0,s.jsx)("strong",{children:r.Calories.perServing.toFixed(0)}),(0,s.jsx)("span",{className:"unit",children:r.Calories.unit})]})]}),r.Protéines&&(0,s.jsxs)("div",{className:"nutrient-row protein",children:[(0,s.jsx)("span",{className:"nutrient-icon",children:"\uD83E\uDD69"}),(0,s.jsx)("span",{className:"nutrient-name",children:"Prot\xe9ines"}),(0,s.jsxs)("span",{className:"nutrient-value",children:[(0,s.jsx)("strong",{children:r.Protéines.perServing.toFixed(1)}),(0,s.jsx)("span",{className:"unit",children:r.Protéines.unit})]})]}),r.Glucides&&(0,s.jsxs)("div",{className:"nutrient-row carbs",children:[(0,s.jsx)("span",{className:"nutrient-icon",children:"\uD83C\uDF3E"}),(0,s.jsx)("span",{className:"nutrient-name",children:"Glucides"}),(0,s.jsxs)("span",{className:"nutrient-value",children:[(0,s.jsx)("strong",{children:r.Glucides.perServing.toFixed(1)}),(0,s.jsx)("span",{className:"unit",children:r.Glucides.unit})]})]}),r.Lipides&&(0,s.jsxs)("div",{className:"nutrient-row fat",children:[(0,s.jsx)("span",{className:"nutrient-icon",children:"\uD83E\uDDC8"}),(0,s.jsx)("span",{className:"nutrient-name",children:"Lipides"}),(0,s.jsxs)("span",{className:"nutrient-value",children:[(0,s.jsx)("strong",{children:r.Lipides.perServing.toFixed(1)}),(0,s.jsx)("span",{className:"unit",children:r.Lipides.unit})]})]})]}),(0,s.jsx)("div",{className:"nutrition-total",children:(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{children:"Voir les totaux pour toute la recette"}),(0,s.jsxs)("div",{className:"total-grid",children:[r.Calories&&(0,s.jsxs)("div",{className:"total-item",children:[(0,s.jsx)("span",{children:"\xc9nergie totale:"}),(0,s.jsxs)("span",{children:[r.Calories.total.toFixed(0)," kcal"]})]}),r.Protéines&&(0,s.jsxs)("div",{className:"total-item",children:[(0,s.jsx)("span",{children:"Prot\xe9ines totales:"}),(0,s.jsxs)("span",{children:[r.Protéines.total.toFixed(1)," g"]})]}),r.Glucides&&(0,s.jsxs)("div",{className:"total-item",children:[(0,s.jsx)("span",{children:"Glucides totaux:"}),(0,s.jsxs)("span",{children:[r.Glucides.total.toFixed(1)," g"]})]}),r.Lipides&&(0,s.jsxs)("div",{className:"total-item",children:[(0,s.jsx)("span",{children:"Lipides totaux:"}),(0,s.jsxs)("span",{children:[r.Lipides.total.toFixed(1)," g"]})]})]})]})}),(0,s.jsx)("div",{className:"nutrition-disclaimer",children:(0,s.jsx)("small",{children:"⚡ Valeurs calcul\xe9es automatiquement en tenant compte de la m\xe9thode de cuisson"})})]}):(0,s.jsx)("div",{className:"nutrition-facts empty",children:(0,s.jsx)("p",{children:"Donn\xe9es nutritionnelles non disponibles"})})}function j(){let{id:e}=(0,r.useParams)();(0,r.useRouter)();let[n,i]=(0,t.useState)(null),[l,c]=(0,t.useState)([]),[m,h]=(0,t.useState)({}),[p,g]=(0,t.useState)({}),[j,f]=(0,t.useState)({}),[_,N]=(0,t.useState)(!0),[D,b]=(0,t.useState)(!1),[y,C]=(0,t.useState)(""),[k,w]=(0,t.useState)(!1),[S,I]=(0,t.useState)("basic"),[E,A]=(0,t.useState)({}),[q,P]=(0,t.useState)([]),[L,R]=(0,t.useState)([]),[O,M]=(0,t.useState)([]),[F,T]=(0,t.useState)(!0);async function z(){try{console.log("\uD83D\uDD0D Chargement des ingr\xe9dients disponibles...");let{data:e,error:n}=await a.OQ.from("canonical_foods").select("id, name, category, subcategory").order("category",{ascending:!0}).order("name",{ascending:!0});if(n)throw console.error("❌ Erreur Supabase:",n),n;console.log("✅ Ingr\xe9dients charg\xe9s:",(null==e?void 0:e.length)||0,"ingr\xe9dients"),console.log("\uD83D\uDCCB Premiers ingr\xe9dients:",null==e?void 0:e.slice(0,5)),M(e||[])}catch(e){console.error("❌ Erreur chargement ingr\xe9dients:",e);try{let{data:e,error:n}=await a.OQ.from("canonical_foods").select("*").limit(10);console.log("\uD83D\uDD04 Tentative fallback:",e),!n&&e&&M(e)}catch(e){console.error("❌ Fallback \xe9chou\xe9:",e)}}}function Z(e,n,i){R(s=>{let t=[...s];return t[e]={...t[e],[n]:i},t})}function B(e,n,i){P(s=>{let t=[...s];if(t[e]={...t[e],[n]:i},"canonical_food_id"===n){let n=O.find(e=>e.id===parseInt(i));n&&(t[e].canonical_food_name=n.name)}return t})}async function G(){try{b(!0);let n=L.filter(e=>e.text.trim()).map((e,n)=>"".concat(n+1,". ").concat(e.text.trim())).join("\n\n"),i={name:E.name,description:E.description,short_description:E.short_description,prep_min:parseInt(E.prep_min)||0,cook_min:parseInt(E.cook_min)||0,rest_min:parseInt(E.rest_min)||0,servings:parseInt(E.servings)||4,instructions:n,chef_tips:E.chef_tips,is_vegetarian:E.is_vegetarian,is_vegan:E.is_vegan,is_gluten_free:E.is_gluten_free,updated_at:new Date().toISOString()},{error:s}=await a.OQ.from("recipes").update(i).eq("id",e);if(s)throw s;let{error:t}=await a.OQ.from("recipe_ingredients").delete().eq("recipe_id",e);if(t)throw t;let r=q.filter(e=>e.canonical_food_id&&e.quantity>0).map(n=>({recipe_id:parseInt(e),canonical_food_id:parseInt(n.canonical_food_id),quantity:parseFloat(n.quantity),unit:n.unit,notes:n.notes||null,created_at:new Date().toISOString()}));if(r.length>0){let{error:e}=await a.OQ.from("recipe_ingredients").insert(r);if(e)throw e}window.location.reload()}catch(e){console.error("Erreur sauvegarde:",e),alert("Erreur lors de la sauvegarde: ".concat(e.message))}finally{b(!1)}}if((0,t.useEffect)(()=>{(async()=>{N(!0),await z(),console.log("Chargement de la recette avec ID:",e);let{data:n,error:s}=await a.OQ.from("recipes").select("*").eq("id",e).single();if(s){console.error("Erreur premi\xe8re requ\xeate:",s);let{data:i,error:t}=await a.OQ.from("recipes").select("*").eq("id",e).single();t?console.error("Erreur requ\xeate fallback:",t):(n=i,s=null)}if(s){console.error("Erreur lors du chargement de la recette:",s),console.log("ID recherch\xe9:",e),C("Recette avec l'ID ".concat(e," introuvable. Erreur: ").concat(s.message)),N(!1);return}if(!n){console.error("Aucune recette trouv\xe9e avec l'ID:",e),C("Aucune recette trouv\xe9e avec l'ID ".concat(e)),N(!1);return}console.log("Recette trouv\xe9e:",n),console.log("Colonnes disponibles:",Object.keys(n));let t=((null==n?void 0:n.prep_time_minutes)||0)+((null==n?void 0:n.cook_time_minutes)||0)+((null==n?void 0:n.rest_min)||0);i({id:null==n?void 0:n.id,title:(null==n?void 0:n.title)||(null==n?void 0:n.name),description:null==n?void 0:n.description,short_description:null==n?void 0:n.short_description,time_min:t,prep_min:null==n?void 0:n.prep_time_minutes,cook_min:null==n?void 0:n.cook_time_minutes,rest_min:null==n?void 0:n.rest_min,servings:null==n?void 0:n.servings,steps:null==n?void 0:n.instructions,myko_score:null==n?void 0:n.myko_score,chef_tips:null==n?void 0:n.chef_tips,is_vegetarian:null==n?void 0:n.is_vegetarian,is_vegan:null==n?void 0:n.is_vegan,is_gluten_free:null==n?void 0:n.is_gluten_free});try{console.log("\uD83E\uDD55 Chargement des ingr\xe9dients pour la recette:",e);let{data:n,error:i}=await a.OQ.from("recipe_ingredients").select("\n          id,\n          quantity,\n          unit,\n          notes,\n          canonical_food_id,\n          archetype_id,\n          canonical_foods (\n            id,\n            canonical_name,\n            category_id,\n            primary_unit\n          ),\n          archetypes (\n            id,\n            name,\n            canonical_food_id,\n            process,\n            primary_unit\n          )\n        ").eq("recipe_id",e);i&&(console.error("❌ Erreur chargement ingr\xe9dients:",i),n=[]),console.log("✅ ".concat((null==n?void 0:n.length)||0," ingr\xe9dients charg\xe9s"));let s=(n||[]).map(e=>{let n,i,s,t;return e.archetype_id&&e.archetypes?(n=e.archetypes.name,i=e.archetypes.primary_unit||e.unit,s="archetype",t=e.archetype_id):e.canonical_food_id&&e.canonical_foods?(n=e.canonical_foods.canonical_name,i=e.canonical_foods.primary_unit||e.unit,s="canonical_food",t=e.canonical_food_id):(n="Ingr\xe9dient inconnu",i=e.unit||"g",s="unknown",t=null),{...e,name:n,primary_unit:i,source_type:s,source_id:t,canonical_foods:e.canonical_foods||{id:t,name:n}}});c(s),console.log("✅ Ingr\xe9dients charg\xe9s:",s.length,"ingr\xe9dients"),console.log("\uD83D\uDCCB D\xe9tail des ingr\xe9dients:",s),s.length>0&&console.log("\uD83D\uDCCC Premier ingr\xe9dient:",s[0]),h({}),g({})}catch(e){console.error("Erreur ingr\xe9dients:",e),c([])}N(!1)})()},[e]),(0,t.useMemo)(()=>{let e={};for(let i of l){var n;let s=i.product_id,t=(i.unit||(null===(n=i.product)||void 0===n?void 0:n.default_unit)||"g").toLowerCase(),r=Number(i.qty||0),a=p[s]||{},l=0,c=j[s]||{};for(let e of m[s]||[]){let n=c[e.id];if(!(null==n?void 0:n.checked))continue;let i=Number(n.qty||0);i>0&&(l+=function e(n,i,s){var t,r;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=Number(null!==(t=a.density_g_per_ml)&&void 0!==t?t:1),c=Number(null!==(r=a.grams_per_unit)&&void 0!==r?r:0),m=o(i),h=o(s);return m&&h?m===h?{qty:u(d(n,i),s),unit:s}:"count"===m&&"mass"===h&&c>0?{qty:u(n*c,s),unit:s}:"mass"===m&&"count"===h&&c>0?{qty:u(d(n,i)/c,s),unit:s}:"vol"===m&&"mass"===h?{qty:u(d(n,i)*l,s),unit:s}:"mass"===m&&"vol"===h?{qty:u(d(n,i)/l,s),unit:s}:"count"===m&&"vol"===h&&c>0?e(n*c,"g",s,{density_g_per_ml:l,grams_per_unit:c}):"vol"===m&&"count"===h&&c>0?e(n,i,"g",{density_g_per_ml:l,grams_per_unit:c})&&e(u(d(n,i)*l,"g").qty,"g","u",{grams_per_unit:c}):{qty:n,unit:i}:{qty:n,unit:s}}(i,n.unit||e.unit,t,a).qty)}e[s]={needQty:r,needUnit:t,covered:l,ok:l+1e-9>=r||i.optional}}return e},[l,j,m,p]),_)return(0,s.jsx)("div",{className:"recipe-detail-container",children:(0,s.jsx)("div",{className:"loading-spinner",style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",fontSize:"1.2rem",color:"#374151"},children:"Chargement de la recette..."})});if(y)return(0,s.jsx)("div",{className:"recipe-detail-container",children:(0,s.jsxs)("div",{className:"error-message",style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[(0,s.jsx)("h2",{style:{color:"#dc2626"},children:"Erreur"}),(0,s.jsx)("p",{children:y}),(0,s.jsx)("button",{onClick:()=>window.history.back(),style:{padding:"10px 20px",background:"#dc2626",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},children:"← Retour"})]})});if(!n)return(0,s.jsx)("div",{className:"recipe-detail-container",children:(0,s.jsxs)("div",{className:"error-message",style:{background:"rgba(107, 114, 128, 0.1)",border:"1px solid rgba(107, 114, 128, 0.3)",borderRadius:"12px",padding:"20px",textAlign:"center"},children:[(0,s.jsx)("h2",{children:"Recette introuvable"}),(0,s.jsxs)("p",{children:["Aucune recette trouv\xe9e avec l'ID: ",e]}),(0,s.jsx)("button",{onClick:()=>window.history.back(),style:{padding:"10px 20px",background:"#6b7280",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},children:"← Retour aux recettes"})]})});let Q=(n.prep_min||0)+(n.cook_min||0)+(n.rest_min||0);return k?(0,s.jsxs)("div",{className:"recipes-container",children:[(0,s.jsxs)("div",{className:"edit-header-bar",children:[(0,s.jsxs)("h1",{children:['✏️ \xc9dition de "',n.title,'"']}),(0,s.jsxs)("div",{className:"edit-actions",children:[(0,s.jsx)("button",{className:"btn-tertiary",onClick:()=>{console.log("\uD83D\uDCCA \xc9tat actuel:"),console.log("- Ingr\xe9dients disponibles:",O.length),console.log("- Premiers ingr\xe9dients:",O.slice(0,3)),alert("".concat(O.length," ingr\xe9dients charg\xe9s (voir console)"))},children:"\uD83D\uDD0D Test donn\xe9es"}),(0,s.jsx)("button",{className:"btn-primary",onClick:G,disabled:D,children:D?"⏳ Sauvegarde...":"\uD83D\uDCBE Sauvegarder"}),(0,s.jsx)("button",{className:"btn-secondary",onClick:function(){w(!1),A({}),P([]),R([])},children:"❌ Annuler"})]})]}),(0,s.jsxs)("div",{className:"edit-tabs",children:[(0,s.jsx)("button",{className:"tab-btn ".concat("basic"===S?"active":""),onClick:()=>I("basic"),children:"\uD83D\uDCDD Informations"}),(0,s.jsx)("button",{className:"tab-btn ".concat("ingredients"===S?"active":""),onClick:()=>I("ingredients"),children:"\uD83E\uDD55 Ingr\xe9dients"}),(0,s.jsx)("button",{className:"tab-btn ".concat("instructions"===S?"active":""),onClick:()=>I("instructions"),children:"\uD83D\uDCCB Instructions"}),(0,s.jsx)("button",{className:"tab-btn ".concat("nutrition"===S?"active":""),onClick:()=>I("nutrition"),children:"\uD83D\uDCCA Nutrition"})]}),(0,s.jsxs)("div",{className:"edit-content",children:["basic"===S&&(0,s.jsxs)("div",{className:"edit-section",children:[(0,s.jsx)("h2",{children:"\uD83D\uDCDD Informations g\xe9n\xe9rales"}),(0,s.jsxs)("div",{className:"form-grid",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Nom de la recette *"}),(0,s.jsx)("input",{type:"text",value:E.name||"",onChange:e=>A(n=>({...n,name:e.target.value})),placeholder:"Ex: Ratatouille proven\xe7ale",required:!0})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Description courte"}),(0,s.jsx)("input",{type:"text",value:E.short_description||"",onChange:e=>A(n=>({...n,short_description:e.target.value})),placeholder:"Ex: Mijot\xe9 de l\xe9gumes du soleil"})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Description compl\xe8te"}),(0,s.jsx)("textarea",{value:E.description||"",onChange:e=>A(n=>({...n,description:e.target.value})),placeholder:"D\xe9crivez la recette, son origine, ses sp\xe9cificit\xe9s...",rows:"4"})]}),(0,s.jsxs)("div",{className:"form-grid",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Temps de pr\xe9paration (min)"}),(0,s.jsx)("input",{type:"number",min:"0",value:E.prep_min||"",onChange:e=>A(n=>({...n,prep_min:e.target.value}))})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Temps de cuisson (min)"}),(0,s.jsx)("input",{type:"number",min:"0",value:E.cook_min||"",onChange:e=>A(n=>({...n,cook_min:e.target.value}))})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Temps de repos (min)"}),(0,s.jsx)("input",{type:"number",min:"0",value:E.rest_min||"",onChange:e=>A(n=>({...n,rest_min:e.target.value}))})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Portions"}),(0,s.jsx)("input",{type:"number",min:"1",value:E.servings||"",onChange:e=>A(n=>({...n,servings:e.target.value}))})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"R\xe9gimes alimentaires"}),(0,s.jsxs)("div",{className:"checkboxes-group",children:[(0,s.jsxs)("label",{className:"checkbox-label",children:[(0,s.jsx)("input",{type:"checkbox",checked:E.is_vegetarian||!1,onChange:e=>A(n=>({...n,is_vegetarian:e.target.checked}))}),"\uD83E\uDD6C V\xe9g\xe9tarien"]}),(0,s.jsxs)("label",{className:"checkbox-label",children:[(0,s.jsx)("input",{type:"checkbox",checked:E.is_vegan||!1,onChange:e=>A(n=>({...n,is_vegan:e.target.checked}))}),"\uD83C\uDF31 Vegan"]}),(0,s.jsxs)("label",{className:"checkbox-label",children:[(0,s.jsx)("input",{type:"checkbox",checked:E.is_gluten_free||!1,onChange:e=>A(n=>({...n,is_gluten_free:e.target.checked}))}),"\uD83C\uDF3E Sans gluten"]})]})]})]}),"ingredients"===S&&(0,s.jsxs)("div",{className:"edit-section",children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsx)("h2",{children:"\uD83E\uDD55 Ingr\xe9dients"}),(0,s.jsx)("button",{className:"add-btn",onClick:function(){P(e=>[...e,{id:Math.random(),canonical_food_id:"",canonical_food_name:"",quantity:0,unit:"g",notes:""}])},children:"+ Ajouter un ingr\xe9dient"})]}),(0,s.jsxs)("div",{className:"ingredients-list",children:[q.map((e,n)=>(0,s.jsxs)("div",{className:"ingredient-row",children:[(0,s.jsx)(x,{availableIngredients:O,selectedIngredientId:e.canonical_food_id,onIngredientSelect:e=>B(n,"canonical_food_id",e),placeholder:"Rechercher un ingr\xe9dient..."}),(0,s.jsx)("input",{type:"number",step:"0.1",min:"0",value:e.quantity||"",onChange:e=>B(n,"quantity",e.target.value),placeholder:"Qt\xe9"}),(0,s.jsxs)("select",{value:e.unit||"g",onChange:e=>B(n,"unit",e.target.value),children:[(0,s.jsx)("option",{value:"g",children:"g"}),(0,s.jsx)("option",{value:"kg",children:"kg"}),(0,s.jsx)("option",{value:"ml",children:"ml"}),(0,s.jsx)("option",{value:"l",children:"l"}),(0,s.jsx)("option",{value:"unit\xe9",children:"unit\xe9"}),(0,s.jsx)("option",{value:"c.\xe0.s",children:"c.\xe0.s"}),(0,s.jsx)("option",{value:"c.\xe0.c",children:"c.\xe0.c"}),(0,s.jsx)("option",{value:"pinc\xe9e",children:"pinc\xe9e"})]}),(0,s.jsx)("input",{type:"text",value:e.notes||"",onChange:e=>B(n,"notes",e.target.value),placeholder:"Notes (optionnel)"}),(0,s.jsx)("button",{className:"remove-btn",onClick:()=>{P(e=>e.filter((e,i)=>i!==n))},title:"Supprimer cet ingr\xe9dient",children:"\uD83D\uDDD1️"})]},e.id)),0===q.length&&(0,s.jsx)("div",{className:"empty-ingredients",children:(0,s.jsx)("p",{children:'Aucun ingr\xe9dient ajout\xe9. Cliquez sur "Ajouter un ingr\xe9dient" pour commencer.'})})]})]}),"instructions"===S&&(0,s.jsxs)("div",{className:"edit-section",children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsx)("h2",{children:"\uD83D\uDCCB Instructions"}),(0,s.jsx)("button",{className:"add-btn",onClick:function(){R(e=>[...e,{id:Math.random(),text:"",duration:"",type:"preparation"}])},children:"+ Ajouter une \xe9tape"})]}),(0,s.jsxs)("div",{className:"instructions-list",children:[L.map((e,n)=>(0,s.jsxs)("div",{className:"instruction-block",children:[(0,s.jsxs)("div",{className:"instruction-header",children:[(0,s.jsxs)("div",{className:"step-number",children:["\xc9tape ",n+1]}),(0,s.jsx)("button",{className:"remove-btn",onClick:()=>{R(e=>e.filter((e,i)=>i!==n))},title:"Supprimer cette \xe9tape",children:"\uD83D\uDDD1️"})]}),(0,s.jsx)("textarea",{value:e.text||"",onChange:e=>Z(n,"text",e.target.value),placeholder:"D\xe9crivez l'\xe9tape ".concat(n+1," en d\xe9tail..."),rows:"3"}),(0,s.jsxs)("div",{className:"instruction-meta",children:[(0,s.jsx)("input",{type:"number",min:"0",value:e.duration||"",onChange:e=>Z(n,"duration",e.target.value),placeholder:"Temps (min)",style:{width:"120px"}}),(0,s.jsxs)("select",{value:e.type||"preparation",onChange:e=>Z(n,"type",e.target.value),style:{width:"150px"},children:[(0,s.jsx)("option",{value:"preparation",children:"Pr\xe9paration"}),(0,s.jsx)("option",{value:"cooking",children:"Cuisson"}),(0,s.jsx)("option",{value:"resting",children:"Repos"}),(0,s.jsx)("option",{value:"assembly",children:"Assemblage"})]})]})]},e.id)),0===L.length&&(0,s.jsx)("div",{className:"empty-instructions",children:(0,s.jsx)("p",{children:'Aucune \xe9tape ajout\xe9e. Cliquez sur "Ajouter une \xe9tape" pour commencer.'})})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"\uD83D\uDCA1 Conseils du chef (optionnel)"}),(0,s.jsx)("textarea",{value:E.chef_tips||"",onChange:e=>A(n=>({...n,chef_tips:e.target.value})),placeholder:"Astuces, variations, conseils de pr\xe9sentation...",rows:"3"})]})]}),"nutrition"===S&&(0,s.jsxs)("div",{className:"edit-section",children:[(0,s.jsx)("h2",{children:"\uD83D\uDCCA Informations nutritionnelles"}),(0,s.jsx)("p",{style:{color:"#6b7280",fontStyle:"italic",marginBottom:"20px"},children:"Les informations nutritionnelles seront calcul\xe9es automatiquement selon les ingr\xe9dients ajout\xe9s. Cette section sera d\xe9velopp\xe9e dans une prochaine version."}),(0,s.jsx)("div",{className:"form-grid",children:(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Score Myko estim\xe9"}),(0,s.jsx)("input",{type:"number",min:"0",max:"100",value:n.myko_score||"",placeholder:"Sera calcul\xe9 automatiquement",disabled:!0})]})})]})]})]}):(0,s.jsxs)("div",{className:"recipe-detail-container",children:[(0,s.jsxs)("div",{className:"recipe-header",children:[(0,s.jsx)("button",{onClick:()=>window.history.back(),className:"back-button",children:"← Retour aux recettes"}),(0,s.jsxs)("div",{className:"recipe-title-section",children:[(0,s.jsx)("h1",{className:"recipe-title",children:n.title}),(0,s.jsx)("div",{className:"recipe-badges",children:(0,s.jsxs)("span",{className:"myko-score ".concat(n.myko_score>=80?"high-score":"medium-score"),children:[n.myko_score,"★ Myko"]})})]}),n.description&&(0,s.jsx)("p",{className:"recipe-description",children:n.description})]}),(0,s.jsxs)("div",{className:"recipe-content",children:[(0,s.jsxs)("div",{className:"recipe-info-cards",children:[(0,s.jsxs)("div",{className:"info-card",children:[(0,s.jsx)("div",{className:"info-icon",children:"⏱️"}),(0,s.jsxs)("div",{className:"info-content",children:[(0,s.jsx)("div",{className:"info-label",children:"Temps total"}),(0,s.jsxs)("div",{className:"info-value",children:[Q," min"]}),(0,s.jsxs)("div",{className:"info-details",children:[n.prep_min>0&&"Prep: ".concat(n.prep_min,"min"),n.cook_min>0&&" • Cuisson: ".concat(n.cook_min,"min"),n.rest_min>0&&" • Repos: ".concat(n.rest_min,"min")]})]})]}),(0,s.jsxs)("div",{className:"info-card",children:[(0,s.jsx)("div",{className:"info-icon",children:"\uD83D\uDC65"}),(0,s.jsxs)("div",{className:"info-content",children:[(0,s.jsx)("div",{className:"info-label",children:"Portions"}),(0,s.jsx)("div",{className:"info-value",children:n.servings||"Non d\xe9fini"})]})]}),(0,s.jsxs)("div",{className:"info-card",children:[(0,s.jsx)("div",{className:"info-icon",children:"\uD83D\uDCCA"}),(0,s.jsxs)("div",{className:"info-content",children:[(0,s.jsx)("div",{className:"info-label",children:"Score Myko"}),(0,s.jsxs)("div",{className:"info-value",children:[n.myko_score,"/100"]})]})]}),(0,s.jsxs)("div",{className:"info-card",children:[(0,s.jsx)("div",{className:"info-icon",children:"\uD83C\uDF31"}),(0,s.jsxs)("div",{className:"info-content",children:[(0,s.jsx)("div",{className:"info-label",children:"R\xe9gime"}),(0,s.jsx)("div",{className:"info-value",children:n.is_vegan?"Vegan":n.is_vegetarian?"V\xe9g\xe9tarien":"Omnivore"})]})]})]}),(0,s.jsxs)("div",{className:"recipe-body",children:[(0,s.jsxs)("div",{className:"ingredients-section",children:[(0,s.jsxs)("h2",{children:["Ingr\xe9dients (",l.length,")"]}),l.length>0?(0,s.jsx)("ul",{className:"ingredients-list",children:l.map((e,n)=>{var i,t;let r=e.name||(null===(i=e.canonical_foods)||void 0===i?void 0:i.name)||"Ingr\xe9dient inconnu",a=e.canonical_food_id||e.archetype_id,l=a?"/produits/".concat(a):null;return(0,s.jsxs)("li",{className:"ingredient-item",children:[(0,s.jsxs)("span",{className:"ingredient-quantity",children:[(t=e.quantity,(e.unit||"").toLowerCase(),Math.round(100*Number(t))/100)," ",e.unit]}),l?(0,s.jsx)("a",{href:l,className:"ingredient-name ingredient-link",style:{color:"#059669",textDecoration:"none",cursor:"pointer",transition:"color 0.2s"},onMouseEnter:e=>e.target.style.color="#047857",onMouseLeave:e=>e.target.style.color="#059669",children:r}):(0,s.jsx)("span",{className:"ingredient-name",children:r}),e.notes&&(0,s.jsxs)("span",{className:"ingredient-notes",children:["(",e.notes,")"]})]},e.id||n)})}):(0,s.jsx)("p",{className:"no-ingredients",style:{color:"#6b7280",fontStyle:"italic"},children:"Aucun ingr\xe9dient d\xe9fini pour cette recette."}),(0,s.jsx)(v,{recipeId:parseInt(e),servings:1})]}),(0,s.jsxs)("div",{className:"instructions-section",children:[(0,s.jsx)("h2",{children:"Instructions"}),(0,s.jsx)("div",{className:"instructions-content",children:n.steps?(0,s.jsx)("p",{className:"instructions-text",children:n.steps}):(0,s.jsx)("p",{style:{color:"#6b7280",fontStyle:"italic"},children:"Instructions non disponibles"})}),n.chef_tips&&(0,s.jsxs)("div",{className:"chef-tips",children:[(0,s.jsx)("h3",{children:"\uD83D\uDCA1 Conseils du chef"}),(0,s.jsx)("p",{children:n.chef_tips})]})]})]}),(0,s.jsxs)("div",{className:"recipe-actions",children:[(0,s.jsx)("button",{className:"action-btn primary",children:"\uD83D\uDCC5 Planifier cette recette"}),(0,s.jsx)("button",{className:"action-btn secondary",children:"\uD83D\uDED2 Ajouter aux courses"}),(0,s.jsx)("button",{className:"action-btn tertiary",onClick:function(){A({name:n.title||"",description:n.description||"",short_description:n.short_description||"",prep_min:n.prep_min||0,cook_min:n.cook_min||0,rest_min:n.rest_min||0,servings:n.servings||4,chef_tips:n.chef_tips||"",is_vegetarian:n.is_vegetarian||!1,is_vegan:n.is_vegan||!1,is_gluten_free:n.is_gluten_free||!1});let e=(n.steps||"").split(/\n+/).filter(e=>e.trim());R(e.map((e,n)=>({id:Math.random(),text:e.replace(/^\d+\.\s*/,""),duration:"",type:"preparation"}))),0===e.length&&R([{id:Math.random(),text:"",duration:"",type:"preparation"}]),P(l.map(e=>{var n;return{id:e.id||Math.random(),canonical_food_id:e.canonical_food_id||"",canonical_food_name:(null===(n=e.canonical_foods)||void 0===n?void 0:n.name)||"",quantity:e.quantity||0,unit:e.unit||"g",notes:e.notes||""}})),z(),w(!0)},children:"\uD83D\uDCDD Modifier la recette"})]})]})]})}i(3006),i(4686),i(9433)},5626:function(e,n,i){"use strict";i.d(n,{OQ:function(){return a}});var s=i(6887);let t="https://yylkwfikfbottngglaxj.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5bGt3ZmlrZmJvdHRuZ2dsYXhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1NjUwNzAsImV4cCI6MjA3MjE0MTA3MH0.h-GTmBH9onVHNJLLuafw9jwS9G8azVaQGelf-oUK-xc",a=null;if(t&&r)try{console.log("\uD83D\uDD17 Connexion \xe0 Supabase r\xe9el:",t),a=(0,s.eI)(t,r,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}catch(e){console.error("[Supabase] Erreur lors de la cr\xe9ation du client",e instanceof Error?e:Error(String(e)))}else{let e=[!t&&"NEXT_PUBLIC_SUPABASE_URL",!r&&"NEXT_PUBLIC_SUPABASE_ANON_KEY"].filter(Boolean);Error("Supabase non configur\xe9. Variables manquantes: ".concat(e.join(", ")))}},8030:function(e,n,i){"use strict";i.d(n,{Z:function(){return u}});var s=i(2265);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),r=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,i)=>i?i.toUpperCase():n.toLowerCase()),a=e=>{let n=r(e);return n.charAt(0).toUpperCase()+n.slice(1)},l=function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return n.filter((e,n,i)=>!!e&&""!==e.trim()&&i.indexOf(e)===n).join(" ").trim()},c=e=>{for(let n in e)if(n.startsWith("aria-")||"role"===n||"title"===n)return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,s.forwardRef)((e,n)=>{let{color:i="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:d="",children:u,iconNode:m,...h}=e;return(0,s.createElement)("svg",{ref:n,...o,width:t,height:t,stroke:i,strokeWidth:a?24*Number(r)/Number(t):r,className:l("lucide",d),...!u&&!c(h)&&{"aria-hidden":"true"},...h},[...m.map(e=>{let[n,i]=e;return(0,s.createElement)(n,i)}),...Array.isArray(u)?u:[u]])}),u=(e,n)=>{let i=(0,s.forwardRef)((i,r)=>{let{className:c,...o}=i;return(0,s.createElement)(d,{ref:r,iconNode:n,className:l("lucide-".concat(t(a(e))),"lucide-".concat(e),c),...o})});return i.displayName=a(e),i}},4817:function(e,n,i){"use strict";i.d(n,{Z:function(){return s}});let s=(0,i(8030).Z)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},4697:function(e,n,i){"use strict";i.d(n,{Z:function(){return s}});let s=(0,i(8030).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},6463:function(e,n,i){"use strict";var s=i(1169);i.o(s,"useParams")&&i.d(n,{useParams:function(){return s.useParams}}),i.o(s,"usePathname")&&i.d(n,{usePathname:function(){return s.usePathname}}),i.o(s,"useRouter")&&i.d(n,{useRouter:function(){return s.useRouter}}),i.o(s,"useSearchParams")&&i.d(n,{useSearchParams:function(){return s.useSearchParams}})},9433:function(){},4686:function(){},3006:function(){}},function(e){e.O(0,[81,887,971,23,744],function(){return e(e.s=8732)}),_N_E=e.O()}]);