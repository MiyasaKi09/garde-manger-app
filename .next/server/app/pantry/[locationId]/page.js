(()=>{var e={};e.id=642,e.ids=[642],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},7918:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.ZP,__next_app__:()=>c,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>l}),r(4685),r(3909),r(6926),r(5866);var a=r(3191),s=r(8716),i=r(5383),n=r(5231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);r.d(t,o);let l=["",{children:["pantry",{children:["[locationId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,4685)),"/workspaces/garde-manger-app/app/pantry/[locationId]/page.js"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,3909)),"/workspaces/garde-manger-app/app/layout.js"],error:[()=>Promise.resolve().then(r.bind(r,6926)),"/workspaces/garde-manger-app/app/error.jsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/workspaces/garde-manger-app/app/pantry/[locationId]/page.js"],u="/pantry/[locationId]/page",c={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/pantry/[locationId]/page",pathname:"/pantry/[locationId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},5518:(e,t,r)=>{Promise.resolve().then(r.bind(r,528))},528:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var a=r(326),s=r(7577),i=r(5047),n=r(4122);function o({title:e,children:t,...r}){return a.jsx("button",{...r,title:e,className:"btn",style:{background:"#fff",border:"1px solid #dcdce0",borderRadius:8,padding:"4px 6px",lineHeight:1,cursor:"pointer"},children:t})}let l=(e="")=>e.normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().trim();function d(e,t){let r=l(e),a=l(t);return r&&a?a.startsWith(r)?0:a.includes(r)?1:function(e,t){e=l(e),t=l(t);let r=e.length,a=t.length;if(!r)return a;if(!a)return r;let s=Array.from({length:r+1},()=>Array(a+1).fill(0));for(let e=0;e<=r;e++)s[e][0]=e;for(let e=0;e<=a;e++)s[0][e]=e;for(let i=1;i<=r;i++)for(let r=1;r<=a;r++){let a=e[i-1]===t[r-1]?0:1;s[i][r]=Math.min(s[i-1][r]+1,s[i][r-1]+1,s[i-1][r-1]+a)}return s[r][a]}(r,a):999}let u=e=>new Date(Date.now()+864e5*e).toISOString().slice(0,10),c=["Frais","Fruits/L\xe9gumes","Laitier","Fromage","Viande/Poisson","Charcuterie","Boulangerie","Sec","Conserve","Surgel\xe9","Boisson","Autre"],p={Sec:365,Surgelé:180,Conserve:1095,Laitier:7,Fromage:21,Boulangerie:3,Frais:7,"Fruits/L\xe9gumes":7,"Viande/Poisson":2,Charcuterie:5,Boisson:365,Autre:7},g=[{rx:/ya+?ourt|yogh/i,days:14},{rx:/fromage blanc/i,days:14},{rx:/lait|cr[eé]me/i,days:7},{rx:/fromage/i,days:21},{rx:/jambon|charcut/i,days:5},{rx:/p[aâ]tes|riz|farine|semoule|lentilles/i,days:365},{rx:/conserve|cann/i,days:1095},{rx:/sucre|sel|cafe/i,days:365},{rx:/pain|brioche/i,days:3},{rx:/steak|boeuf|veau|agneau|poulet|dinde|porc/i,days:2},{rx:/poisson|saumon|thon|cabillaud/i,days:2},{rx:/tomate.*(c(oe|œur)ur).*boeuf/i,days:7},{rx:/tomate/i,days:7},{rx:/salade|courgette|pomme(?! de terre)|banane|carotte|oignon|poivron|concombre/i,days:7},{rx:/herbe|persil|basilic|coriandre|menthe/i,days:5},{rx:/surg|congel/i,days:180}];function m({days:e,locationName:t="",isOpened:r=!1,category:a=""}){let s=(t||"").toLowerCase();return/cong|surg/.test(s)&&(e=Math.max(e,180)),/placard|epicer|cave/.test(s)&&(e=Math.min(e,365)),/frigo|frigidaire/.test(s)&&/(lait|cr[eé]me|fromage|yaourt|charcut)/i.test(a||"")&&(e=Math.max(Math.min(e,21),7)),r&&(e=Math.max(1,Math.round(.6*e))),e=Math.max(e,/(Fruits\/Légumes|Frais)/.test(a||"")?5:3)}function f({productRow:e,name:t="",category:r="",locationName:a=""}){if(e?.shelf_life_days&&e.shelf_life_days>0)return{days:m({days:e.shelf_life_days,locationName:a,isOpened:!1,category:e.category||r}),source:"product"};let s=`${t} ${r}`.trim();for(let e of g)if(e.rx.test(s))return{days:m({days:e.days,locationName:a,isOpened:!1,category:r}),source:"keyword"};return r&&null!=p[r]?{days:m({days:p[r],locationName:a,isOpened:!1,category:r}),source:"category"}:{days:m({days:7,locationName:a,isOpened:!1,category:r}),source:"default"}}function y(e,t){return e.reduce((e,r)=>{let a=t(r);return(e[a]=e[a]||[]).push(r),e},{})}function x(){let{locationId:e}=(0,i.useParams)(),[t,r]=(0,s.useState)("…"),[l,p]=(0,s.useState)([]),[g,m]=(0,s.useState)([]),[x,h]=(0,s.useState)([]),[_,v]=(0,s.useState)(""),[b,j]=(0,s.useState)(""),[w,q]=(0,s.useState)("g"),[S,C]=(0,s.useState)(""),[P,k]=(0,s.useState)(!1),[M,O]=(0,s.useState)(null),[A,D]=(0,s.useState)(""),[N,I]=(0,s.useState)(!1),[R,L]=(0,s.useState)(-1),E=(0,s.useRef)(null),F=(0,s.useRef)(null);async function Q(){let{data:t}=await n.OQ.from("locations").select("name").eq("id",e).single();t&&r(t.name);let{data:a}=await n.OQ.from("inventory_lots").select("id, qty, unit, dlc, entered_at, product:products_catalog(id,name,default_unit)").eq("location_id",e).order("dlc",{ascending:!0});p(a||[]);let{data:s}=await n.OQ.from("products_catalog").select("id,name,default_unit,category,shelf_life_days,density_g_per_ml,grams_per_unit").order("name");m(s||[]);let{data:i}=await n.OQ.from("product_aliases").select("product_id,alias");h(i||[])}let T=(0,s.useMemo)(()=>{let e=_.trim();if(!e)return[];let t=[];for(let r of g)t.push({id:r.id,label:r.name,base:r.name,score:d(e,r.name),unit:r.default_unit||"g"});for(let r of x){let a=g.find(e=>e.id===r.product_id);a&&t.push({id:a.id,label:a.name,base:r.alias,score:d(e,r.alias),unit:a.default_unit||"g"})}let r=new Map;for(let e of t){let t=r.get(e.id);(!t||e.score<t.score)&&r.set(e.id,e)}return Array.from(r.values()).sort((e,t)=>e.score-t.score).slice(0,7)},[_,g,x]),z=(0,s.useMemo)(()=>M?g.find(e=>e.id===M.id)||M:null,[M,g]),B=(0,s.useMemo)(()=>{if(S)return null;let e=z?.name||_.trim();if(!e)return null;let r=A||z?.category||"",a=f({productRow:z,name:e,category:r,locationName:t});return{...a,date:u(a.days)}},[S,_,z,A,t]);function G(e){v(e.label);let t=g.find(t=>t.id===e.id);t&&(O(t),D(t.category||""),t.default_unit&&q(t.default_unit)),I(!1),setTimeout(()=>E.current?.focus(),0)}async function W(r){if(r.preventDefault(),!_.trim()||!b)return alert("Produit et quantit\xe9 requis.");k(!0);try{let r=z;if(!r){let e=T[0];e&&(r=g.find(t=>t.id===e.id))}if(!r)throw Error("Choisis un produit existant (dans la liste). Pour cr\xe9er un nouveau produit, passe par Param\xe8tres → Donn\xe9es.");let a=A||r.category||"";if(a&&a!==r.category&&(await n.OQ.from("products_catalog").update({category:a}).eq("id",r.id),m(e=>e.map(e=>e.id===r.id?{...e,category:a}:e)),r={...r,category:a}),!r.shelf_life_days||r.shelf_life_days<=0){let e=f({productRow:r,name:r.name,category:a,locationName:t});await n.OQ.from("products_catalog").update({shelf_life_days:e.days}).eq("id",r.id),m(t=>t.map(t=>t.id===r.id?{...t,shelf_life_days:e.days}:t)),r={...r,shelf_life_days:e.days}}let s=S||u(f({productRow:r,name:r.name,category:r.category,locationName:t}).days),i=w||r.default_unit||"g",{error:o}=await n.OQ.from("inventory_lots").insert({product_id:r.id,location_id:e,qty:Number(b),unit:i,dlc:s,source:"achat"});if(o)throw o;v(""),j(""),q("g"),C(""),O(null),D(""),await Q(),E.current?.focus()}catch(e){alert(e.message||"Erreur")}finally{k(!1)}}async function $(e){if(!confirm("Retirer ce lot ?"))return;let{error:t}=await n.OQ.from("inventory_lots").delete().eq("id",e);if(t)return alert(t.message);await Q()}return y(l,e=>e.product?.name??"—"),(0,a.jsxs)("div",{children:[a.jsx("h1",{children:t}),(0,a.jsxs)("form",{onSubmit:W,className:"card",style:{display:"grid",gap:10,maxWidth:780},children:[(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:10},children:[(0,a.jsxs)("label",{children:["Produit",(0,a.jsxs)("div",{style:{position:"relative"},children:[a.jsx("input",{ref:E,className:"input",placeholder:"Ex: Tomates",value:_,onChange:e=>{v(e.target.value),I(!0),O(null),D("")},onFocus:()=>I(!0),autoComplete:"off",onKeyDown:e=>{N&&("ArrowDown"===e.key&&(e.preventDefault(),L(e=>Math.min(e+1,T.length-1))),"ArrowUp"===e.key&&(e.preventDefault(),L(e=>Math.max(e-1,0))),"Enter"===e.key&&R>=0&&T[R]&&(e.preventDefault(),G(T[R])),"Escape"===e.key&&I(!1))},required:!0}),N&&_.trim()&&T.length>0&&a.jsx("div",{ref:F,style:{position:"absolute",top:"100%",left:0,right:0,zIndex:50,background:"#fff",border:"1px solid #dcdce0",borderTop:"none",borderBottomLeftRadius:10,borderBottomRightRadius:10,boxShadow:"0 6px 18px rgba(0,0,0,.06)",maxHeight:260,overflowY:"auto"},children:T.map((e,t)=>a.jsx("div",{style:{padding:"8px 10px",cursor:"pointer",background:t===R?"#f5f5f7":"transparent"},onMouseEnter:()=>L(t),onMouseDown:()=>G(e),children:(0,a.jsxs)("div",{style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:[e.label," ",(0,a.jsxs)("span",{style:{opacity:.6,fontSize:12},children:["(",e.unit||"g",")"]})]})},e.id))})]})]}),(0,a.jsxs)("label",{children:["Quantit\xe9",a.jsx("input",{className:"input",required:!0,type:"number",step:"0.01",min:"0",value:b,onChange:e=>j(e.target.value)})]})]}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[(0,a.jsxs)("label",{children:["Unit\xe9",a.jsx("select",{className:"input",value:w,onChange:e=>q(e.target.value),children:["g","kg","ml","cl","l","u"].map(e=>a.jsx("option",{value:e,children:e},e))})]}),(0,a.jsxs)("label",{children:["Cat\xe9gorie ",z?.category?(0,a.jsxs)("span",{style:{opacity:.6},children:["(actuelle : ",z.category,")"]}):a.jsx("span",{style:{opacity:.6},children:"(non renseign\xe9e)"}),(0,a.jsxs)("select",{className:"input",value:A,onChange:e=>D(e.target.value),children:[a.jsx("option",{value:"",children:"— choisir (optionnel)"}),c.map(e=>a.jsx("option",{value:e,children:e},e))]})]})]}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:(0,a.jsxs)("label",{children:["DLC",a.jsx("input",{className:"input",type:"date",value:S,onChange:e=>C(e.target.value)}),!S&&B&&(0,a.jsxs)("div",{style:{fontSize:12,opacity:.75,marginTop:6},children:["Suggestion : ",a.jsx("strong",{children:B.date})," ",(0,a.jsxs)("span",{style:{opacity:.7},children:["(",B.days," j, source : ",B.source,")"]})]})]})}),a.jsx("div",{children:a.jsx("button",{className:"btn primary",type:"submit",disabled:P,children:P?"Ajout…":"Ajouter ici"})})]}),Object.entries(y(l,e=>e.product?.name??"—")).map(([e,t])=>(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[a.jsx("strong",{children:e}),(0,a.jsxs)("span",{style:{opacity:.6,fontSize:12},children:[t.length," lot(s)"]})]}),a.jsx("div",{style:{marginTop:6},children:t.map(e=>(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,padding:"6px 0"},children:[(0,a.jsxs)("div",{children:["• ",e.qty," ",e.unit," — DLC ",e.dlc||"—"]}),a.jsx(o,{title:"Retirer",onClick:()=>$(e.id),children:"✖️"})]},e.id))})]},e)),0===l.length&&a.jsx("p",{children:"Aucun produit ici."})]})}},4685:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>n,__esModule:()=>i,default:()=>o});var a=r(8570);let s=(0,a.createProxy)(String.raw`/workspaces/garde-manger-app/app/pantry/[locationId]/page.js`),{__esModule:i,$$typeof:n}=s;s.default;let o=(0,a.createProxy)(String.raw`/workspaces/garde-manger-app/app/pantry/[locationId]/page.js#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,618,146],()=>r(7918));module.exports=a})();