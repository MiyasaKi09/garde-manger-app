"use strict";exports.id=975,exports.ids=[975],exports.modules={8975:(e,r,t)=>{t.d(r,{Mn:()=>s,NP:()=>u,d$:()=>d,nR:()=>o,vd:()=>a});var i=t(7043),n=t(5303);async function o({userId:e,name:r,recipeId:t=null,portionsCooked:o,storageMethod:s="fridge",ingredientsUsed:a=[],notes:u=null}){try{if(!e)throw Error("User ID requis");if(!r||""===r.trim())throw Error("Nom du plat requis");if(!o||o<=0)throw Error("Nombre de portions invalide");if(!["fridge","freezer","counter"].includes(s))throw Error("Mode de stockage invalide");let d=new Date,l=(0,n.MV)(d,s),{data:c,error:f}=await i.OQ.from("cooked_dishes").insert({user_id:e,name:r.trim(),recipe_id:t,portions_cooked:o,portions_remaining:o,storage_method:s,cooked_at:d.toISOString(),expiration_date:l.toISOString().split("T")[0],notes:u}).select().single();if(f)throw console.error("Erreur cr\xe9ation plat:",f),f;if(a&&a.length>0){let r=[],t=[];for(let n of a){let{lotId:o,quantityUsed:s,unit:a,productName:u}=n;if(!o||!s||s<=0)continue;r.push({dish_id:c.id,lot_id:o,quantity_used:s,unit:a||"u",product_name:u||null});let{data:d,error:l}=await i.OQ.from("inventory_lots").select("qty_remaining, unit").eq("id",o).eq("user_id",e).single();if(!l&&d){let e=Math.max(0,d.qty_remaining-s);t.push({lotId:o,newQuantity:e})}}if(r.length>0){let{error:e}=await i.OQ.from("cooked_dish_ingredients").insert(r);e&&console.error("Erreur enregistrement ingr\xe9dients:",e)}for(let r of t){let{error:t}=await i.OQ.from("inventory_lots").update({qty_remaining:r.newQuantity}).eq("id",r.lotId).eq("user_id",e);t&&console.error("Erreur mise \xe0 jour inventaire:",t)}}let g=Math.ceil((l-new Date)/864e5);return{success:!0,dish:c,message:`Plat "${r}" cr\xe9\xe9 avec ${o} portions. Expire dans ${g} jours.`,daysUntilExpiration:g}}catch(e){return console.error("Erreur createCookedDish:",e),{success:!1,error:e.message||"Erreur lors de la cr\xe9ation du plat"}}}async function s(e,r,t=1){try{if(!e||!r)throw Error("Param\xe8tres manquants");if(t<=0)throw Error("Nombre de portions invalide");let{data:n,error:o}=await i.OQ.from("cooked_dishes").select("*").eq("id",e).eq("user_id",r).single();if(o)throw Error("Plat introuvable");if(n.portions_remaining<=0)return{success:!1,error:"Ce plat est d\xe9j\xe0 enti\xe8rement consomm\xe9"};let s=Math.max(0,n.portions_remaining-t),{data:a,error:u}=await i.OQ.from("cooked_dishes").update({portions_remaining:s}).eq("id",e).eq("user_id",r).select().single();if(u)throw u;let d=0===s?`Plat "${n.name}" enti\xe8rement consomm\xe9 ! ðŸŽ‰`:`${t} portion(s) consomm\xe9e(s). Reste ${s} portion(s).`;return{success:!0,dish:a,message:d,fullyConsumed:0===s}}catch(e){return console.error("Erreur consumePortions:",e),{success:!1,error:e.message||"Erreur lors de la consommation"}}}async function a(e,r,t){try{if(!e||!r)throw Error("Param\xe8tres manquants");if(!["fridge","freezer","counter"].includes(t))throw Error("Mode de stockage invalide");let{data:o,error:s}=await i.OQ.from("cooked_dishes").select("*").eq("id",e).eq("user_id",r).single();if(s)throw Error("Plat introuvable");if(o.storage_method===t)return{success:!1,error:`Le plat est d\xe9j\xe0 stock\xe9 en mode "${t}"`};let a=new Date(o.cooked_at),u=(0,n.MV)(a,t),{data:d,error:l}=await i.OQ.from("cooked_dishes").update({storage_method:t,expiration_date:u.toISOString().split("T")[0]}).eq("id",e).eq("user_id",r).select().single();if(l)throw l;let c=Math.ceil((u-new Date)/864e5),f=`Plat d\xe9plac\xe9 au ${{fridge:"frigo",freezer:"cong\xe9lateur",counter:"comptoir"}[t]}. Nouvelle DLC : ${c} jours.`;return{success:!0,dish:d,message:f,daysUntilExpiration:c}}catch(e){return console.error("Erreur changeStorageMethod:",e),{success:!1,error:e.message||"Erreur lors du changement de stockage"}}}async function u(e,r={}){try{if(!e)throw Error("User ID requis");let t=i.OQ.from("cooked_dishes").select(`
        *,
        recipe:recipes(id, title, image_url),
        ingredients:cooked_dish_ingredients(
          id,
          quantity_used,
          unit,
          product_name,
          lot:inventory_lots(id, product_type, product_id)
        )
      `).eq("user_id",e).order("expiration_date",{ascending:!0});if(r.onlyWithPortions&&(t=t.gt("portions_remaining",0)),r.expiringInDays){let e=new Date;e.setDate(e.getDate()+r.expiringInDays),t=t.lte("expiration_date",e.toISOString().split("T")[0])}let{data:n,error:o}=await t;if(o)throw o;let s=(n||[]).map(e=>({...e,days_until_expiration:Math.ceil((new Date(e.expiration_date)-new Date)/864e5)}));return{success:!0,dishes:s}}catch(e){return console.error("Erreur getCookedDishes:",e),{success:!1,error:e.message||"Erreur lors de la r\xe9cup\xe9ration des plats",dishes:[]}}}async function d(e,r){try{if(!e||!r)throw Error("Param\xe8tres manquants");let{error:t}=await i.OQ.from("cooked_dishes").delete().eq("id",e).eq("user_id",r);if(t)throw t;return{success:!0,message:"Plat supprim\xe9 avec succ\xe8s"}}catch(e){return console.error("Erreur deleteCookedDish:",e),{success:!1,error:e.message||"Erreur lors de la suppression"}}}},5303:(e,r,t)=>{t.d(r,{BK:()=>s,MV:()=>u,XO:()=>o,e4:()=>n});let i={Lait:{fridge:3,freezer:90,pantry:1},Laitier:{fridge:3,freezer:30,pantry:1},Yaourt:{fridge:5,freezer:60,pantry:1},Fromage:{fridge:7,freezer:90,pantry:2},CrÃ¨me:{fridge:3,freezer:60,pantry:1},Beurre:{fridge:14,freezer:180,pantry:7},Charcuterie:{fridge:4,freezer:60,pantry:1},Jambon:{fridge:3,freezer:60,pantry:1},Saucisson:{fridge:7,freezer:90,pantry:3},PÃ¢tÃ©:{fridge:3,freezer:60,pantry:1},"Viande cuite":{fridge:3,freezer:90,pantry:1},Confiture:{fridge:30,freezer:180,pantry:14},Miel:{fridge:365,freezer:365,pantry:365},Sauce:{fridge:7,freezer:90,pantry:3},Mayonnaise:{fridge:7,freezer:null,pantry:1},Ketchup:{fridge:30,freezer:90,pantry:14},Moutarde:{fridge:60,freezer:90,pantry:30},"Jus de fruits":{fridge:5,freezer:90,pantry:2},Soda:{fridge:3,freezer:null,pantry:1},Vin:{fridge:5,freezer:null,pantry:3},Huile:{fridge:90,freezer:365,pantry:60},Vinaigre:{fridge:180,freezer:365,pantry:90},Pain:{fridge:3,freezer:30,pantry:2},PÃ¢tisserie:{fridge:2,freezer:30,pantry:1},Viennoiserie:{fridge:2,freezer:30,pantry:1},Conserve:{fridge:3,freezer:90,pantry:2},Compote:{fridge:5,freezer:90,pantry:2},Salade:{fridge:2,freezer:null,pantry:1},"L\xe9gumes cuits":{fridge:3,freezer:90,pantry:1},_default:{fridge:7,freezer:90,pantry:3}};function n(e,r,t=new Date,n=null){let o=i[e]||i._default,s=o[r]||o.fridge;if(null===s)return null;let a=new Date(t);if(a.setDate(a.getDate()+s),n){let e=new Date(n);if(a>e)return e}return a}function o(e,r=null){if(r&&i[r])return r;let t=e.toLowerCase();return t.includes("lait")&&!t.includes("coco")?"Lait":t.includes("yaourt")||t.includes("yogurt")||t.includes("yoghourt")?"Yaourt":t.includes("fromage")?"Fromage":t.includes("cr\xe8me")||t.includes("creme")?"Cr\xe8me":t.includes("beurre")?"Beurre":t.includes("jambon")?"Jambon":t.includes("saucisson")||t.includes("salami")?"Saucisson":t.includes("p\xe2t\xe9")||t.includes("pate")||t.includes("terrine")?"P\xe2t\xe9":t.includes("confiture")||t.includes("gel\xe9e")?"Confiture":t.includes("miel")?"Miel":t.includes("mayonnaise")||t.includes("mayo")?"Mayonnaise":t.includes("ketchup")?"Ketchup":t.includes("moutarde")?"Moutarde":t.includes("jus")?"Jus de fruits":t.includes("soda")||t.includes("cola")||t.includes("limonade")?"Soda":t.includes("vin")?"Vin":t.includes("huile")?"Huile":t.includes("vinaigre")?"Vinaigre":t.includes("pain")||t.includes("baguette")?"Pain":t.includes("croissant")||t.includes("pain au")||t.includes("brioche")?"Viennoiserie":t.includes("conserve")||t.includes("bocal")?"Conserve":t.includes("compote")?"Compote":t.includes("sauce")?"Sauce":t.includes("salade")||t.includes("laitue")?"Salade":"_default"}function s(e,r,t){return t<=0?"âš ï¸ Produit p\xe9rim\xe9, \xe0 jeter":1===t?"\uD83D\uDD25 \xc0 consommer aujourd'hui":t<=3?`â° ${t} jours restants, \xe0 consommer rapidement`:t<=7?`âœ“ ${t} jours restants`:`âœ“ Bon \xe9tat (${t} jours)`}let a={fridge:3,freezer:90,counter:1};function u(e=new Date,r="fridge"){let t=a[r]||a.fridge,i=new Date(e);return i.setDate(i.getDate()+t),i}},7043:(e,r,t)=>{t.d(r,{OQ:()=>s});var i=t(9498);let n="https://yylkwfikfbottngglaxj.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5bGt3ZmlrZmJvdHRuZ2dsYXhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1NjUwNzAsImV4cCI6MjA3MjE0MTA3MH0.h-GTmBH9onVHNJLLuafw9jwS9G8azVaQGelf-oUK-xc",s=null;if(n&&o)try{console.log("\uD83D\uDD17 Connexion \xe0 Supabase r\xe9el:",n),s=(0,i.eI)(n,o,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})}catch(e){console.error("[Supabase] Erreur lors de la cr\xe9ation du client",e instanceof Error?e:Error(String(e)))}else{let e=[!n&&"NEXT_PUBLIC_SUPABASE_URL",!o&&"NEXT_PUBLIC_SUPABASE_ANON_KEY"].filter(Boolean);Error(`Supabase non configur\xe9. Variables manquantes: ${e.join(", ")}`)}}};