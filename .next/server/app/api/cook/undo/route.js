"use strict";(()=>{var e={};e.id=404,e.ids=[404],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},2709:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var o={};r.r(o),r.d(o,{POST:()=>p});var s=r(9303),n=r(8716),a=r(670),i=r(7070),u=r(9498);async function p(e){let t=function(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5bGt3ZmlrZmJvdHRuZ2dsYXhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1NjUwNzAsImV4cCI6MjA3MjE0MTA3MH0.h-GTmBH9onVHNJLLuafw9jwS9G8azVaQGelf-oUK-xc";return(0,u.eI)("https://yylkwfikfbottngglaxj.supabase.co",e,{auth:{persistSession:!1}})}(),{undoToken:r}=await e.json();if(!r)return i.NextResponse.json({error:"undoToken manquant"},{status:400});let{data:o,error:s}=await t.from("cook_logs").select("id, delta").eq("id",r).single();if(s)return i.NextResponse.json({error:s.message},{status:500});for(let e of[...Array.isArray(o?.delta)?o.delta:[]].reverse())if("update"===e.action){let r=e.lot_before,{error:o}=await t.from("inventory_lots").update({qty:r.qty,opened_at:r.opened_at}).eq("id",r.id);if(o)return i.NextResponse.json({error:o.message},{status:500})}else if("delete"===e.action){let r=e.lot_before,o={id:r.id,product_id:r.product_id,location_id:r.location_id,qty:r.qty,unit:r.unit,dlc:r.dlc,entered_at:r.entered_at,opened_at:r.opened_at,note:r.note,source:r.source},{error:s}=await t.from("inventory_lots").insert(o);if(s)return i.NextResponse.json({error:s.message},{status:500})}return i.NextResponse.json({ok:!0})}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/cook/undo/route",pathname:"/api/cook/undo",filename:"route",bundlePath:"app/api/cook/undo/route"},resolvedPagePath:"/workspaces/garde-manger-app/app/api/cook/undo/route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:m}=d,f="/api/cook/undo/route";function x(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,766,70],()=>r(2709));module.exports=o})();