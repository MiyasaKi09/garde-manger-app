(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[605],{7059:function(e,a,i){Promise.resolve().then(i.bind(i,1825))},1825:function(e,a,i){"use strict";i.r(a),i.d(a,{default:function(){return f}});var t=i(7437),r=i(8059),o=i.n(r),s=i(2265),c=i(2513),l=i(4697),n=i(4817),d=i(4392);function f(e){let{open:a,onClose:i,onLotCreated:r}=e,[f,x]=(0,s.useState)(1),[m,b]=(0,s.useState)(""),[p,u]=(0,s.useState)([]),[g,j]=(0,s.useState)(!1),[h,y]=(0,s.useState)(null),[k,w]=(0,s.useState)(!1),[v,z]=(0,s.useState)({qty_remaining:"",unit:"unit\xe9s",storage_method:"pantry",storage_place:"Garde-manger",expiration_date:""}),N=(0,s.useRef)(null),_=(0,s.useRef)(null),C=(0,d.createClientComponentClient)();(0,s.useEffect)(()=>{a&&(x(1),b(""),u([]),y(null),z({qty_remaining:"",unit:"unit\xe9s",storage_method:"pantry",storage_place:"Garde-manger",expiration_date:""}),setTimeout(()=>{var e;return null===(e=N.current)||void 0===e?void 0:e.focus()},100))},[a]);let D=(0,s.useCallback)(async e=>{if(!e||e.trim().length<2){u([]);return}j(!0);let a=e.trim().toLowerCase();try{let e=a.split(/\s+/).filter(e=>e.length>0),i=new Set;if(i.add("%".concat(a,"%")),e.length>1){let a=e.slice().reverse().join(" ");i.add("%".concat(a,"%"));let t=e.map(e=>"%".concat(e,"%")).join("");i.add(t)}if(e.length>1){let a=e.join("%");i.add("%".concat(a,"%"))}let t=[],r=new Set;for(let o of i){let{data:i,error:s}=await C.from("canonical_foods").select("id, canonical_name, category_id, primary_unit").ilike("canonical_name",o).limit(20);i&&!s&&i.forEach(i=>{if(!r.has(i.id)){r.add(i.id);let o=i.canonical_name.toLowerCase(),s=0;s=o===a?100:o.includes(a)?90:e.every(e=>o.includes(e))?70:40,t.push({id:i.id,name:i.canonical_name,type:"canonical",matchScore:s,primary_unit:i.primary_unit||"unit\xe9s"})}})}let o=t.sort((e,a)=>a.matchScore-e.matchScore).slice(0,10);u(o)}catch(e){console.error("Erreur recherche:",e)}finally{j(!1)}},[C]);(0,s.useEffect)(()=>(_.current&&clearTimeout(_.current),_.current=setTimeout(()=>{D(m)},300),()=>{_.current&&clearTimeout(_.current)}),[m,D]);let S=e=>{y(e),z(a=>({...a,unit:e.primary_unit||"unit\xe9s"})),x(2)},E=async()=>{if(!h||!v.qty_remaining){alert("Veuillez s\xe9lectionner un produit et entrer une quantit\xe9");return}w(!0);try{let e=parseFloat(v.qty_remaining)||0;if(("unit\xe9s"===v.unit||"pi\xe8ce"===v.unit)&&e%.5!=0){alert("Pour les unit\xe9s, utilisez des multiples de 0.5 (0.5, 1, 1.5, 2...)"),w(!1);return}let a={qty_remaining:e,initial_qty:e,unit:v.unit,storage_method:v.storage_method,storage_place:v.storage_place,expiration_date:v.expiration_date||null,acquired_on:new Date().toISOString().split("T")[0],opened_on:null,produced_on:null,notes:"",source:"manual",owner_id:null};"canonical"===h.type&&(a.canonical_food_id=h.id),console.log("Cr\xe9ation du lot:",a);let{data:t,error:o}=await C.from("inventory_lots").insert([a]).select().single();o?(console.error("Erreur cr\xe9ation:",o),alert("Erreur: ".concat(o.message))):(console.log("Lot cr\xe9\xe9 avec succ\xe8s:",t),r&&r(t),i())}catch(e){console.error("Erreur:",e),alert("Erreur: ".concat(e.message))}finally{w(!1)}};return a?(0,t.jsxs)("div",{onMouseDown:e=>{e.target===e.currentTarget&&(e.preventDefault(),i())},className:"jsx-3af424c1ce99f97a modal-overlay",children:[(0,t.jsxs)("div",{onMouseDown:e=>e.stopPropagation(),className:"jsx-3af424c1ce99f97a modal-container",children:[(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a modal-header",children:[(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a header-title",children:[(0,t.jsx)(c.Z,{size:24}),"Ajouter un produit"]}),(0,t.jsx)("button",{onClick:i,className:"jsx-3af424c1ce99f97a close-btn",children:(0,t.jsx)(l.Z,{size:20})})]}),(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a progress-bar",children:[(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a "+"progress-step ".concat(f>=1?"active":""),children:"1. Produit"}),(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a "+"progress-step ".concat(f>=2?"active":""),children:"2. Quantit\xe9"})]}),(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a modal-content",children:[1===f&&(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a search-step",children:[(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a search-wrapper",children:[(0,t.jsx)(n.Z,{size:20,className:"search-icon"}),(0,t.jsx)("input",{ref:N,type:"text",placeholder:"Ex: tomate, pomme de terre, yaourt...",value:m,onChange:e=>b(e.target.value),className:"jsx-3af424c1ce99f97a search-input"}),g&&(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a loading",children:"\uD83D\uDD04"})]}),p.length>0&&(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a results-list",children:p.map((e,a)=>(0,t.jsxs)("div",{onClick:()=>S(e),className:"jsx-3af424c1ce99f97a result-item",children:[(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a item-icon",children:"\uD83C\uDF4E"}),(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a item-info",children:[(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a item-name",children:e.name}),(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a item-category",children:[e.matchScore>70?"✅ \xc9lev\xe9e":"\uD83D\uDD36 Moyenne"," (",e.matchScore,"%)"]})]})]},"".concat(e.id,"-").concat(a)))}),m.length>=2&&0===p.length&&!g&&(0,t.jsx)("div",{style:{padding:"1rem",textAlign:"center",color:"#666"},className:"jsx-3af424c1ce99f97a",children:"Aucun produit trouv\xe9"})]}),2===f&&h&&(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a quantity-step",children:[(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a selected-product",children:[(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a product-icon",children:"\uD83C\uDF4E"}),(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a product-info",children:[(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a product-name",children:h.name}),(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a product-source",children:"L\xe9gumes"})]}),(0,t.jsx)("button",{onClick:()=>{x(1),y(null)},className:"jsx-3af424c1ce99f97a change-btn",children:"Changer"})]}),(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a lot-form",children:[(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a form-row",children:[(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a form-group flex-1",children:[(0,t.jsx)("label",{className:"jsx-3af424c1ce99f97a",children:"Quantit\xe9 actuelle"}),(0,t.jsx)("input",{type:"number",step:"unit\xe9s"===v.unit||"pi\xe8ce"===v.unit?"0.5":"0.1",min:"0",placeholder:"0",value:v.qty_remaining,onChange:e=>{let a=parseFloat(e.target.value)||0;if("unit\xe9s"===v.unit||"pi\xe8ce"===v.unit){let e=Math.round(2*a)/2;z(a=>({...a,qty_remaining:e}))}else z(e=>({...e,qty_remaining:a}))},autoFocus:!0,className:"jsx-3af424c1ce99f97a form-input"}),("unit\xe9s"===v.unit||"pi\xe8ce"===v.unit)&&(0,t.jsx)("small",{style:{color:"#666",fontSize:"0.75rem"},className:"jsx-3af424c1ce99f97a",children:"Par demi-unit\xe9 (0.5, 1, 1.5, 2...)"})]}),(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a form-group",children:[(0,t.jsx)("label",{className:"jsx-3af424c1ce99f97a",children:"Unit\xe9"}),(0,t.jsxs)("select",{value:v.unit,onChange:e=>z(a=>({...a,unit:e.target.value})),className:"jsx-3af424c1ce99f97a form-select",children:[(0,t.jsx)("option",{value:"unit\xe9s",className:"jsx-3af424c1ce99f97a",children:"Unit\xe9s"}),(0,t.jsx)("option",{value:"g",className:"jsx-3af424c1ce99f97a",children:"Grammes"}),(0,t.jsx)("option",{value:"kg",className:"jsx-3af424c1ce99f97a",children:"Kilogrammes"}),(0,t.jsx)("option",{value:"ml",className:"jsx-3af424c1ce99f97a",children:"Millilitres"}),(0,t.jsx)("option",{value:"L",className:"jsx-3af424c1ce99f97a",children:"Litres"})]})]})]}),(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a form-group",children:[(0,t.jsx)("label",{className:"jsx-3af424c1ce99f97a",children:"\uD83D\uDCCD M\xe9thode de stockage"}),(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a storage-methods",children:[{key:"pantry",label:"Garde-manger",icon:"\uD83C\uDFE0"},{key:"fridge",label:"R\xe9frig\xe9rateur",icon:"❄️"},{key:"freezer",label:"Cong\xe9lateur",icon:"\uD83E\uDDCA"},{key:"other",label:"Plan de travail",icon:"\uD83C\uDF74"}].map(e=>(0,t.jsxs)("div",{onClick:()=>z(a=>({...a,storage_method:e.key,storage_place:e.label})),className:"jsx-3af424c1ce99f97a "+"storage-method ".concat(v.storage_method===e.key?"active":""),children:[(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a method-icon",children:e.icon}),(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a method-label",children:e.label})]},e.key))})]}),(0,t.jsxs)("div",{className:"jsx-3af424c1ce99f97a form-group",children:[(0,t.jsx)("label",{className:"jsx-3af424c1ce99f97a",children:"\uD83D\uDCC5 Date de p\xe9remption (optionnel)"}),(0,t.jsx)("input",{type:"date",value:v.expiration_date,onChange:e=>z(a=>({...a,expiration_date:e.target.value})),min:new Date().toISOString().split("T")[0],className:"jsx-3af424c1ce99f97a form-input"})]})]})]})]}),(0,t.jsx)("div",{className:"jsx-3af424c1ce99f97a modal-footer",children:1===f?(0,t.jsx)("button",{onClick:i,className:"jsx-3af424c1ce99f97a btn btn-secondary",children:"Annuler"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>x(1),className:"jsx-3af424c1ce99f97a btn btn-secondary",children:"Retour"}),(0,t.jsx)("button",{onClick:E,disabled:!v.qty_remaining||k,className:"jsx-3af424c1ce99f97a btn btn-primary",children:k?"Cr\xe9ation...":"Cr\xe9er le lot"})]})})]}),(0,t.jsx)(o(),{id:"3af424c1ce99f97a",children:'.modal-overlay.jsx-3af424c1ce99f97a{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;z-index:1000;padding:1rem}.modal-container.jsx-3af424c1ce99f97a{background:rgba(255,255,255,.95);-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);-webkit-border-radius:20px;-moz-border-radius:20px;border-radius:20px;width:100%;max-width:600px;max-height:90vh;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-shadow:0 25px 50px rgba(0,0,0,.25);-moz-box-shadow:0 25px 50px rgba(0,0,0,.25);box-shadow:0 25px 50px rgba(0,0,0,.25)}.modal-header.jsx-3af424c1ce99f97a{padding:1.5rem;border-bottom:1px solid rgba(0,0,0,.1);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.header-title.jsx-3af424c1ce99f97a{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:.75rem;font-size:1.25rem;font-weight:600}.close-btn.jsx-3af424c1ce99f97a{background:none;border:none;padding:.5rem;cursor:pointer;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;-webkit-transition:all.2s;-moz-transition:all.2s;-o-transition:all.2s;transition:all.2s}.close-btn.jsx-3af424c1ce99f97a:hover{background:rgba(0,0,0,.05)}.progress-bar.jsx-3af424c1ce99f97a{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;padding:0 1.5rem;background:rgba(249,250,251,.8);border-bottom:1px solid rgba(0,0,0,.1)}.progress-step.jsx-3af424c1ce99f97a{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;padding:1rem 0;text-align:center;font-size:.875rem;font-weight:500;color:#6b7280;position:relative}.progress-step.active.jsx-3af424c1ce99f97a{color:#059669;font-weight:600}.progress-step.active.jsx-3af424c1ce99f97a::after{content:"";position:absolute;bottom:0;left:0;right:0;height:2px;background:#059669}.modal-content.jsx-3af424c1ce99f97a{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;overflow-y:auto;padding:1.5rem}.search-wrapper.jsx-3af424c1ce99f97a{position:relative;margin-bottom:1rem}.search-icon.jsx-3af424c1ce99f97a{position:absolute;left:1rem;top:50%;-webkit-transform:translatey(-50%);-moz-transform:translatey(-50%);-ms-transform:translatey(-50%);-o-transform:translatey(-50%);transform:translatey(-50%);color:#6b7280}.search-input.jsx-3af424c1ce99f97a{width:100%;padding:.75rem 1rem .75rem 3rem;border:2px solid#e5e7eb;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;font-size:1rem}.search-input.jsx-3af424c1ce99f97a:focus{outline:none;border-color:#059669}.loading.jsx-3af424c1ce99f97a{position:absolute;right:1rem;top:50%;-webkit-transform:translatey(-50%);-moz-transform:translatey(-50%);-ms-transform:translatey(-50%);-o-transform:translatey(-50%);transform:translatey(-50%)}.results-list.jsx-3af424c1ce99f97a{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:.5rem;max-height:400px;overflow-y:auto}.result-item.jsx-3af424c1ce99f97a{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:1rem;padding:1rem;border:1px solid#e5e7eb;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;cursor:pointer;-webkit-transition:all.2s;-moz-transition:all.2s;-o-transition:all.2s;transition:all.2s}.result-item.jsx-3af424c1ce99f97a:hover{border-color:#059669;background:rgba(5,150,105,.05)}.item-icon.jsx-3af424c1ce99f97a{font-size:2rem}.item-info.jsx-3af424c1ce99f97a{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1}.item-name.jsx-3af424c1ce99f97a{font-weight:600}.item-category.jsx-3af424c1ce99f97a{font-size:.875rem;color:#6b7280}.selected-product.jsx-3af424c1ce99f97a{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:1rem;padding:1rem;background:rgba(5,150,105,.1);border:2px solid#059669;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;margin-bottom:1.5rem}.product-icon.jsx-3af424c1ce99f97a{font-size:2.5rem}.product-info.jsx-3af424c1ce99f97a{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1}.product-name.jsx-3af424c1ce99f97a{font-weight:600;margin-bottom:.25rem}.product-source.jsx-3af424c1ce99f97a{font-size:.875rem;color:#6b7280}.change-btn.jsx-3af424c1ce99f97a{background:white;border:1px solid#d1d5db;padding:4px 12px;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;cursor:pointer;font-size:12px}.lot-form.jsx-3af424c1ce99f97a{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:1rem}.form-row.jsx-3af424c1ce99f97a{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:1rem}.form-group.jsx-3af424c1ce99f97a{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:.5rem}.form-group.flex-1.jsx-3af424c1ce99f97a{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1}.form-input.jsx-3af424c1ce99f97a,.form-select.jsx-3af424c1ce99f97a{padding:.75rem;border:1px solid#d1d5db;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;font-size:1rem}.storage-methods.jsx-3af424c1ce99f97a{display:grid;grid-template-columns:repeat(2,1fr);gap:.5rem}.storage-method.jsx-3af424c1ce99f97a{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:.5rem;padding:1rem;border:2px solid#e5e7eb;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;cursor:pointer;-webkit-transition:all.2s;-moz-transition:all.2s;-o-transition:all.2s;transition:all.2s}.storage-method.jsx-3af424c1ce99f97a:hover{border-color:#9ca3af}.storage-method.active.jsx-3af424c1ce99f97a{border-color:#059669;background:rgba(5,150,105,.1)}.method-icon.jsx-3af424c1ce99f97a{font-size:1.5rem}.method-label.jsx-3af424c1ce99f97a{font-size:.875rem;font-weight:500;text-align:center}.modal-footer.jsx-3af424c1ce99f97a{padding:1.5rem;border-top:1px solid#e5e7eb;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:1rem;-webkit-box-pack:end;-webkit-justify-content:flex-end;-moz-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}.btn.jsx-3af424c1ce99f97a{padding:.75rem 1.5rem;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;font-weight:500;cursor:pointer;-webkit-transition:all.2s;-moz-transition:all.2s;-o-transition:all.2s;transition:all.2s;border:none;font-size:1rem}.btn-secondary.jsx-3af424c1ce99f97a{background:#f9fafb;color:#374151;border:1px solid#d1d5db}.btn-primary.jsx-3af424c1ce99f97a{background:#059669;color:white}.btn-primary.jsx-3af424c1ce99f97a:disabled{background:#9ca3af;cursor:not-allowed}'})]}):null}}},function(e){e.O(0,[887,392,485,971,23,744],function(){return e(e.s=7059)}),_N_E=e.O()}]);